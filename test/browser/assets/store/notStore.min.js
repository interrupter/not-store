var notStore=function(e){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}var r=n((function(e){function t(e,t,n,r,o,i,s){try{var a=e[i](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,o)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(o,i){var s=e.apply(n,r);function a(e){t(s,o,i,a,l,"next",e)}function l(e){t(s,o,i,a,l,"throw",e)}a(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports})),o=t(r),i=n((function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports}));t(i);var s=n((function(e){e.exports=function(e){if(Array.isArray(e))return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports}));t(s);var a=n((function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports}));t(a);var l=n((function(e){e.exports=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports}));t(l);var c=n((function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}));t(c);var u=t(n((function(e){e.exports=function(e){return s(e)||a(e)||l(e)||c()},e.exports.__esModule=!0,e.exports.default=e.exports}))),d=n((function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports})),f=t(d),p=n((function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}));t(p);var h=n((function(e){var t=p.default;e.exports=function(e,n){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports}));t(h);var v=n((function(e){var t=p.default;e.exports=function(e){var n=h(e,"string");return"symbol"===t(n)?n:String(n)},e.exports.__esModule=!0,e.exports.default=e.exports}));t(v);var g=t(n((function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,v(r.key),r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports}))),m=n((function(e){var t=p.default;function n(){e.exports=n=function(){return r},e.exports.__esModule=!0,e.exports.default=e.exports;var r={},o=Object.prototype,i=o.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},l=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,i=Object.create(o.prototype),a=new A(r||[]);return s(i,"_invoke",{value:_(e,n,a)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}r.wrap=f;var h={};function v(){}function g(){}function m(){}var y={};d(y,l,(function(){return this}));var b=Object.getPrototypeOf,x=b&&b(b(E([])));x&&x!==o&&i.call(x,l)&&(y=x);var w=m.prototype=v.prototype=Object.create(y);function k(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function $(e,n){function r(o,s,a,l){var c=p(e[o],e,s);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==t(d)&&i.call(d,"__await")?n.resolve(d.__await).then((function(e){r("next",e,a,l)}),(function(e){r("throw",e,a,l)})):n.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,l)}))}l(c.arg)}var o;s(this,"_invoke",{value:function(e,t){function i(){return new n((function(n,o){r(e,t,n,o)}))}return o=o?o.then(i,i):i()}})}function _(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return j()}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var a=S(s,n);if(a){if(a===h)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=p(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}function S(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var o=p(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,h;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function E(e){if(e){var t=e[l];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:j}}function j(){return{value:void 0,done:!0}}return g.prototype=m,s(w,"constructor",{value:m,configurable:!0}),s(m,"constructor",{value:g,configurable:!0}),g.displayName=d(m,u,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,d(e,u,"GeneratorFunction")),e.prototype=Object.create(w),e},r.awrap=function(e){return{__await:e}},k($.prototype),d($.prototype,c,(function(){return this})),r.AsyncIterator=$,r.async=function(e,t,n,o,i){void 0===i&&(i=Promise);var s=new $(f(e,t,n,o),i);return r.isGeneratorFunction(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},k(w),d(w,u,"Generator"),d(w,l,(function(){return this})),d(w,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},r.values=E,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(a&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},r}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports}));t(m);var y=m(),b=y;try{regeneratorRuntime=y}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=y:Function("r","regeneratorRuntime = r")(y)}function x(){}function w(e){return e()}function k(){return Object.create(null)}function $(e){e.forEach(w)}function _(e){return"function"==typeof e}function S(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let O,P;function A(e,t){return O||(O=document.createElement("a")),O.href=t,e===O.href}function E(e,t){e.appendChild(t)}function j(e,t,n){e.insertBefore(t,n||null)}function I(e){e.parentNode&&e.parentNode.removeChild(e)}function M(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function L(e){return document.createElement(e)}function F(e){return document.createTextNode(e)}function R(){return F(" ")}function C(){return F("")}function T(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function N(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function U(e,t){t=""+t,e.data!==t&&(e.data=t)}function z(e){P=e}function D(){if(!P)throw new Error("Function called outside component initialization");return P}function B(e){D().$$.on_mount.push(e)}function G(){const e=D();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=function(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(e,n,r,t),o}(t,n,{cancelable:r});return o.slice().forEach((t=>{t.call(e,i)})),!i.defaultPrevented}return!0}}function q(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const V=[],H=[];let J=[];const Y=[],K=Promise.resolve();let X=!1;function Q(e){J.push(e)}function W(e){Y.push(e)}const Z=new Set;let ee=0;function te(){if(0!==ee)return;const e=P;do{try{for(;ee<V.length;){const e=V[ee];ee++,z(e),ne(e.$$)}}catch(e){throw V.length=0,ee=0,e}for(z(null),V.length=0,ee=0;H.length;)H.pop()();for(let e=0;e<J.length;e+=1){const t=J[e];Z.has(t)||(Z.add(t),t())}J.length=0}while(V.length);for(;Y.length;)Y.pop()();X=!1,Z.clear(),z(e)}function ne(e){if(null!==e.fragment){e.update(),$(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Q)}}const re=new Set;let oe;function ie(){oe={r:0,c:[],p:oe}}function se(){oe.r||$(oe.c),oe=oe.p}function ae(e,t){e&&e.i&&(re.delete(e),e.i(t))}function le(e,t,n,r){if(e&&e.o){if(re.has(e))return;re.add(e),oe.c.push((()=>{re.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}function ce(e,t){le(e,1,1,(()=>{t.delete(e.key)}))}function ue(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function de(e){e&&e.c()}function fe(e,t,n,r){const{fragment:o,after_update:i}=e.$$;o&&o.m(t,n),r||Q((()=>{const t=e.$$.on_mount.map(w).filter(_);e.$$.on_destroy?e.$$.on_destroy.push(...t):$(t),e.$$.on_mount=[]})),i.forEach(Q)}function pe(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];J.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),J=t}(n.after_update),$(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function he(e,t){-1===e.$$.dirty[0]&&(V.push(e),X||(X=!0,K.then(te)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ve(e,t,n,r,o,i,s,a=[-1]){const l=P;z(e);const c=e.$$={fragment:null,ctx:[],props:i,update:x,not_equal:o,bound:k(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:k(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};s&&s(c.root);let u=!1;if(c.ctx=n?n(e,t.props||{},((t,n,...r)=>{const i=r.length?r[0]:n;return c.ctx&&o(c.ctx[t],c.ctx[t]=i)&&(!c.skip_bound&&c.bound[t]&&c.bound[t](i),u&&he(e,t)),n})):[],c.update(),u=!0,$(c.before_update),c.fragment=!!r&&r(c.ctx),t.target){if(t.hydrate){const e=function(e){return Array.from(e.childNodes)}(t.target);c.fragment&&c.fragment.l(e),e.forEach(I)}else c.fragment&&c.fragment.c();t.intro&&ae(e.$$.fragment),fe(e,t.target,t.anchor,t.customElement),te()}z(l)}class ge{$destroy(){pe(this,1),this.$destroy=x}$on(e,t){if(!_(t))return x;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function me(e){let t,n,r,o,i,s,a,l,c,u,d,f,p,h,v,g,m,y,b,w,k,_,S,O,P,A,M,C=e[3].approve+"",z=e[3].disapprove+"";return{c(){t=L("div"),n=L("div"),r=R(),o=L("div"),i=L("header"),s=L("p"),a=F(e[0]),l=R(),c=L("button"),u=R(),d=L("section"),f=L("p"),p=F(e[1]),h=R(),v=L("label"),g=L("input"),m=R(),y=F(e[2]),b=R(),w=L("footer"),k=L("button"),_=F(C),S=R(),O=L("button"),P=F(z),N(n,"class","modal-background"),N(s,"class","modal-card-title"),N(c,"class","delete"),N(c,"aria-label","close"),N(i,"class","modal-card-head"),N(g,"type","checkbox"),N(g,"class","confirm-approval"),N(v,"class","checkbox"),N(d,"class","modal-card-body"),N(k,"class","button is-success confirm-approve"),k.disabled=e[5],N(O,"class","button confirm-disapprove"),N(w,"class","modal-card-foot"),N(o,"class","modal-card"),N(t,"class","modal is-active")},m(x,$){j(x,t,$),E(t,n),E(t,r),E(t,o),E(o,i),E(i,s),E(s,a),E(i,l),E(i,c),E(o,u),E(o,d),E(d,f),E(f,p),E(d,h),E(d,v),E(v,g),g.checked=e[4],E(v,m),E(v,y),E(o,b),E(o,w),E(w,k),E(k,_),E(w,S),E(w,O),E(O,P),A||(M=[T(c,"click",e[6]),T(g,"change",e[10]),T(k,"click",e[7]),T(O,"click",e[6])],A=!0)},p(e,[t]){1&t&&U(a,e[0]),2&t&&U(p,e[1]),16&t&&(g.checked=e[4]),4&t&&U(y,e[2]),8&t&&C!==(C=e[3].approve+"")&&U(_,C),32&t&&(k.disabled=e[5]),8&t&&z!==(z=e[3].disapprove+"")&&U(P,z)},i:x,o:x,d(e){e&&I(t),A=!1,$(M)}}}function ye(e,t,n){let r,o=!1,{title:i="title"}=t,{text:s="text"}=t,{approval:a="approval"}=t,{resolve:l=(()=>{})}=t,{reject:c=(()=>{})}=t,{label:u={approve:"Да",disapprove:"Нет"}}=t;return e.$$set=e=>{"title"in e&&n(0,i=e.title),"text"in e&&n(1,s=e.text),"approval"in e&&n(2,a=e.approval),"resolve"in e&&n(8,l=e.resolve),"reject"in e&&n(9,c=e.reject),"label"in e&&n(3,u=e.label)},e.$$.update=()=>{16&e.$$.dirty&&n(5,r=!o)},[i,s,a,u,o,r,function(){c()},function(){l()},l,c,function(){o=this.checked,n(4,o)}]}class be extends ge{constructor(e){super(),ve(this,e,ye,me,S,{title:0,text:1,approval:2,resolve:8,reject:9,label:3})}}var xe=function(){function e(){f(this,e)}return g(e,null,[{key:"ask",value:function(e){var t=e.title,n=e.text,r=e.approval;return new Promise((function(e,o){var i=new be({target:document.body,props:{title:t,text:n,approval:r,reject:function(){i.$destroy(),o()},resolve:function(){i.$destroy(),e()}}})}))}}]),e}();const we=[];function ke(e,t=x){let n;const r=new Set;function o(t){if(S(e,t)&&(e=t,n)){const t=!we.length;for(const t of r)t[1](),we.push(t,e);if(t){for(let e=0;e<we.length;e+=2)we[e][0](we[e+1]);we.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(i,s=x){const a=[i,s];return r.add(a),1===r.size&&(n=t(o)||x),i(e),()=>{r.delete(a),0===r.size&&n&&(n(),n=null)}}}}var $e={};function _e(e){return Object.hasOwn($e,e)}function Se(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return _e(e)?$e[e]:!!t&&Oe(e)}function Oe(e){return _e(e)||($e[e]={files:ke([]),selected:ke([]),uploads:ke([])}),$e[e]}var Pe=Object.freeze({__proto__:null,create:Oe,get:Se});function Ae(e){let t,n,r;return{c(){t=L("progress"),n=F(e[0]),r=F("%"),N(t,"class","progress is-link"),t.value=e[0],N(t,"max","100")},m(e,o){j(e,t,o),E(t,n),E(t,r)},p(e,r){1&r&&U(n,e[0]),1&r&&(t.value=e[0])},d(e){e&&I(t)}}}function Ee(e){let t,n,r,o,i,s,a,l,c,u=e[3].name+"",d=!e[2]&&je(e);return{c(){t=L("figure"),d&&d.c(),n=R(),r=L("img"),s=R(),a=L("div"),l=L("div"),c=F(u),N(r,"draggable","true"),A(r.src,o=e[3].path.small.cloud.Location)||N(r,"src",o),N(r,"alt",i=e[3].name),N(r,"crossorigin","anonymous"),N(r,"class","svelte-evde9a"),N(l,"class","text svelte-evde9a"),N(a,"draggable","true"),N(a,"class","middle svelte-evde9a"),N(t,"class","image is-4by3 svelte-evde9a")},m(e,o){j(e,t,o),d&&d.m(t,null),E(t,n),E(t,r),E(t,s),E(t,a),E(a,l),E(l,c)},p(e,s){e[2]?d&&(d.d(1),d=null):d?d.p(e,s):(d=je(e),d.c(),d.m(t,n)),8&s&&!A(r.src,o=e[3].path.small.cloud.Location)&&N(r,"src",o),8&s&&i!==(i=e[3].name)&&N(r,"alt",i),8&s&&u!==(u=e[3].name+"")&&U(c,u)},d(e){e&&I(t),d&&d.d()}}}function je(e){let t,n,r;return{c(){t=L("button"),N(t,"class","delete svelte-evde9a")},m(o,i){j(o,t,i),n||(r=T(t,"click",e[6]),n=!0)},p:x,d(e){e&&I(t),n=!1,r()}}}function Ie(e){let t,n,r,o,i,s,a=e[1]&&Ae(e),l=e[3].path&&Ee(e);return{c(){t=L("div"),a&&a.c(),n=R(),l&&l.c(),N(t,"class",r="column file-tile is-one-quarter-desktop is-half-mobile "+e[4]+" svelte-evde9a"),N(t,"data-uuid",o=e[3].uuid)},m(r,o){j(r,t,o),a&&a.m(t,null),E(t,n),l&&l.m(t,null),i||(s=T(t,"click",e[5]),i=!0)},p(e,[i]){e[1]?a?a.p(e,i):(a=Ae(e),a.c(),a.m(t,n)):a&&(a.d(1),a=null),e[3].path?l?l.p(e,i):(l=Ee(e),l.c(),l.m(t,null)):l&&(l.d(1),l=null),16&i&&r!==(r="column file-tile is-one-quarter-desktop is-half-mobile "+e[4]+" svelte-evde9a")&&N(t,"class",r),8&i&&o!==(o=e[3].uuid)&&N(t,"data-uuid",o)},i:x,o:x,d(e){e&&I(t),a&&a.d(),l&&l.d(),i=!1,s()}}}function Me(e,t,n){let r;const o=G();let{progress:i=0}=t,{selected:s=!1}=t,{notUploaded:a=!1}=t,{selectMany:l=!1}=t,{hideDeleteButton:c=!1}=t,{bucketId:u}=t,{data:d={name:"default.file.name",size:1e3,preview:!1}}=t;return B((()=>{Se(u).selected.subscribe((e=>{e.indexOf(d.uuid)>-1?n(7,s=!0):n(7,s=!1)}))})),e.$$set=e=>{"progress"in e&&n(0,i=e.progress),"selected"in e&&n(7,s=e.selected),"notUploaded"in e&&n(1,a=e.notUploaded),"selectMany"in e&&n(8,l=e.selectMany),"hideDeleteButton"in e&&n(2,c=e.hideDeleteButton),"bucketId"in e&&n(9,u=e.bucketId),"data"in e&&n(3,d=e.data)},e.$$.update=()=>{128&e.$$.dirty&&n(4,r=s?"selected":"")},[i,a,c,d,r,function(){Se(u).selected.update((e=>(e.indexOf(d.uuid)>-1?e.splice(e.indexOf(d.uuid),1):(l?e.push(d.uuid):e.splice(0,e.length,d.uuid),o("selected")),e)))},function(){xe.ask({title:`Удаление файла (${d.name}) `,text:"Файл будет удалён без возможнеости восстановления!",approval:"Удалить файл?"}).then((()=>{o("remove",d)})).catch((()=>{}))},s,l,u]}class Le extends ge{constructor(e){super(),ve(this,e,Me,Ie,S,{progress:0,selected:7,notUploaded:1,selectMany:8,hideDeleteButton:2,bucketId:9,data:3})}}function Fe(e,t,n){const r=e.slice();return r[24]=t[n],r[25]=t,r[26]=n,r}function Re(e,t,n){const r=e.slice();return r[24]=t[n],r[27]=t,r[28]=n,r}function Ce(e){let t,n,r,o=e[0],i=[];for(let t=0;t<o.length;t+=1)i[t]=Te(Re(e,o,t));const s=e=>le(i[e],1,1,(()=>{i[e]=null}));return{c(){t=L("div"),n=L("div");for(let e=0;e<i.length;e+=1)i[e].c();N(n,"class","file-list columns is-mobile is-multiline svelte-oq452y"),N(t,"class","file-list-wrapper svelte-oq452y")},m(o,s){j(o,t,s),E(t,n);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(n,null);e[19](t),r=!0},p(e,t){if(4141&t){let r;for(o=e[0],r=0;r<o.length;r+=1){const s=Re(e,o,r);i[r]?(i[r].p(s,t),ae(i[r],1)):(i[r]=Te(s),i[r].c(),ae(i[r],1),i[r].m(n,null))}for(ie(),r=o.length;r<i.length;r+=1)s(r);se()}},i(e){if(!r){for(let e=0;e<o.length;e+=1)ae(i[e]);r=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)le(i[e]);r=!1},d(n){n&&I(t),M(i,n),e[19](null)}}}function Te(e){let t,n,r;function o(t){e[17](t,e[24],e[27],e[28])}let i={elementSize:e[5],bucketId:e[2],selectMany:e[3]};return void 0!==e[24]&&(i.data=e[24]),t=new Le({props:i}),H.push((()=>ue(t,"data",o))),t.$on("remove",e[12]),t.$on("selected",e[18]),{c(){de(t.$$.fragment)},m(e,n){fe(t,e,n),r=!0},p(r,o){e=r;const i={};32&o&&(i.elementSize=e[5]),4&o&&(i.bucketId=e[2]),8&o&&(i.selectMany=e[3]),!n&&1&o&&(n=!0,i.data=e[24],W((()=>n=!1))),t.$set(i)},i(e){r||(ae(t.$$.fragment,e),r=!0)},o(e){le(t.$$.fragment,e),r=!1},d(e){pe(t,e)}}}function Ne(e){let t,n,r,o,i,s,a,l,c,u,d,f,p,h,v,g,m,y,b,x,w,k=[],_=new Map,S=e[0];const O=e=>e[24].id;for(let t=0;t<S.length;t+=1){let n=Fe(e,S,t),r=O(n);_.set(r,k[t]=Ue(r,n))}return{c(){t=L("div"),n=L("div"),r=R(),o=L("div"),i=L("header"),s=L("p"),s.textContent="Выберите файл",a=R(),l=L("button"),c=R(),u=L("section"),d=L("div");for(let e=0;e<k.length;e+=1)k[e].c();f=R(),p=L("footer"),h=L("button"),h.textContent="Выбрать",v=R(),g=L("button"),g.textContent="Удалить",m=R(),y=L("button"),y.textContent="Закрыть",N(n,"class","modal-background"),N(s,"class","modal-card-title"),N(l,"class","delete"),N(l,"aria-label","close"),N(i,"class","modal-card-head"),N(d,"class","file-list columns is-multiline svelte-oq452y"),N(u,"class","modal-card-body"),N(h,"class","button is-success"),N(g,"class","button is-danger"),N(y,"class","button"),N(p,"class","modal-card-foot"),N(o,"class","modal-card"),N(t,"class","modal is-active")},m($,_){j($,t,_),E(t,n),E(t,r),E(t,o),E(o,i),E(i,s),E(i,a),E(i,l),E(o,c),E(o,u),E(u,d);for(let e=0;e<k.length;e+=1)k[e]&&k[e].m(d,null);E(o,f),E(o,p),E(p,h),E(p,v),E(p,g),E(p,m),E(p,y),e[22](t),b=!0,x||(w=[T(l,"click",e[8]),T(h,"click",e[10]),T(g,"click",e[11]),T(y,"click",e[9])],x=!0)},p(e,t){4109&t&&(S=e[0],ie(),k=function(e,t,n,r,o,i,s,a,l,c,u,d){let f=e.length,p=i.length,h=f;const v={};for(;h--;)v[e[h].key]=h;const g=[],m=new Map,y=new Map,b=[];for(h=p;h--;){const e=d(o,i,h),a=n(e);let l=s.get(a);l?r&&b.push((()=>l.p(e,t))):(l=c(a,e),l.c()),m.set(a,g[h]=l),a in v&&y.set(a,Math.abs(h-v[a]))}const x=new Set,w=new Set;function k(e){ae(e,1),e.m(a,u),s.set(e.key,e),u=e.first,p--}for(;f&&p;){const t=g[p-1],n=e[f-1],r=t.key,o=n.key;t===n?(u=t.first,f--,p--):m.has(o)?!s.has(r)||x.has(r)?k(t):w.has(o)?f--:y.get(r)>y.get(o)?(w.add(r),k(t)):(x.add(o),f--):(l(n,s),f--)}for(;f--;){const t=e[f];m.has(t.key)||l(t,s)}for(;p;)k(g[p-1]);return $(b),g}(k,t,O,1,e,S,_,d,ce,Ue,null,Fe),se())},i(e){if(!b){for(let e=0;e<S.length;e+=1)ae(k[e]);b=!0}},o(e){for(let e=0;e<k.length;e+=1)le(k[e]);b=!1},d(n){n&&I(t);for(let e=0;e<k.length;e+=1)k[e].d();e[22](null),x=!1,$(w)}}}function Ue(e,t){let n,r,o,i;function s(e){t[20](e,t[24],t[25],t[26])}let a={bucketId:t[2],selectMany:t[3]};return void 0!==t[24]&&(a.data=t[24]),r=new Le({props:a}),H.push((()=>ue(r,"data",s))),r.$on("remove",t[12]),r.$on("selected",t[21]),{key:e,first:null,c(){n=C(),de(r.$$.fragment),this.first=n},m(e,t){j(e,n,t),fe(r,e,t),i=!0},p(e,n){t=e;const i={};4&n&&(i.bucketId=t[2]),8&n&&(i.selectMany=t[3]),!o&&1&n&&(o=!0,i.data=t[24],W((()=>o=!1))),r.$set(i)},i(e){i||(ae(r.$$.fragment,e),i=!0)},o(e){le(r.$$.fragment,e),i=!1},d(e){e&&I(n),pe(r,e)}}}function ze(e){let t,n,r,o=!e[4]&&e[1]&&Ce(e),i=e[4]&&e[1]&&Ne(e);return{c(){o&&o.c(),t=R(),i&&i.c(),n=C()},m(e,s){o&&o.m(e,s),j(e,t,s),i&&i.m(e,s),j(e,n,s),r=!0},p(e,[r]){!e[4]&&e[1]?o?(o.p(e,r),18&r&&ae(o,1)):(o=Ce(e),o.c(),ae(o,1),o.m(t.parentNode,t)):o&&(ie(),le(o,1,1,(()=>{o=null})),se()),e[4]&&e[1]?i?(i.p(e,r),18&r&&ae(i,1)):(i=Ne(e),i.c(),ae(i,1),i.m(n.parentNode,n)):i&&(ie(),le(i,1,1,(()=>{i=null})),se())},i(e){r||(ae(o),ae(i),r=!0)},o(e){le(o),le(i),r=!1},d(e){o&&o.d(e),e&&I(t),i&&i.d(e),e&&I(n)}}}function De(e,t,n){let r=null,o=null;const i=G();let{files:s=[]}=t,{selected:a=[]}=t,{id:l}=t,{selectMany:c}=t,{popup:u=!1}=t,{show:d=!1}=t,{elementSize:f=3}=t,{onReject:p}=t,{onResolve:h}=t;function v(){n(1,d=!1)}return B((()=>{Se(l).files.subscribe((e=>{s.forEach(((e,t)=>{e.id=t})),n(0,s=e)})),Se(l).selected.subscribe((e=>{n(13,a=e)}))})),e.$$set=e=>{"files"in e&&n(0,s=e.files),"selected"in e&&n(13,a=e.selected),"id"in e&&n(2,l=e.id),"selectMany"in e&&n(3,c=e.selectMany),"popup"in e&&n(4,u=e.popup),"show"in e&&n(1,d=e.show),"elementSize"in e&&n(5,f=e.elementSize),"onReject"in e&&n(14,p=e.onReject),"onResolve"in e&&n(15,h=e.onResolve)},[s,d,l,c,u,f,r,o,v,function(){v(),p?(p(),n(14,p=null)):i("reject")},function(){if(v(),a.length){let e=s.filter((e=>a.indexOf(e.uuid)>-1));h?(h(e),n(15,h=null)):i("resolve",{selected:e})}else h?(h([]),n(15,h=null)):i("resolve",{selected:[]})},function(){xe.ask({title:`Удаление файлов (${a.length}) `,text:"Файлы будут удалены без возможнеости восстановления!",approval:"Удалить файлы?"}).then((()=>{console.log("remove approved"),i("remove",{selected:a})})).catch((()=>{console.log("remove disapprove")}))},function(e){console.log("removeFile",e),i("remove",{selected:[e.detail.uuid]})},a,p,h,function(e){Se(l).update((t=>(t.splice(0,t.length,...e),t)))},function(e,t,r,o){r[o]=e,n(0,s)},function(t){q.call(this,e,t)},function(e){H[e?"unshift":"push"]((()=>{r=e,n(6,r)}))},function(e,t,r,o){r[o]=e,n(0,s)},function(t){q.call(this,e,t)},function(e){H[e?"unshift":"push"]((()=>{o=e,n(7,o)}))}]}class Be extends ge{constructor(e){super(),ve(this,e,De,ze,S,{files:0,selected:13,id:2,selectMany:3,popup:4,show:1,elementSize:5,onReject:14,onResolve:15,updateFiles:16})}get updateFiles(){return this.$$.ctx[16]}}function Ge(e){let t;return{c(){t=L("progress"),N(t,"class","progress is-link")},m(e,n){j(e,t,n)},d(e){e&&I(t)}}}function qe(e){let t,n,r,o;return{c(){t=L("figure"),n=L("img"),N(n,"alt",r=e[1].name),A(n.src,o=e[1].preview)||N(n,"src",o),N(n,"class","svelte-1d8gg06"),N(t,"class","image is-4by3 svelte-1d8gg06")},m(e,r){j(e,t,r),E(t,n)},p(e,t){2&t&&r!==(r=e[1].name)&&N(n,"alt",r),2&t&&!A(n.src,o=e[1].preview)&&N(n,"src",o)},d(e){e&&I(t)}}}function Ve(e){let t,n,r,o=!e[0]&&Ge(),i=e[1].preview&&qe(e);return{c(){t=L("div"),o&&o.c(),n=R(),i&&i.c(),N(t,"class","tile file is-3 is-child svelte-1d8gg06"),N(t,"data-id",r=e[1].id)},m(e,r){j(e,t,r),o&&o.m(t,null),E(t,n),i&&i.m(t,null)},p(e,[s]){e[0]?o&&(o.d(1),o=null):o||(o=Ge(),o.c(),o.m(t,n)),e[1].preview?i?i.p(e,s):(i=qe(e),i.c(),i.m(t,null)):i&&(i.d(1),i=null),2&s&&r!==(r=e[1].id)&&N(t,"data-id",r)},i:x,o:x,d(e){e&&I(t),o&&o.d(),i&&i.d()}}}function He(e,t,n){let{uploaded:r=!1}=t,{data:o={name:"default.file.name",size:1e3,preview:!1}}=t;return e.$$set=e=>{"uploaded"in e&&n(0,r=e.uploaded),"data"in e&&n(1,o=e.data)},[r,o]}class Je extends ge{constructor(e){super(),ve(this,e,He,Ve,S,{uploaded:0,data:1})}}function Ye(e,t,n){const r=e.slice();return r[11]=t[n],r}function Ke(e){let t,n,r,o,i,s,a,l,c,u,d,f;const p=[Qe,Xe],h=[];function v(e,t){return 0===e[0].length?0:1}return a=v(e),l=h[a]=p[a](e),{c(){t=L("div"),n=L("label"),r=L("form"),o=L("input"),i=F("\n                Выберите изображения для загрузки"),s=R(),l.c(),c=C(),N(o,"class","file-input"),N(o,"type","file"),N(o,"name","file"),N(o,"accept","image/*"),o.multiple="true",N(r,"action","./"),N(r,"class","svelte-112twgk"),N(n,"for","file"),N(n,"class","svelte-112twgk"),N(t,"class","box has-background-light is-size-4-desktop is-size-5-mobile dropzone svelte-112twgk")},m(l,p){j(l,t,p),E(t,n),E(n,r),E(r,o),E(r,i),e[7](t),j(l,s,p),h[a].m(l,p),j(l,c,p),u=!0,d||(f=T(o,"change",e[5]),d=!0)},p(e,t){let n=a;a=v(e),a===n?h[a].p(e,t):(ie(),le(h[n],1,1,(()=>{h[n]=null})),se(),l=h[a],l?l.p(e,t):(l=h[a]=p[a](e),l.c()),ae(l,1),l.m(c.parentNode,c))},i(e){u||(ae(l),u=!0)},o(e){le(l),u=!1},d(n){n&&I(t),e[7](null),n&&I(s),h[a].d(n),n&&I(c),d=!1,f()}}}function Xe(e){let t,n,r,o=e[0].length>0&&We(e);return{c(){t=L("div"),o&&o.c(),N(t,"class",n="previews "+(e[3]?"short":"long")+" svelte-112twgk")},m(e,n){j(e,t,n),o&&o.m(t,null),r=!0},p(e,i){e[0].length>0?o?(o.p(e,i),1&i&&ae(o,1)):(o=We(e),o.c(),ae(o,1),o.m(t,null)):o&&(ie(),le(o,1,1,(()=>{o=null})),se()),(!r||8&i&&n!==(n="previews "+(e[3]?"short":"long")+" svelte-112twgk"))&&N(t,"class",n)},i(e){r||(ae(o),r=!0)},o(e){le(o),r=!1},d(e){e&&I(t),o&&o.d()}}}function Qe(e){let t;return{c(){t=L("div"),t.innerHTML='<h2 class="subtitle">Нет загружаемых файлов</h2>',N(t,"class","previews has-text-centered svelte-112twgk")},m(e,n){j(e,t,n)},p:x,i:x,o:x,d(e){e&&I(t)}}}function We(e){let t,n,r=e[0],o=[];for(let t=0;t<r.length;t+=1)o[t]=Ze(Ye(e,r,t));const i=e=>le(o[e],1,1,(()=>{o[e]=null}));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=C()},m(e,r){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,r);j(e,t,r),n=!0},p(e,n){if(5&n){let s;for(r=e[0],s=0;s<r.length;s+=1){const i=Ye(e,r,s);o[s]?(o[s].p(i,n),ae(o[s],1)):(o[s]=Ze(i),o[s].c(),ae(o[s],1),o[s].m(t.parentNode,t))}for(ie(),s=r.length;s<o.length;s+=1)i(s);se()}},i(e){if(!n){for(let e=0;e<r.length;e+=1)ae(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)le(o[e]);n=!1},d(e){M(o,e),e&&I(t)}}}function Ze(e){let t,n;return t=new Je({props:{bucketId:e[2],data:e[11]}}),{c(){de(t.$$.fragment)},m(e,r){fe(t,e,r),n=!0},p(e,n){const r={};4&n&&(r.bucketId=e[2]),1&n&&(r.data=e[11]),t.$set(r)},i(e){n||(ae(t.$$.fragment,e),n=!0)},o(e){le(t.$$.fragment,e),n=!1},d(e){pe(t,e)}}}function et(e){let t,n,r=e[1]&&Ke(e);return{c(){r&&r.c(),t=C()},m(e,o){r&&r.m(e,o),j(e,t,o),n=!0},p(e,[n]){e[1]?r?(r.p(e,n),2&n&&ae(r,1)):(r=Ke(e),r.c(),ae(r,1),r.m(t.parentNode,t)):r&&(ie(),le(r,1,1,(()=>{r=null})),se())},i(e){n||(ae(r),n=!0)},o(e){le(r),n=!1},d(e){r&&r.d(e),e&&I(t)}}}function tt(e,t,n){const r=G();let o,{id:i}=t,{uploads:s=[]}=t,{show:a=!1}=t,{short:l=!1}=t;return B((()=>{Se(i,!0).uploads.subscribe((e=>{n(0,s=e)})),o&&(o.addEventListener("dragenter",(function(e){e.preventDefault(),e.stopPropagation(),o.classList.add("has-background-white")})),o.addEventListener("dragleave",(function(e){e.preventDefault(),e.stopPropagation(),o.classList.remove("has-background-white")})),o.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation()})),o.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation(),o.classList.remove("has-background-white"),r("filesAdded",e.dataTransfer.files)})))})),e.$$set=e=>{"id"in e&&n(2,i=e.id),"uploads"in e&&n(0,s=e.uploads),"show"in e&&n(1,a=e.show),"short"in e&&n(3,l=e.short)},[s,a,i,l,o,function(e){r("filesAdded",e.target.files)},function(){n(1,a=!1),r("resolve")},function(e){H[e?"unshift":"push"]((()=>{o=e,n(4,o)}))}]}class nt extends ge{constructor(e){super(),ve(this,e,tt,et,S,{id:2,uploads:0,show:1,short:3,resolvePopup:6})}get resolvePopup(){return this.$$.ctx[6]}}function rt(e){let t,n,r,o,i,s,a,l,c,u,d,f,p,h,v,g,m,y=!e[3]&&ot(e);function b(t){e[18](t)}let x={popup:!1,show:!0,short:!0};function w(t){e[19](t)}function k(t){e[20](t)}void 0!==e[0]&&(x.id=e[0]),l=new nt({props:x}),H.push((()=>ue(l,"id",b))),l.$on("filesAdded",e[10]);let $={popup:!1,show:!0};void 0!==e[0]&&($.id=e[0]),void 0!==e[1]&&($.selectMany=e[1]),d=new Be({props:$}),H.push((()=>ue(d,"id",w))),H.push((()=>ue(d,"selectMany",k))),d.$on("remove",e[12]),d.$on("selected",e[9]);let _=!e[3]&&it(e);return{c(){t=L("div"),n=L("div"),r=R(),o=L("div"),y&&y.c(),i=R(),s=L("section"),a=L("div"),de(l.$$.fragment),u=R(),de(d.$$.fragment),h=R(),_&&_.c(),N(n,"class","modal-background"),N(a,"class","container"),N(s,"class","modal-card-body"),N(o,"class","modal-card box is-rounded"),N(t,"class","modal is-active")},m(c,f){j(c,t,f),E(t,n),E(t,r),E(t,o),y&&y.m(o,null),E(o,i),E(o,s),E(s,a),fe(l,a,null),E(a,u),fe(d,a,null),E(o,h),_&&_.m(o,null),v=!0,g||(m=T(n,"click",e[8]),g=!0)},p(e,t){e[3]?y&&(y.d(1),y=null):y?y.p(e,t):(y=ot(e),y.c(),y.m(o,i));const n={};!c&&1&t&&(c=!0,n.id=e[0],W((()=>c=!1))),l.$set(n);const r={};!f&&1&t&&(f=!0,r.id=e[0],W((()=>f=!1))),!p&&2&t&&(p=!0,r.selectMany=e[1],W((()=>p=!1))),d.$set(r),e[3]?_&&(_.d(1),_=null):_?_.p(e,t):(_=it(e),_.c(),_.m(o,null))},i(e){v||(ae(l.$$.fragment,e),ae(d.$$.fragment,e),v=!0)},o(e){le(l.$$.fragment,e),le(d.$$.fragment,e),v=!1},d(e){e&&I(t),y&&y.d(),pe(l),pe(d),_&&_.d(),g=!1,m()}}}function ot(e){let t,n,r,o,i,s;return{c(){t=L("header"),n=L("p"),n.textContent="Добавьте файлы для загрузки",r=R(),o=L("button"),N(n,"class","modal-card-title"),N(o,"class","delete"),N(o,"aria-label","close"),N(t,"class","modal-card-head")},m(a,l){j(a,t,l),E(t,n),E(t,r),E(t,o),i||(s=T(o,"click",e[6]),i=!0)},p:x,d(e){e&&I(t),i=!1,s()}}}function it(e){let t,n,r,o,i,s,a,l;return{c(){t=L("footer"),n=L("button"),n.textContent="Выбрать",r=R(),o=L("button"),o.textContent="Удалить",i=R(),s=L("button"),s.textContent="Закрыть",N(n,"class","button is-success"),N(o,"class","button is-danger"),N(s,"class","button"),N(t,"class","modal-card-foot")},m(c,u){j(c,t,u),E(t,n),E(t,r),E(t,o),E(t,i),E(t,s),a||(l=[T(n,"click",e[7]),T(o,"click",e[11]),T(s,"click",e[8])],a=!0)},p:x,d(e){e&&I(t),a=!1,$(l)}}}function st(e){let t,n,r,o;return t=new nt({props:{popup:!1,show:!0,id:e[0]}}),t.$on("filesAdded",e[10]),r=new Be({props:{popup:!1,elementSize:e[5],show:!0,id:e[0],selectMany:!1}}),r.$on("remove",e[12]),{c(){de(t.$$.fragment),n=R(),de(r.$$.fragment)},m(e,i){fe(t,e,i),j(e,n,i),fe(r,e,i),o=!0},p(e,n){const o={};1&n&&(o.id=e[0]),t.$set(o);const i={};32&n&&(i.elementSize=e[5]),1&n&&(i.id=e[0]),r.$set(i)},i(e){o||(ae(t.$$.fragment,e),ae(r.$$.fragment,e),o=!0)},o(e){le(t.$$.fragment,e),le(r.$$.fragment,e),o=!1},d(e){pe(t,e),e&&I(n),pe(r,e)}}}function at(e){let t,n,r,o=e[4]&&e[2]&&rt(e),i=!e[4]&&e[2]&&st(e);return{c(){o&&o.c(),t=R(),i&&i.c(),n=C()},m(e,s){o&&o.m(e,s),j(e,t,s),i&&i.m(e,s),j(e,n,s),r=!0},p(e,[r]){e[4]&&e[2]?o?(o.p(e,r),20&r&&ae(o,1)):(o=rt(e),o.c(),ae(o,1),o.m(t.parentNode,t)):o&&(ie(),le(o,1,1,(()=>{o=null})),se()),!e[4]&&e[2]?i?(i.p(e,r),20&r&&ae(i,1)):(i=st(e),i.c(),ae(i,1),i.m(n.parentNode,n)):i&&(ie(),le(i,1,1,(()=>{i=null})),se())},i(e){r||(ae(o),ae(i),r=!0)},o(e){le(o),le(i),r=!1},d(e){o&&o.d(e),e&&I(t),i&&i.d(e),e&&I(n)}}}function lt(e,t,n){const r=G();B((()=>{Se(o).files.subscribe((e=>{n(13,i=e)})),Se(o).selected.subscribe((e=>{n(14,s=e)}))}));let{id:o}=t,{files:i=[]}=t,{selected:s=[]}=t,{selectMany:a}=t,{selectOnClick:l}=t,{short:c=!1}=t,{show:u=!0}=t,{popup:d=!0}=t,{elementSize:f=3}=t,{onReject:p}=t,{onResolve:h}=t;function v(){n(2,u=!1)}function g(){if(v(),s.length){let e=i.filter((e=>s.indexOf(e.uuid)>-1));h?(h(e),n(16,h=null)):r("resolve",{selected:e})}else h?(h([]),n(16,h=null)):r("resolve",{selected:[]})}return e.$$set=e=>{"id"in e&&n(0,o=e.id),"files"in e&&n(13,i=e.files),"selected"in e&&n(14,s=e.selected),"selectMany"in e&&n(1,a=e.selectMany),"selectOnClick"in e&&n(17,l=e.selectOnClick),"short"in e&&n(3,c=e.short),"show"in e&&n(2,u=e.show),"popup"in e&&n(4,d=e.popup),"elementSize"in e&&n(5,f=e.elementSize),"onReject"in e&&n(15,p=e.onReject),"onResolve"in e&&n(16,h=e.onResolve)},[o,a,u,c,d,f,v,g,function(){v(),p?(p(),n(15,p=null)):r("reject")},function(){l&&g()},function(e){r("filesAdded",e.detail)},function(){xe.ask({title:`Удаление файлов (${s.length}) `,text:"Файлы будут удалены без возможнеости восстановления!",approval:"Удалить файлы?"}).then((()=>{r("remove",{selected:s})})).catch((()=>{}))},function(e){r("remove",{selected:e.detail.selected})},i,s,p,h,l,function(e){o=e,n(0,o)},function(e){o=e,n(0,o)},function(e){a=e,n(1,a)}]}class ct extends ge{constructor(e){super(),ve(this,e,lt,at,S,{id:0,files:13,selected:14,selectMany:1,selectOnClick:17,short:3,show:2,popup:4,elementSize:5,onReject:15,onResolve:16})}}var ut={model:"file",url:"/api/:modelName",fields:{},actions:{create:{method:"PUT",isArray:!1,data:["record"],postFix:"/:bucket?",rules:[{auth:!0,root:!0},{auth:!0,root:!1},{auth:!1,root:!1}]},list:{method:"GET",isArray:!0,data:["pager","sorter","filter","search"],fields:["_id","fileID","name","extension","bucket","metadata","path","paths","userIp","userId","session","width","height","size"],rules:[{auth:!0,root:!0},{auth:!0,root:!1},{auth:!1,root:!1}]},listAndCount:{method:"get",data:["pager","sorter","filter","search"],fields:["_id","fileID","name","extension","bucket","metadata","path","paths","userIp","userId","session","width","height","size"],rules:[{auth:!0,root:!0},{auth:!0,role:"root"}],postFix:"/:actionName"},get:{method:"GET",isArray:!1,postFix:"/:record[_id]",data:["filter","record"],fields:["_id","fileID","name","extension","bucket","metadata","path","paths","userIp","userId","session","width","height","size"],rules:[{auth:!0,root:!0},{auth:!0,root:!1},{auth:!1,root:!1}]},getRaw:{method:"GET",isArray:!1,postFix:"/:record[_id]",data:["filter","record"],fields:["_id","fileID","name","extension","bucket","metadata","path","paths","userIp","userId","session","width","height","size"],rules:[{auth:!0,root:!0},{auth:!0,root:!1},{auth:!1,root:!1}]},delete:{method:"DELETE",postFix:"/:record[_id]",isArray:!1,rules:[{auth:!0,root:!0},{auth:!0,root:!1},{auth:!1,root:!1}]}}};const dt=".",ft=":",pt="::",ht="()";var vt=class{static get SUB_PATH_START(){return"{"}static get SUB_PATH_END(){return"}"}static get PATH_SPLIT(){return dt}static get PATH_START_OBJECT(){return ft}static get PATH_START_HELPERS(){return pt}static get FUNCTION_MARKER(){return ht}static get MAX_DEEP(){return 10}static findNextSubPath(e){let t="",n=!1;for(let r=0;r<e.length;r++)if("{"===e[r])n=!0,t="";else{if("}"===e[r]&&n)return t;t+=e[r]}return n?t:null}static replaceSubPath(e,t,n){let r="{"+t+"}",o=0;for(;e.indexOf(r)>-1&&o<10;)e=e.replace(r,n),o++;return e}static parseSubs(e,t,n){let r,o=this.findNextSubPath(e),i=0;for(;o&&(r=this.getValueByPath(o.indexOf(pt)>-1?n:t,o,t,n),e=this.replaceSubPath(e,o,r),i++,!(i>10));)o=this.findNextSubPath(e);return e}static get(e,t,n){switch(e){case ft:return t;case pt:return n}return e=this.parseSubs(e,t,n),this.getValueByPath(e.indexOf(pt)>-1?n:t,e,t,n)}static set(e,t,n,r){3===arguments.length&&(r=n,n=void 0);let o,i=this.findNextSubPath(e),s=0;for(;i&&(o=this.getValueByPath(i.indexOf(pt)>-1?n:t,i,t,n),e=this.replaceSubPath(e,i,o),!(s>10));)i=this.findNextSubPath(e),s++;this.setValueByPath(t,e,r),t.isRecord&&this.normilizePath(e).length>1&&t.__isActive&&t.trigger("change",t,e,r)}static unset(e,t,n){this.set(e,t,n,null)}static parsePathStep(e,t,n){let r=null;if(0===e.indexOf(pt)&&n){if(r=e.replace(pt,""),r.indexOf(ht)!==r.length-2)return n[r];if(r=r.replace(ht,""),Object.prototype.hasOwnProperty.call(n,r))return n[r](t,void 0)}else if(0===e.indexOf(ft)&&t){if(r=e.replace(ft,""),r.indexOf(ht)!==r.length-2)return t[r];if(r=r.replace(ht,""),Object.prototype.hasOwnProperty.call(t,r))return t[r](t,void 0)}return e}static parsePath(e,t,n){Array.isArray(e)||(e=e.split(dt));for(var r=0;r<e.length;r++)e[r]=this.parsePathStep(e[r],t,n);return e}static normilizePath(e){if(Array.isArray(e))return e;for(;e.indexOf(ft)>-1;)e=e.replace(ft,"");return e.split(dt)}static ifFullSubPath(e,t){if(e.length<t.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}static getValueByPath(e,t,n,r){let o=(t=this.normilizePath(t)).shift(),i=o.indexOf(ht)>-1;if(i&&(o=o.replace(ht,"")),("object"==typeof e||"function"==typeof e)&&null!=e&&void 0!==e[o]&&null!==e[o]){let s=i?e[o]({item:n,helpers:r}):e[o];return t.length>0?this.getValueByPath(s,t,n,r):s}}static setValueByPath(e,t,n){let r=(t=this.normilizePath(t)).shift();t.length>0?(Object.prototype.hasOwnProperty.call(e,r)||(e[r]={}),this.setValueByPath(e[r],t,n)):e[r]=n}static join(){return Array.prototype.slice.call(arguments).join(dt)}},gt=vt;function mt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return yt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}function yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var bt=["_id","id","ID"],xt={},wt={};var kt=function(){function e(t,n){return f(this,e),this.options=n,this.manifest=t,this.working={},this.initActions(),this}return g(e,[{key:"initActions",value:function(){if(this.getActionsCount()>0){var e=this.getActions();for(var t in e)this.initAction(t,e[t])}}},{key:"initAction",value:function(e){var t=this;Object.prototype.hasOwnProperty.call(this,["$"+e])||(this["$"+e]=function(n,r){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;return t.request(t,e,n,r,o,i)})}},{key:"request",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5?arguments[5]:void 0,s=Object.assign({},e,n),a=this.getActionData(t),l=this.collectRequestData(a),c=this.encodeRequest(l),u=this.getServerURL(),d=this.getURL(s,a,t),f={};if(o){d=this.getURL(n,a,t),console.log("request url for file upload",d);var p=new FormData;p.append("file",i),f.body=p}else-1===["OPTIONS","GET"].indexOf(a.method.toUpperCase())&&(f={body:e});return f.method=a.method.toUpperCase(),r&&(f.headers=r),fetch(u+d+c,f).then((function(e){return e.json()}))}},{key:"getModelName",value:function(){return this&&this.manifest?this.manifest.model:null}},{key:"getActionData",value:function(e){return this.getActions()&&this.getActions()[e]?this.getActions()[e]:null}},{key:"getActionsCount",value:function(){return this.getActions()?Object.keys(this.getActions()).length:0}},{key:"getActions",value:function(){return this.manifest&&this.manifest.actions?this.manifest.actions:{}}},{key:"parseParams",value:function(e,t,n,r){for(var o="",i=e.length;n.indexOf(e)>-1;){var s=n.indexOf(e)+i,a=n.indexOf(t);if(""==(o=n.slice(s,a)))break;console.log(e+o+t,gt.get(o,r)),n=n.replace(e+o+t,gt.get(o,r))}return n}},{key:"parseLine",value:function(e,t,n){return e=(e=e.replace(":modelName",this.manifest.model)).replace(":actionName",n),e=this.parseParams(":record[","]",e,t),e=this.parseParams(":","?",e,t)}},{key:"getURL",value:function(e,t,n){return this.parseLine(this.manifest.url,e,n)+(Object.prototype.hasOwnProperty.call(t,"postFix")?this.parseLine(t.postFix,e,n):"")}},{key:"getServerURL",value:function(){return this.options.server}},{key:"encodeRequest",value:function(e){var t="?";for(var n in e)void 0!==e[n]&&null!==e[n]&&(t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n].constructor===Object?JSON.stringify(e[n]):e[n])+"&");return this.options.test&&(t+="&test=1",this.options.test.session&&(t+="&session="+this.options.test.session),this.options.test.session&&(t+="&role="+this.options.test.role)),t}},{key:"collectRequestData",value:function(e){var t,n={};if(Object.prototype.hasOwnProperty.call(e,"data")&&Array.isArray(e.data))for(var r=0;r<e.data.length;r++){var o="get"+((t=e.data[r]).charAt(0).toUpperCase()+t.slice(1));if(this[o]&&"function"==typeof this[o]){var i=this[o](),s={};["pager","sorter","filter","search","return"].indexOf(e.data[r])>-1?s[e.data[r]]=i:s=i,n=Object.assign(n,s)}}return n}},{key:"getID",value:function(e,t){var n,r=bt,o=["",this.manifest.model];Object.prototype.hasOwnProperty.call(t,"index")&&t.index&&(r=[t.index].concat(bt));for(var i=0,s=o;i<s.length;i++){var a,l=s[i],c=mt(r);try{for(c.s();!(a=c.n()).done;){var u=a.value;if(Object.prototype.hasOwnProperty.call(e,l+u)){n=e[l+u];break}}}catch(e){c.e(e)}finally{c.f()}}return n}},{key:"setFindBy",value:function(e,t){var n={};return n[e]=t,this.setFilter(n)}},{key:"setFilter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xt;return gt.set("filter",this.working,e),this}},{key:"resetFilter",value:function(){return this.setFilter()}},{key:"getFilter",value:function(){return gt.get("filter",this.working)}},{key:"setSearch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return gt.set("search",this.working,e),this}},{key:"resetSearch",value:function(){return this.setSearch()}},{key:"getSearch",value:function(){return gt.get("search",this.working)}},{key:"setSorter",value:function(e){return gt.set("sorter",this.working,e),this}},{key:"resetSorter",value:function(){return this.setSorter({})}},{key:"getSorter",value:function(){return gt.get("sorter",this.working)}},{key:"setReturn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wt;return gt.set("return",this.working,e),this}},{key:"resetReturn",value:function(){return this.setReturn({})}},{key:"getReturn",value:function(){return gt.get("return",this.working)}},{key:"setPageNumber",value:function(e){return gt.set("pager.page",this.working,e),this}},{key:"setPageSize",value:function(e){return gt.set("pager.size",this.working,e),this}},{key:"setPager",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.constructor===Number?gt.set("pager",this.working,{size:e,page:t}):e.constructor===Object&&gt.set("pager",this.working,{size:e.size||10,page:e.page||1}),this}},{key:"resetPager",value:function(){return this.setPager()}},{key:"getPager",value:function(){return gt.get("pager",this.working)}}]),e}();function $t(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return _t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _t(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}function _t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var St={bucket:"client",server:"",selectMany:!1,preview:{width:100,height:100}},Ot=function(){function e(t){f(this,e),this.options=Object.assign({},St,t),this.ui={},this.init()}var t,n;return g(e,[{key:"init",value:function(){return this.generateID(),this.createStore(),this.options.complex&&this.options.complex.popup?(this.renderComplex(),void this.loadFilesData().catch(console.error)):this.options.storageEl?(this.renderStorage(),void this.loadFilesData().catch(console.error)):void(this.options.uploadEl?this.renderUpload():this.options.preload&&this.loadFilesData().catch(console.error))}},{key:"generateID",value:function(){this.options.id||(this.options.id=Math.random())}},{key:"createStore",value:function(){var e=this;this.storage=Oe(this.options.id),this.storage.files.subscribe((function(t){e.files=t})),this.storage.selected.subscribe((function(t){e.selected=t})),this.storage.uploads.subscribe((function(t){e.uploads=t}))}},{key:"renderComplex",value:function(){this.ui.complex=new ct({target:this.options.complexEl,props:{files:this.files,id:this.options.id,selectMany:this.options.selectMany,selectOnClick:this.options.selectOnClick,show:this.options.complex&&this.options.complex.show,popup:this.options.complex&&this.options.complex.popup,short:this.options.complex&&this.options.complex.short}}),this.ui.complex.$on("remove",this.removeFiles.bind(this)),this.ui.complex.$on("filesAdded",this.onUploads.bind(this))}},{key:"renderStorage",value:function(){this.ui.storage=new Be({target:this.options.storageEl,props:{files:this.files,id:this.options.id,selectMany:this.options.selectMany,popup:this.options.storage&&this.options.storage.popup,show:this.options.storage&&this.options.storage.show,selectOnClick:this.options.selectOnClick}}),this.ui.storage.$on("remove",this.removeFiles.bind(this))}},{key:"renderUpload",value:function(){this.ui.upload=new nt({target:this.options.uploadEl,props:{id:this.options.id,popup:this.options.upload&&this.options.upload.popup,show:this.options.upload&&this.options.upload.show,short:this.options.upload&&this.options.upload.short}}),this.ui.upload.$on("filesAdded",this.onUploads.bind(this)),this.ui.upload.$on("remove",this.removeUpload.bind(this))}},{key:"loadFilesData",value:function(){var e=this,t={bucket:this.options.bucket,session:this.options.session};return this.getInterface().setFilter(t).setSorter({fileID:-1}).$list({}).then((function(t){var n=t.status,r=t.result;return"ok"===n?(e.storage.files.update((function(e){return e.splice.apply(e,[0,e.length].concat(u(r))),e})),r):[]})).catch((function(e){console.error(e,"Список загруженных файлов не доступен!")}))}},{key:"getInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"get",n={bucket:this.options.bucket,session:this.options.session};return this.getInterface().setFilter(n)["$"+t]({_id:e}).catch((function(e){console.error(e,"Информация о файле не доступна!")}))}},{key:"useGlobalInterface",value:function(){return this.options.useGlobalInterface&&this.nrFile}},{key:"getInterface",value:function(){return new kt(ut,this.options)}},{key:"show",value:function(){var e=this;return new Promise((function(t,n){e.ui.storage?e.ui.storage.$set({show:!0,onResolve:t,onReject:n}):e.ui.complex&&e.ui.complex.$set({show:!0,onResolve:t,onReject:n})}))}},{key:"removeFiles",value:(n=o(b.mark((function e(t){var n,r,o,i,s,a,l,c;return b.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.detail.selected,r={bucket:this.options.bucket,session:this.options.session},o=[],i=$t(n),e.prev=4,i.s();case 6:if((s=i.n()).done){e.next=22;break}if(a=s.value,!(l=this.findFileByUUID(a))){e.next=20;break}return e.prev=10,e.next=13,this.getInterface().setFilter(r).$delete({fileID:l.fileID});case 13:c=e.sent,this.isGood(c)&&o.push(l),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),console.error(e.t0);case 20:e.next=6;break;case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(4),i.e(e.t1);case 27:return e.prev=27,i.f(),e.finish(27);case 30:o.forEach(this.removeFromStore.bind(this)),this.resetSelected();case 32:case"end":return e.stop()}}),e,this,[[4,24,27,30],[10,17]])}))),function(e){return n.apply(this,arguments)})},{key:"findFileByUUID",value:function(e){var t=!1;return this.files.forEach((function(n){n.uuid===e&&(t=n)})),t}},{key:"isGood",value:function(e){return e.status&&"ok"===e.status}},{key:"removeFromStore",value:function(e){this.storage.files.update((function(t){var n=t.indexOf(e);return n>-1&&t.splice(n,1),t}))}},{key:"resetSelected",value:function(){this.storage.selected.update((function(e){return e.splice(0,e.length),e}))}},{key:"onUploads",value:(t=o(b.mark((function e(t){var n,r,o,i,s,a;return b.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.detail,r=$t(n),e.prev=2,r.s();case 4:if((o=r.n()).done){e.next=14;break}return i=o.value,e.next=8,this.preloadFilePreview(i);case 8:s=e.sent,i.id="fid_"+Math.random(),a={id:i.id,name:i.name,size:i.size,type:i.type,file:i,preview:s},this.addToUploads(a);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return t.apply(this,arguments)})},{key:"preloadFilePreview",value:function(e){var t=this;return new Promise((function(n,r){try{var o=new FileReader;o.onload=function(e){var r=document.createElement("canvas");r.width=t.options.preview.width,r.height=t.options.preview.height;var o=r.getContext("2d"),i=new Image;i.onload=function(){o.drawImage(i,0,0,t.options.preview.width,t.options.preview.height),n(r.toDataURL("image/png"))},i.src=e.target.result},o.onerror=r,o.readAsDataURL(e)}catch(e){r(e)}}))}},{key:"addToUploads",value:function(e){this.uploadFile(e).catch(console.error),this.storage.uploads.update((function(t){return t.push(e),t}))}},{key:"removeUpload",value:function(){}},{key:"uploadFile",value:function(e){var t=this,n={bucket:this.options.bucket,session:this.options.session};return this.getInterface().setFilter(n).$create(n,!1,!0,e.file).then((function(n){"ok"===n.status&&t.uploadFinished(e)}))}},{key:"uploadFinished",value:function(e){this.storage.uploads.update((function(t){var n;return t.forEach((function(t){t.id===e.id&&(e.uploaded=!0,n=e)})),n&&t.splice(t.indexOf(n),1),t})),this.loadFilesData().catch(console.error)}}]),e}();return e.ComplexComponent=ct,e.FileStores=Pe,e.StorageComponent=Be,e.UploadComponent=nt,e.notStore=Ot,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
