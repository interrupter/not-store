var notStore=function(e){"use strict";function t(){}function n(e){return e()}function s(){return Object.create(null)}function o(e){e.forEach(n)}function i(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function r(e,t){e.appendChild(t)}function a(e,t,n){e.insertBefore(t,n||null)}function c(e){e.parentNode.removeChild(e)}function u(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function d(e){return document.createElement(e)}function p(e){return document.createTextNode(e)}function h(){return p(" ")}function f(){return p("")}function g(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function m(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function v(e,t){t=""+t,e.data!==t&&(e.data=t)}let b;function $(e){b=e}function y(){if(!b)throw new Error("Function called outside component initialization");return b}function w(e){y().$$.on_mount.push(e)}function x(){const e=y();return(t,n)=>{const s=e.$$.callbacks[t];if(s){const o=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);s.slice().forEach(t=>{t.call(e,o)})}}}const k=[],O=[],P=[],F=[],S=Promise.resolve();let A=!1;function R(e){P.push(e)}function j(e){F.push(e)}let I=!1;const M=new Set;function C(){if(!I){I=!0;do{for(let e=0;e<k.length;e+=1){const t=k[e];$(t),U(t.$$)}for(k.length=0;O.length;)O.pop()();for(let e=0;e<P.length;e+=1){const t=P[e];M.has(t)||(M.add(t),t())}P.length=0}while(k.length);for(;F.length;)F.pop()();A=!1,I=!1,M.clear()}}function U(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(R)}}const E=new Set;let D;function _(){D={r:0,c:[],p:D}}function N(){D.r||o(D.c),D=D.p}function B(e,t){e&&e.i&&(E.delete(e),e.i(t))}function z(e,t,n,s){if(e&&e.o){if(E.has(e))return;E.add(e),D.c.push(()=>{E.delete(e),s&&(n&&e.d(1),s())}),e.o(t)}}function L(e,t){z(e,1,1,()=>{t.delete(e.key)})}function T(e,t,n){const s=e.$$.props[t];void 0!==s&&(e.$$.bound[s]=n,n(e.$$.ctx[s]))}function q(e){e&&e.c()}function V(e,t,s){const{fragment:l,on_mount:r,on_destroy:a,after_update:c}=e.$$;l&&l.m(t,s),R(()=>{const t=r.map(n).filter(i);a?a.push(...t):o(t),e.$$.on_mount=[]}),c.forEach(R)}function G(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function H(e,t){-1===e.$$.dirty[0]&&(k.push(e),A||(A=!0,S.then(C)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function J(e,n,i,l,r,a,u=[-1]){const d=b;$(e);const p=n.props||{},h=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:r,bound:s(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:s(),dirty:u};let f=!1;if(h.ctx=i?i(e,p,(t,n,...s)=>{const o=s.length?s[0]:n;return h.ctx&&r(h.ctx[t],h.ctx[t]=o)&&(h.bound[t]&&h.bound[t](o),f&&H(e,t)),n}):[],h.update(),f=!0,o(h.before_update),h.fragment=!!l&&l(h.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);h.fragment&&h.fragment.l(e),e.forEach(c)}else h.fragment&&h.fragment.c();n.intro&&B(e.$$.fragment),V(e,n.target,n.anchor),C()}$(d)}class K{$destroy(){G(this,1),this.$destroy=t}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function Q(e){let n,s,i,l,u,f,b,$,y,w,x,k,O,P,F,S,A,R,j,I,M,C,U,E,D,_,N,B=e[3].approve+"",z=e[3].disapprove+"";return{c(){n=d("div"),s=d("div"),i=h(),l=d("div"),u=d("header"),f=d("p"),b=p(e[0]),$=h(),y=d("button"),w=h(),x=d("section"),k=d("p"),O=p(e[1]),P=h(),F=d("label"),S=d("input"),A=h(),R=p(e[2]),j=h(),I=d("footer"),M=d("button"),C=p(B),U=h(),E=d("button"),D=p(z),m(s,"class","modal-background"),m(f,"class","modal-card-title"),m(y,"class","delete"),m(y,"aria-label","close"),m(u,"class","modal-card-head"),m(S,"type","checkbox"),m(S,"class","confirm-approval"),m(F,"class","checkbox"),m(x,"class","modal-card-body"),m(M,"class","button is-success confirm-approve"),M.disabled=e[5],m(E,"class","button confirm-disapprove"),m(I,"class","modal-card-foot"),m(l,"class","modal-card"),m(n,"class","modal is-active")},m(t,o){a(t,n,o),r(n,s),r(n,i),r(n,l),r(l,u),r(u,f),r(f,b),r(u,$),r(u,y),r(l,w),r(l,x),r(x,k),r(k,O),r(x,P),r(x,F),r(F,S),S.checked=e[4],r(F,A),r(F,R),r(l,j),r(l,I),r(I,M),r(M,C),r(I,U),r(I,E),r(E,D),_||(N=[g(y,"click",e[6]),g(S,"change",e[10]),g(M,"click",e[7]),g(E,"click",e[6])],_=!0)},p(e,[t]){1&t&&v(b,e[0]),2&t&&v(O,e[1]),16&t&&(S.checked=e[4]),4&t&&v(R,e[2]),8&t&&B!==(B=e[3].approve+"")&&v(C,B),32&t&&(M.disabled=e[5]),8&t&&z!==(z=e[3].disapprove+"")&&v(D,z)},i:t,o:t,d(e){e&&c(n),_=!1,o(N)}}}function W(e,t,n){let s,o=!1,{title:i="title"}=t,{text:l="text"}=t,{approval:r="approval"}=t,{resolve:a=(()=>{})}=t,{reject:c=(()=>{})}=t,{label:u={approve:"Да",disapprove:"Нет"}}=t;return e.$set=e=>{"title"in e&&n(0,i=e.title),"text"in e&&n(1,l=e.text),"approval"in e&&n(2,r=e.approval),"resolve"in e&&n(8,a=e.resolve),"reject"in e&&n(9,c=e.reject),"label"in e&&n(3,u=e.label)},e.$$.update=()=>{16&e.$$.dirty&&n(5,s=!o)},[i,l,r,u,o,s,function(){c()},function(){a()},a,c,function(){o=this.checked,n(4,o)}]}class X extends K{constructor(e){super(),J(this,e,W,Q,l,{title:0,text:1,approval:2,resolve:8,reject:9,label:3})}}class Y{static ask({title:e,text:t,approval:n}){return new Promise((s,o)=>{let i=new X({target:document.body,props:{title:e,text:t,approval:n,reject(){i.$destroy(),o()},resolve(){i.$destroy(),s()}}})})}}const Z=[];function ee(e,n=t){let s;const o=[];function i(t){if(l(e,t)&&(e=t,s)){const t=!Z.length;for(let t=0;t<o.length;t+=1){const n=o[t];n[1](),Z.push(n,e)}if(t){for(let e=0;e<Z.length;e+=2)Z[e][0](Z[e+1]);Z.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(l,r=t){const a=[l,r];return o.push(a),1===o.length&&(s=n(i)||t),l(e),()=>{const e=o.indexOf(a);-1!==e&&o.splice(e,1),0===o.length&&(s(),s=null)}}}}const te={};function ne(e){return Object.prototype.hasOwnProperty.call(te,e)}function se(e){return!!ne(e)&&te[e]}function oe(e){return ne(e)||(te[e]={files:ee([]),selected:ee([]),uploads:ee([])}),te[e]}var ie=Object.freeze({__proto__:null,create:oe,get:se});function le(e){let t,n,s;return{c(){t=d("progress"),n=p(e[0]),s=p("%"),m(t,"class","progress is-link"),t.value=e[0],m(t,"max","100")},m(e,o){a(e,t,o),r(t,n),r(t,s)},p(e,s){1&s&&v(n,e[0]),1&s&&(t.value=e[0])},d(e){e&&c(t)}}}function re(e){let t,n,s,o,i,l,u,f,g,b=e[3].name+"",$=!e[2]&&ae(e);return{c(){t=d("figure"),$&&$.c(),n=h(),s=d("img"),l=h(),u=d("div"),f=d("div"),g=p(b),m(s,"draggable","true"),s.src!==(o=e[3].path.small.cloud.Location)&&m(s,"src",o),m(s,"alt",i=e[3].name),m(s,"class","svelte-1n0ppue"),m(f,"class","text svelte-1n0ppue"),m(u,"draggable","true"),m(u,"class","middle svelte-1n0ppue"),m(t,"class","image is-4by3 svelte-1n0ppue")},m(e,o){a(e,t,o),$&&$.m(t,null),r(t,n),r(t,s),r(t,l),r(t,u),r(u,f),r(f,g)},p(e,l){e[2]?$&&($.d(1),$=null):$?$.p(e,l):($=ae(e),$.c(),$.m(t,n)),8&l&&s.src!==(o=e[3].path.small.cloud.Location)&&m(s,"src",o),8&l&&i!==(i=e[3].name)&&m(s,"alt",i),8&l&&b!==(b=e[3].name+"")&&v(g,b)},d(e){e&&c(t),$&&$.d()}}}function ae(e){let n,s,o;return{c(){n=d("button"),m(n,"class","delete svelte-1n0ppue")},m(t,i){a(t,n,i),s||(o=g(n,"click",e[6]),s=!0)},p:t,d(e){e&&c(n),s=!1,o()}}}function ce(e){let n,s,o,i,l,u,p=e[1]&&le(e),f=e[3].path&&re(e);return{c(){n=d("div"),p&&p.c(),s=h(),f&&f.c(),m(n,"class",o="tile file is-3 is-child "+e[4]+" svelte-1n0ppue"),m(n,"data-uuid",i=e[3].uuid)},m(t,o){a(t,n,o),p&&p.m(n,null),r(n,s),f&&f.m(n,null),l||(u=g(n,"click",e[5]),l=!0)},p(e,[t]){e[1]?p?p.p(e,t):(p=le(e),p.c(),p.m(n,s)):p&&(p.d(1),p=null),e[3].path?f?f.p(e,t):(f=re(e),f.c(),f.m(n,null)):f&&(f.d(1),f=null),16&t&&o!==(o="tile file is-3 is-child "+e[4]+" svelte-1n0ppue")&&m(n,"class",o),8&t&&i!==(i=e[3].uuid)&&m(n,"data-uuid",i)},i:t,o:t,d(e){e&&c(n),p&&p.d(),f&&f.d(),l=!1,u()}}}function ue(e,t,n){const s=x();let o,{progress:i=0}=t,{selected:l=!1}=t,{notUploaded:r=!1}=t,{selectMany:a=!1}=t,{hideDeleteButton:c=!1}=t,{bucketId:u}=t,{data:d={name:"default.file.name",size:1e3,preview:!1}}=t;return w(()=>{se(u).selected.subscribe(e=>{e.indexOf(d.uuid)>-1?n(7,l=!0):n(7,l=!1)})}),e.$set=e=>{"progress"in e&&n(0,i=e.progress),"selected"in e&&n(7,l=e.selected),"notUploaded"in e&&n(1,r=e.notUploaded),"selectMany"in e&&n(8,a=e.selectMany),"hideDeleteButton"in e&&n(2,c=e.hideDeleteButton),"bucketId"in e&&n(9,u=e.bucketId),"data"in e&&n(3,d=e.data)},e.$$.update=()=>{128&e.$$.dirty&&n(4,o=l?"selected":"")},[i,r,c,d,o,function(){se(u).selected.update(e=>(e.indexOf(d.uuid)>-1?e.splice(e.indexOf(d.uuid),1):a?e.push(d.uuid):e.splice(0,e.length,d.uuid),e))},function(e){console.log("remove file",e),Y.ask({title:`Удаление файла (${d.name}) `,text:"Файл будет удалён без возможнеости восстановления!",approval:"Удалить файл?"}).then(()=>{console.log("remove approved"),s("remove",d)}).catch(()=>{console.log("remove disapprove")})},l,a,u]}class de extends K{constructor(e){super(),J(this,e,ue,ce,l,{progress:0,selected:7,notUploaded:1,selectMany:8,hideDeleteButton:2,bucketId:9,data:3})}}function pe(e,t,n){const s=e.slice();return s[17]=t[n],s[18]=t,s[19]=n,s}function he(e,t,n){const s=e.slice();return s[17]=t[n],s[20]=t,s[21]=n,s}function fe(e){let t,n,s,o=e[0],i=[];for(let t=0;t<o.length;t+=1)i[t]=ge(he(e,o,t));const l=e=>z(i[e],1,1,()=>{i[e]=null});return{c(){t=d("div"),n=d("div");for(let e=0;e<i.length;e+=1)i[e].c();m(n,"class","file-list"),m(t,"class","container svelte-18hgx6z")},m(e,o){a(e,t,o),r(t,n);for(let e=0;e<i.length;e+=1)i[e].m(n,null);s=!0},p(e,t){if(525&t){let s;for(o=e[0],s=0;s<o.length;s+=1){const l=he(e,o,s);i[s]?(i[s].p(l,t),B(i[s],1)):(i[s]=ge(l),i[s].c(),B(i[s],1),i[s].m(n,null))}for(_(),s=o.length;s<i.length;s+=1)l(s);N()}},i(e){if(!s){for(let e=0;e<o.length;e+=1)B(i[e]);s=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)z(i[e]);s=!1},d(e){e&&c(t),u(i,e)}}}function ge(e){let t,n;function s(t){e[14].call(null,t,e[17],e[20],e[21])}let o={bucketId:e[2],selectMany:e[3]};void 0!==e[17]&&(o.data=e[17]);const i=new de({props:o});return O.push(()=>T(i,"data",s)),i.$on("remove",e[9]),{c(){q(i.$$.fragment)},m(e,t){V(i,e,t),n=!0},p(n,s){e=n;const o={};4&s&&(o.bucketId=e[2]),8&s&&(o.selectMany=e[3]),!t&&1&s&&(t=!0,o.data=e[17],j(()=>t=!1)),i.$set(o)},i(e){n||(B(i.$$.fragment,e),n=!0)},o(e){z(i.$$.fragment,e),n=!1},d(e){G(i,e)}}}function me(e){let t,n,s,i,l,u,p,f,v,b,$,y,w,x,k,O,P,F,S,A,R,j,I=[],M=new Map,C=e[0];const U=e=>e[17].id;for(let t=0;t<C.length;t+=1){let n=pe(e,C,t),s=U(n);M.set(s,I[t]=ve(s,n))}return{c(){t=d("div"),n=d("div"),s=h(),i=d("div"),l=d("header"),u=d("p"),u.textContent="Выберите файл",p=h(),f=d("button"),v=h(),b=d("section"),$=d("div"),y=d("div");for(let e=0;e<I.length;e+=1)I[e].c();w=h(),x=d("footer"),k=d("button"),k.textContent="Выбрать",O=h(),P=d("button"),P.textContent="Удалить",F=h(),S=d("button"),S.textContent="Закрыть",m(n,"class","modal-background"),m(u,"class","modal-card-title"),m(f,"class","delete"),m(f,"aria-label","close"),m(l,"class","modal-card-head"),m(y,"class","file-list"),m($,"class","container svelte-18hgx6z"),m(b,"class","modal-card-body"),m(k,"class","button is-success"),m(P,"class","button is-danger"),m(S,"class","button"),m(x,"class","modal-card-foot"),m(i,"class","modal-card"),m(t,"class","modal is-active")},m(o,c){a(o,t,c),r(t,n),r(t,s),r(t,i),r(i,l),r(l,u),r(l,p),r(l,f),r(i,v),r(i,b),r(b,$),r($,y);for(let e=0;e<I.length;e+=1)I[e].m(y,null);r(i,w),r(i,x),r(x,k),r(x,O),r(x,P),r(x,F),r(x,S),A=!0,R||(j=[g(f,"click",e[5]),g(k,"click",e[7]),g(P,"click",e[8]),g(S,"click",e[6])],R=!0)},p(e,t){if(525&t){const n=e[0];_(),I=function(e,t,n,s,o,i,l,r,a,c,u,d){let p=e.length,h=i.length,f=p;const g={};for(;f--;)g[e[f].key]=f;const m=[],v=new Map,b=new Map;for(f=h;f--;){const e=d(o,i,f),r=n(e);let a=l.get(r);a?s&&a.p(e,t):(a=c(r,e),a.c()),v.set(r,m[f]=a),r in g&&b.set(r,Math.abs(f-g[r]))}const $=new Set,y=new Set;function w(e){B(e,1),e.m(r,u),l.set(e.key,e),u=e.first,h--}for(;p&&h;){const t=m[h-1],n=e[p-1],s=t.key,o=n.key;t===n?(u=t.first,p--,h--):v.has(o)?!l.has(s)||$.has(s)?w(t):y.has(o)?p--:b.get(s)>b.get(o)?(y.add(s),w(t)):($.add(o),p--):(a(n,l),p--)}for(;p--;){const t=e[p];v.has(t.key)||a(t,l)}for(;h;)w(m[h-1]);return m}(I,t,U,1,e,n,M,y,L,ve,null,pe),N()}},i(e){if(!A){for(let e=0;e<C.length;e+=1)B(I[e]);A=!0}},o(e){for(let e=0;e<I.length;e+=1)z(I[e]);A=!1},d(e){e&&c(t);for(let e=0;e<I.length;e+=1)I[e].d();R=!1,o(j)}}}function ve(e,t){let n,s,o;function i(e){t[15].call(null,e,t[17],t[18],t[19])}let l={bucketId:t[2],selectMany:t[3]};void 0!==t[17]&&(l.data=t[17]);const r=new de({props:l});return O.push(()=>T(r,"data",i)),r.$on("remove",t[9]),{key:e,first:null,c(){n=f(),q(r.$$.fragment),this.first=n},m(e,t){a(e,n,t),V(r,e,t),o=!0},p(e,n){t=e;const o={};4&n&&(o.bucketId=t[2]),8&n&&(o.selectMany=t[3]),!s&&1&n&&(s=!0,o.data=t[17],j(()=>s=!1)),r.$set(o)},i(e){o||(B(r.$$.fragment,e),o=!0)},o(e){z(r.$$.fragment,e),o=!1},d(e){e&&c(n),G(r,e)}}}function be(e){let t,n,s,o=!e[4]&&e[1]&&fe(e),i=e[4]&&e[1]&&me(e);return{c(){o&&o.c(),t=h(),i&&i.c(),n=f()},m(e,l){o&&o.m(e,l),a(e,t,l),i&&i.m(e,l),a(e,n,l),s=!0},p(e,[s]){!e[4]&&e[1]?o?(o.p(e,s),18&s&&B(o,1)):(o=fe(e),o.c(),B(o,1),o.m(t.parentNode,t)):o&&(_(),z(o,1,1,()=>{o=null}),N()),e[4]&&e[1]?i?(i.p(e,s),18&s&&B(i,1)):(i=me(e),i.c(),B(i,1),i.m(n.parentNode,n)):i&&(_(),z(i,1,1,()=>{i=null}),N())},i(e){s||(B(o),B(i),s=!0)},o(e){z(o),z(i),s=!1},d(e){o&&o.d(e),e&&c(t),i&&i.d(e),e&&c(n)}}}function $e(e,t,n){const s=x();let{files:o=[]}=t,{selected:i=[]}=t,{id:l}=t,{selectMany:r}=t,{popup:a=!1}=t,{show:c=!1}=t,{onReject:u}=t,{onResolve:d}=t;function p(){n(1,c=!1)}return w(()=>{se(l).files.subscribe(e=>{o.forEach((e,t)=>{e.id=t}),n(0,o=e)}),se(l).selected.subscribe(e=>{n(10,i=e)})}),e.$set=e=>{"files"in e&&n(0,o=e.files),"selected"in e&&n(10,i=e.selected),"id"in e&&n(2,l=e.id),"selectMany"in e&&n(3,r=e.selectMany),"popup"in e&&n(4,a=e.popup),"show"in e&&n(1,c=e.show),"onReject"in e&&n(11,u=e.onReject),"onResolve"in e&&n(12,d=e.onResolve)},[o,c,l,r,a,p,function(){p(),u?(u(),n(11,u=null)):s("reject")},function(){if(p(),i.length){let e=o.filter(e=>i.indexOf(e.uuid)>-1);d?(d(e),n(12,d=null)):s("resolve",{selected:e})}else d?(d([]),n(12,d=null)):s("resolve",{selected:[]})},function(){Y.ask({title:`Удаление файлов (${i.length}) `,text:"Файлы будут удалены без возможнеости восстановления!",approval:"Удалить файлы?"}).then(()=>{console.log("remove approved"),s("remove",{selected:i})}).catch(()=>{console.log("remove disapprove")})},function(e){console.log("removeFile",e),s("remove",{selected:[e.detail.uuid]})},i,u,d,function(e){se(l).update(t=>(t.splice(0,t.length,...e),t))},function(e,t,s,i){s[i]=e,n(0,o)},function(e,t,s,i){s[i]=e,n(0,o)}]}class ye extends K{constructor(e){super(),J(this,e,$e,be,l,{files:0,selected:10,id:2,selectMany:3,popup:4,show:1,onReject:11,onResolve:12,updateFiles:13})}get updateFiles(){return this.$$.ctx[13]}}function we(e){let t;return{c(){t=d("progress"),m(t,"class","progress is-link")},m(e,n){a(e,t,n)},d(e){e&&c(t)}}}function xe(e){let t,n,s,o;return{c(){t=d("figure"),n=d("img"),m(n,"alt",s=e[1].name),n.src!==(o=e[1].preview)&&m(n,"src",o),m(n,"class","svelte-1d8gg06"),m(t,"class","image is-4by3 svelte-1d8gg06")},m(e,s){a(e,t,s),r(t,n)},p(e,t){2&t&&s!==(s=e[1].name)&&m(n,"alt",s),2&t&&n.src!==(o=e[1].preview)&&m(n,"src",o)},d(e){e&&c(t)}}}function ke(e){let n,s,o,i=!e[0]&&we(),l=e[1].preview&&xe(e);return{c(){n=d("div"),i&&i.c(),s=h(),l&&l.c(),m(n,"class","tile file is-3 is-child svelte-1d8gg06"),m(n,"data-id",o=e[1].id)},m(e,t){a(e,n,t),i&&i.m(n,null),r(n,s),l&&l.m(n,null)},p(e,[t]){e[0]?i&&(i.d(1),i=null):i||(i=we(),i.c(),i.m(n,s)),e[1].preview?l?l.p(e,t):(l=xe(e),l.c(),l.m(n,null)):l&&(l.d(1),l=null),2&t&&o!==(o=e[1].id)&&m(n,"data-id",o)},i:t,o:t,d(e){e&&c(n),i&&i.d(),l&&l.d()}}}function Oe(e,t,n){let{uploaded:s=!1}=t,{data:o={name:"default.file.name",size:1e3,preview:!1}}=t;return e.$set=e=>{"uploaded"in e&&n(0,s=e.uploaded),"data"in e&&n(1,o=e.data)},[s,o]}class Pe extends K{constructor(e){super(),J(this,e,Oe,ke,l,{uploaded:0,data:1})}}function Fe(e,t,n){const s=e.slice();return s[8]=t[n],s}function Se(e,t,n){const s=e.slice();return s[8]=t[n],s}function Ae(e){let t,n,s,o,i,l,u,p,f,v,b,$,y=0===e[0].length&&Re(),w=e[0].length>0&&je(e);return{c(){t=d("div"),n=d("label"),s=d("form"),o=d("input"),i=h(),l=d("span"),l.innerHTML='<span class="file-label svelte-9du03">Выберите изображения для загрузки</span>',u=h(),p=d("div"),y&&y.c(),f=h(),w&&w.c(),m(o,"class","file-input"),m(o,"type","file"),m(o,"name","file"),m(o,"accept","image/*"),o.multiple="true",m(l,"class","file-cta svelte-9du03"),m(s,"action","./"),m(n,"class","file-label svelte-9du03"),m(t,"class","file is-boxed dropzone svelte-9du03"),m(p,"class","previews svelte-9du03")},m(c,d){a(c,t,d),r(t,n),r(n,s),r(s,o),r(s,i),r(s,l),a(c,u,d),a(c,p,d),y&&y.m(p,null),r(p,f),w&&w.m(p,null),v=!0,b||($=g(o,"change",e[6]),b=!0)},p(e,t){0===e[0].length?y||(y=Re(),y.c(),y.m(p,f)):y&&(y.d(1),y=null),e[0].length>0?w?(w.p(e,t),1&t&&B(w,1)):(w=je(e),w.c(),B(w,1),w.m(p,null)):w&&(_(),z(w,1,1,()=>{w=null}),N())},i(e){v||(B(w),v=!0)},o(e){z(w),v=!1},d(e){e&&c(t),e&&c(u),e&&c(p),y&&y.d(),w&&w.d(),b=!1,$()}}}function Re(e){let t;return{c(){t=d("h2"),t.textContent="Нету загружаемых файлов",m(t,"class","subtitle")},m(e,n){a(e,t,n)},d(e){e&&c(t)}}}function je(e){let t,n,s=e[0],o=[];for(let t=0;t<s.length;t+=1)o[t]=Ie(Se(e,s,t));const i=e=>z(o[e],1,1,()=>{o[e]=null});return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=f()},m(e,s){for(let t=0;t<o.length;t+=1)o[t].m(e,s);a(e,t,s),n=!0},p(e,n){if(5&n){let l;for(s=e[0],l=0;l<s.length;l+=1){const i=Se(e,s,l);o[l]?(o[l].p(i,n),B(o[l],1)):(o[l]=Ie(i),o[l].c(),B(o[l],1),o[l].m(t.parentNode,t))}for(_(),l=s.length;l<o.length;l+=1)i(l);N()}},i(e){if(!n){for(let e=0;e<s.length;e+=1)B(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)z(o[e]);n=!1},d(e){u(o,e),e&&c(t)}}}function Ie(e){let t;const n=new Pe({props:{bucketId:e[2],data:e[8]}});return{c(){q(n.$$.fragment)},m(e,s){V(n,e,s),t=!0},p(e,t){const s={};4&t&&(s.bucketId=e[2]),1&t&&(s.data=e[8]),n.$set(s)},i(e){t||(B(n.$$.fragment,e),t=!0)},o(e){z(n.$$.fragment,e),t=!1},d(e){G(n,e)}}}function Me(e){let t,n,s,i,l,u,p,f,v,b,$,y,w,x,k,O,P,F,S=0===e[0].length&&Ce(),A=e[0].length>0&&Ue(e);return{c(){t=d("div"),n=d("div"),s=h(),i=d("div"),l=d("header"),u=d("p"),u.textContent="Добавьте файлы для загрузки",p=h(),f=d("button"),v=h(),b=d("section"),$=d("div"),S&&S.c(),y=h(),A&&A.c(),w=h(),x=d("footer"),k=d("button"),k.textContent="Завершить",m(n,"class","modal-background"),m(u,"class","modal-card-title"),m(f,"class","delete"),m(f,"aria-label","close"),m(l,"class","modal-card-head"),m($,"class","container"),m(b,"class","modal-card-body"),m(k,"class","button is-success"),m(x,"class","modal-card-foot"),m(i,"class","modal-card"),m(t,"class","modal is-active")},m(o,c){a(o,t,c),r(t,n),r(t,s),r(t,i),r(i,l),r(l,u),r(l,p),r(l,f),r(i,v),r(i,b),r(b,$),S&&S.m($,null),r($,y),A&&A.m($,null),r(i,w),r(i,x),r(x,k),O=!0,P||(F=[g(f,"click",e[4]),g(k,"click",e[5])],P=!0)},p(e,t){0===e[0].length?S||(S=Ce(),S.c(),S.m($,y)):S&&(S.d(1),S=null),e[0].length>0?A?(A.p(e,t),1&t&&B(A,1)):(A=Ue(e),A.c(),B(A,1),A.m($,null)):A&&(_(),z(A,1,1,()=>{A=null}),N())},i(e){O||(B(A),O=!0)},o(e){z(A),O=!1},d(e){e&&c(t),S&&S.d(),A&&A.d(),P=!1,o(F)}}}function Ce(e){let t;return{c(){t=d("h2"),t.textContent="Нету загружаемых файлов",m(t,"class","subtitle")},m(e,n){a(e,t,n)},d(e){e&&c(t)}}}function Ue(e){let t,n,s=e[0],o=[];for(let t=0;t<s.length;t+=1)o[t]=Ee(Fe(e,s,t));const i=e=>z(o[e],1,1,()=>{o[e]=null});return{c(){t=d("div");for(let e=0;e<o.length;e+=1)o[e].c();m(t,"class","file-list")},m(e,s){a(e,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0},p(e,n){if(5&n){let l;for(s=e[0],l=0;l<s.length;l+=1){const i=Fe(e,s,l);o[l]?(o[l].p(i,n),B(o[l],1)):(o[l]=Ee(i),o[l].c(),B(o[l],1),o[l].m(t,null))}for(_(),l=s.length;l<o.length;l+=1)i(l);N()}},i(e){if(!n){for(let e=0;e<s.length;e+=1)B(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)z(o[e]);n=!1},d(e){e&&c(t),u(o,e)}}}function Ee(e){let t;const n=new Pe({props:{bucketId:e[2],data:e[8]}});return{c(){q(n.$$.fragment)},m(e,s){V(n,e,s),t=!0},p(e,t){const s={};4&t&&(s.bucketId=e[2]),1&t&&(s.data=e[8]),n.$set(s)},i(e){t||(B(n.$$.fragment,e),t=!0)},o(e){z(n.$$.fragment,e),t=!1},d(e){G(n,e)}}}function De(e){let t,n,s,o=!e[3]&&e[1]&&Ae(e),i=e[3]&&e[1]&&Me(e);return{c(){o&&o.c(),t=h(),i&&i.c(),n=f()},m(e,l){o&&o.m(e,l),a(e,t,l),i&&i.m(e,l),a(e,n,l),s=!0},p(e,[s]){!e[3]&&e[1]?o?(o.p(e,s),10&s&&B(o,1)):(o=Ae(e),o.c(),B(o,1),o.m(t.parentNode,t)):o&&(_(),z(o,1,1,()=>{o=null}),N()),e[3]&&e[1]?i?(i.p(e,s),10&s&&B(i,1)):(i=Me(e),i.c(),B(i,1),i.m(n.parentNode,n)):i&&(_(),z(i,1,1,()=>{i=null}),N())},i(e){s||(B(o),B(i),s=!0)},o(e){z(o),z(i),s=!1},d(e){o&&o.d(e),e&&c(t),i&&i.d(e),e&&c(n)}}}function _e(e,t,n){const s=x();let{id:o}=t,{uploads:i=[]}=t,{popup:l=!1}=t,{show:r=!1}=t;function a(){n(1,r=!1)}return w(()=>{se(o).uploads.subscribe(e=>{n(0,i=e)})}),e.$set=e=>{"id"in e&&n(2,o=e.id),"uploads"in e&&n(0,i=e.uploads),"popup"in e&&n(3,l=e.popup),"show"in e&&n(1,r=e.show)},[i,r,o,l,a,function(){a(),s("resolve")},function(e){console.log("on input change",e),s("filesAdded",e.target.files)}]}class Ne extends K{constructor(e){super(),J(this,e,_e,De,l,{id:2,uploads:0,popup:3,show:1})}}function Be(e){let t,n,s,i,l,u,p,f,v,b,$,y,w,x,k,P,F,S,A,R,I,M,C,U,E;function D(t){e[14].call(null,t)}let _={popup:!1,show:!0};void 0!==e[0]&&(_.id=e[0]);const N=new Ne({props:_});function L(t){e[15].call(null,t)}function H(t){e[16].call(null,t)}O.push(()=>T(N,"id",D)),N.$on("filesAdded",e[7]);let J={popup:!1,show:!0};void 0!==e[0]&&(J.id=e[0]),void 0!==e[1]&&(J.selectMany=e[1]);const K=new ye({props:J});return O.push(()=>T(K,"id",L)),O.push(()=>T(K,"selectMany",H)),K.$on("remove",e[9]),{c(){t=d("div"),n=d("div"),s=h(),i=d("div"),l=d("header"),u=d("p"),u.textContent="Добавьте файлы для загрузки",p=h(),f=d("button"),v=h(),b=d("section"),$=d("div"),q(N.$$.fragment),w=h(),q(K.$$.fragment),P=h(),F=d("footer"),S=d("button"),S.textContent="Выбрать",A=h(),R=d("button"),R.textContent="Удалить",I=h(),M=d("button"),M.textContent="Закрыть",m(n,"class","modal-background"),m(u,"class","modal-card-title"),m(f,"class","delete"),m(f,"aria-label","close"),m(l,"class","modal-card-head"),m($,"class","container"),m(b,"class","modal-card-body"),m(S,"class","button is-success"),m(R,"class","button is-danger"),m(M,"class","button"),m(F,"class","modal-card-foot"),m(i,"class","modal-card"),m(t,"class","modal is-active")},m(o,c){a(o,t,c),r(t,n),r(t,s),r(t,i),r(i,l),r(l,u),r(l,p),r(l,f),r(i,v),r(i,b),r(b,$),V(N,$,null),r($,w),V(K,$,null),r(i,P),r(i,F),r(F,S),r(F,A),r(F,R),r(F,I),r(F,M),C=!0,U||(E=[g(f,"click",e[4]),g(S,"click",e[5]),g(R,"click",e[8]),g(M,"click",e[6])],U=!0)},p(e,t){const n={};!y&&1&t&&(y=!0,n.id=e[0],j(()=>y=!1)),N.$set(n);const s={};!x&&1&t&&(x=!0,s.id=e[0],j(()=>x=!1)),!k&&2&t&&(k=!0,s.selectMany=e[1],j(()=>k=!1)),K.$set(s)},i(e){C||(B(N.$$.fragment,e),B(K.$$.fragment,e),C=!0)},o(e){z(N.$$.fragment,e),z(K.$$.fragment,e),C=!1},d(e){e&&c(t),G(N),G(K),U=!1,o(E)}}}function ze(e){let t,n;const s=new Ne({props:{popup:!1,show:!0,id:e[0]}});s.$on("filesAdded",e[7]);const o=new ye({props:{popup:!1,show:!0,id:e[0],selectMany:!1}});return o.$on("remove",e[9]),{c(){q(s.$$.fragment),t=h(),q(o.$$.fragment)},m(e,i){V(s,e,i),a(e,t,i),V(o,e,i),n=!0},p(e,t){const n={};1&t&&(n.id=e[0]),s.$set(n);const i={};1&t&&(i.id=e[0]),o.$set(i)},i(e){n||(B(s.$$.fragment,e),B(o.$$.fragment,e),n=!0)},o(e){z(s.$$.fragment,e),z(o.$$.fragment,e),n=!1},d(e){G(s,e),e&&c(t),G(o,e)}}}function Le(e){let t,n,s,o=e[3]&&e[2]&&Be(e),i=!e[3]&&e[2]&&ze(e);return{c(){o&&o.c(),t=h(),i&&i.c(),n=f()},m(e,l){o&&o.m(e,l),a(e,t,l),i&&i.m(e,l),a(e,n,l),s=!0},p(e,[s]){e[3]&&e[2]?o?(o.p(e,s),12&s&&B(o,1)):(o=Be(e),o.c(),B(o,1),o.m(t.parentNode,t)):o&&(_(),z(o,1,1,()=>{o=null}),N()),!e[3]&&e[2]?i?(i.p(e,s),12&s&&B(i,1)):(i=ze(e),i.c(),B(i,1),i.m(n.parentNode,n)):i&&(_(),z(i,1,1,()=>{i=null}),N())},i(e){s||(B(o),B(i),s=!0)},o(e){z(o),z(i),s=!1},d(e){o&&o.d(e),e&&c(t),i&&i.d(e),e&&c(n)}}}function Te(e,t,n){const s=x();w(()=>{se(o).files.subscribe(e=>{console.log(c,a),n(10,i=e)}),se(o).selected.subscribe(e=>{n(11,l=e)})});let{id:o}=t,{files:i=[]}=t,{selected:l=[]}=t,{selectMany:r}=t,{show:a=!0}=t,{popup:c=!0}=t,{onReject:u}=t,{onResolve:d}=t;function p(){n(2,a=!1)}return e.$set=e=>{"id"in e&&n(0,o=e.id),"files"in e&&n(10,i=e.files),"selected"in e&&n(11,l=e.selected),"selectMany"in e&&n(1,r=e.selectMany),"show"in e&&n(2,a=e.show),"popup"in e&&n(3,c=e.popup),"onReject"in e&&n(12,u=e.onReject),"onResolve"in e&&n(13,d=e.onResolve)},[o,r,a,c,p,function(){if(p(),l.length){let e=i.filter(e=>l.indexOf(e.uuid)>-1);d?(d(e),n(13,d=null)):s("resolve",{selected:e})}else d?(d([]),n(13,d=null)):s("resolve",{selected:[]})},function(){p(),u?(u(),n(12,u=null)):s("reject")},function(e){console.log("on input change",e),s("filesAdded",e.detail)},function(){Y.ask({title:`Удаление файлов (${l.length}) `,text:"Файлы будут удалены без возможнеости восстановления!",approval:"Удалить файлы?"}).then(()=>{console.log("remove approved"),s("remove",{selected:l})}).catch(()=>{console.log("remove disapprove")})},function(e){console.log("removeFile",e),s("remove",{selected:e.detail.selected})},i,l,u,d,function(e){o=e,n(0,o)},function(e){o=e,n(0,o)},function(e){r=e,n(1,r)}]}class qe extends K{constructor(e){super(),J(this,e,Te,Le,l,{id:0,files:10,selected:11,selectMany:1,show:2,popup:3,onReject:12,onResolve:13})}}var Ve={model:"file",url:"/api/:modelName",fields:{},actions:{create:{method:"PUT",isArray:!1,data:["record"],postFix:"/:bucket?",rules:[{auth:!0,admin:!0},{auth:!0,admin:!1},{auth:!1,admin:!1}]},list:{method:"GET",isArray:!0,data:["pager","sorter","filter"],rules:[{auth:!0,admin:!0},{auth:!0,admin:!1},{auth:!1,admin:!1}]},listAndCount:{method:"get",rules:[{auth:!0,admin:!0},{auth:!0,role:"admin"}],postFix:"/:actionName"},get:{method:"GET",isArray:!1,postFix:"/:record[_id]",data:["filter","record"],rules:[{auth:!0,admin:!0},{auth:!0,admin:!1},{auth:!1,admin:!1}]},delete:{method:"DELETE",postFix:"/:record[fileID]",isArray:!1,rules:[{auth:!0,admin:!0},{auth:!0,admin:!1},{auth:!1,admin:!1}]}}};var Ge=new class{constructor(){return this}findNextSubPath(e){let t="",n=!1;for(let s=0;s<e.length;s++)if("{"===e[s])n=!0,t="";else{if("}"===e[s]&&n)return t;t+=e[s]}return n?t:null}replaceSubPath(e,t,n){let s="{"+t+"}",o=0;for(;e.indexOf(s)>-1&&o<10;)e=e.replace(s,n),o++;return e}parseSubs(e,t,n){let s,o=this.findNextSubPath(e),i=0;for(;o&&(s=this.getValueByPath(o.indexOf("::")>-1?n:t,o,t,n),e=this.replaceSubPath(e,o,s),i++,!(i>10));)o=this.findNextSubPath(e);return e}get(e,t,n){switch(e){case":":return t;case"::":return n}return e=this.parseSubs(e,t,n),this.getValueByPath(e.indexOf("::")>-1?n:t,e,t,n)}set(e,t,n,s){3===arguments.length&&(s=n,n=void 0);let o,i=this.findNextSubPath(e),l=0;for(;i&&(o=this.getValueByPath(i.indexOf("::")>-1?n:t,i,t,n),e=this.replaceSubPath(e,i,o),!(l>10));)i=this.findNextSubPath(e),l++;this.setValueByPath(t,e,s),t.isRecord&&this.normilizePath(e).length>1&&t.__isActive&&t.trigger("change",t,e,s)}unset(e,t,n){this.set(e,t,n,null)}parsePathStep(e,t,n){let s=null;if(0===e.indexOf("::")&&n){if(s=e.replace("::",""),s.indexOf("()")!==s.length-2)return n[s];if(s=s.replace("()",""),n.hasOwnProperty(s))return n[s](t,void 0)}else if(0===e.indexOf(":")&&t){if(s=e.replace(":",""),s.indexOf("()")!==s.length-2)return t[s];if(s=s.replace("()",""),t.hasOwnProperty(s))return t[s](t,void 0)}return e}parsePath(e,t,n){Array.isArray(e)||(e=e.split("."));for(var s=0;s<e.length;s++)e[s]=this.parsePathStep(e[s],t,n);return e}normilizePath(e){if(Array.isArray(e))return e;for(;e.indexOf(":")>-1;)e=e.replace(":","");return e.split(".")}ifFullSubPath(e,t){if(e.length<t.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}getValueByPath(e,t,n,s){let o=(t=this.normilizePath(t)).shift(),i=o.indexOf("()")>-1;if(i&&(o=o.replace("()","")),"object"==typeof e&&null!=e&&void 0!==e[o]&&null!==e[o]){let l=i?e[o]({item:n,helpers:s}):e[o];return t.length>0?this.getValueByPath(l,t,n,s):l}}setValueByPath(e,t,n){let s=(t=this.normilizePath(t)).shift();t.length>0?(e.hasOwnProperty(s)||(e[s]={}),this.setValueByPath(e[s],t,n)):e[s]=n}join(){return Array.prototype.slice.call(arguments).join(".")}};const He=["_id","id","ID"],Je={},Ke={};class Qe{constructor(e,t){return this.options=t,this.manifest=e,this.working={},this.initActions(),this}initActions(){if(this.getActionsCount()>0){let e=this.getActions();for(let t in e)this.initAction(t,e[t])}}initAction(e){Object.prototype.hasOwnProperty.call(this,["$"+e])||(this["$"+e]=(t,n,s=!1,o)=>this.request(this,e,t,n,s,o))}request(e,t,n,s={},o=!1,i){let l=Object.assign({},e,n),r=this.getActionData(t),a=this.collectRequestData(r),c=this.encodeRequest(a),u=this.getServerURL(),d=this.getURL(l,r,t),p={};if(o){d=this.getURL(n,r,t),console.log("request url for file upload",d);const e=new FormData;e.append("file",i),p.body=e}else-1===["OPTIONS","GET"].indexOf(r.method.toUpperCase())&&(p={body:e});return p.method=r.method.toUpperCase(),s&&(p.headers=s),fetch(u+d+c,p).then(e=>e.json())}getModelName(){return this&&this.manifest?this.manifest.model:null}getActionData(e){return this.getActions()&&this.getActions()[e]?this.getActions()[e]:null}getActionsCount(){return this.getActions()?Object.keys(this.getActions()).length:0}getActions(){return this.manifest&&this.manifest.actions?this.manifest.actions:{}}parseParams(e,t,n,s){let o="",i=e.length;for(;n.indexOf(e)>-1;){let l=n.indexOf(e)+i,r=n.indexOf(t);if(o=n.slice(l,r),""==o)break;console.log(e+o+t,Ge.get(o,s)),n=n.replace(e+o+t,Ge.get(o,s))}return n}parseLine(e,t,n){return e=(e=e.replace(":modelName",this.manifest.model)).replace(":actionName",n),e=this.parseParams(":record[","]",e,t),e=this.parseParams(":","?",e,t)}getURL(e,t,n){return this.parseLine(this.manifest.url,e,n)+(Object.prototype.hasOwnProperty.call(t,"postFix")?this.parseLine(t.postFix,e,n):"")}getServerURL(){return this.options.server}encodeRequest(e){let t="?";for(let n in e)void 0!==e[n]&&null!==e[n]&&(t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n].constructor===Object?JSON.stringify(e[n]):e[n])+"&");return this.options.test&&(t+="&test=1",this.options.test.session&&(t+="&session="+this.options.test.session),this.options.test.session&&(t+="&role="+this.options.test.role)),t}collectRequestData(e){let t={};if(Object.prototype.hasOwnProperty.call(e,"data")&&Array.isArray(e.data))for(let s=0;s<e.data.length;s++){let o="get"+((n=e.data[s]).charAt(0).toUpperCase()+n.slice(1));if(this[o]&&"function"==typeof this[o]){let n=this[o](),i={};["pager","sorter","filter","search","return"].indexOf(e.data[s])>-1?i[e.data[s]]=n:i=n,t=Object.assign(t,i)}}var n;return t}getID(e,t){let n,s=He,o=["",this.manifest.model];Object.prototype.hasOwnProperty.call(t,"index")&&t.index&&(s=[t.index].concat(He));for(let t of o)for(let o of s)if(Object.prototype.hasOwnProperty.call(e,t+o)){n=e[t+o];break}return n}setFindBy(e,t){var n={};return n[e]=t,this.setFilter(n)}setFilter(e=Je){return Ge.set("filter",this.working,e),this}resetFilter(){return this.setFilter()}getFilter(){return Ge.get("filter",this.working)}setSearch(e=""){return Ge.set("search",this.working,e),this}resetSearch(){return this.setSearch()}getSearch(){return Ge.get("search",this.working)}setSorter(e){return Ge.set("sorter",this.working,e),this}resetSorter(){return this.setSorter({})}getSorter(){return Ge.get("sorter",this.working)}setReturn(e=Ke){return Ge.set("return",this.working,e),this}resetReturn(){return this.setReturn({})}getReturn(){return Ge.get("return",this.working)}setPageNumber(e){return Ge.set("pager.page",this.working,e),this}setPageSize(e){return Ge.set("pager.size",this.working,e),this}setPager(e=10,t=1){return e.constructor===Number?Ge.set("pager",this.working,{size:e,page:t}):e.constructor===Object&&Ge.set("pager",this.working,{size:e.size||10,page:e.page||1}),this}resetPager(){return this.setPager()}getPager(){return Ge.get("pager",this.working)}}const We={bucket:"client",server:"",selectMany:!1,preview:{width:100,height:100}};return e.ComplexComponent=qe,e.FileStores=ie,e.StorageComponent=ye,e.UploadComponent=Ne,e.notStore=class{constructor(e){this.options=Object.assign({},We,e),this.ui={},this.init()}init(){this.generateID(),this.createStore(),this.options.complex&&this.options.complex.popup?(this.renderComplex(),this.loadFilesData().catch(console.error)):(this.options.storageEl&&(this.renderStorage(),this.loadFilesData().catch(console.error)),this.options.uploadEl&&this.renderUpload())}generateID(){this.options.id||(this.options.id=Math.random())}createStore(){this.storage=oe(this.options.id),this.storage.files.subscribe(e=>{this.files=e}),this.storage.selected.subscribe(e=>{this.selected=e}),this.storage.uploads.subscribe(e=>{this.uploads=e})}renderComplex(){this.ui.complex=new qe({target:this.options.complexEl,props:{files:this.files,id:this.options.id,selectMany:this.options.selectMany,show:this.options.complex&&this.options.complex.show,popup:this.options.complex&&this.options.complex.popup}}),this.ui.complex.$on("remove",this.removeFiles.bind(this)),this.ui.complex.$on("filesAdded",this.onUploads.bind(this))}renderStorage(){this.ui.storage=new ye({target:this.options.storageEl,props:{files:this.files,id:this.options.id,selectMany:this.options.selectMany,popup:this.options.storage&&this.options.storage.popup,show:this.options.storage&&this.options.storage.show}}),this.ui.storage.$on("remove",this.removeFiles.bind(this))}renderUpload(){this.ui.upload=new Ne({target:this.options.uploadEl,props:{id:this.options.id,popup:this.options.upload&&this.options.upload.popup,show:this.options.upload&&this.options.upload.show}}),this.ui.upload.$on("filesAdded",this.onUploads.bind(this)),this.ui.upload.$on("remove",this.removeUpload.bind(this))}loadFilesData(){let e={bucket:this.options.bucket,session:this.options.session};return this.getInterface().setFilter(e).setSorter({fileID:-1}).$list({}).then(e=>(this.storage.files.update(t=>(t.splice(0,t.length,...e),t)),e)).catch(e=>{console.error(e,"Список загруженных файлов не доступен!")})}getInfo(e,t="get"){let n={bucket:this.options.bucket,session:this.options.session};return this.getInterface().setFilter(n)["$"+t]({_id:e}).catch(e=>{console.error(e,"Информация о файле не доступна!")})}useGlobalInterface(){return this.options.useGlobalInterface&&this.nrFile}getInterface(){return new Qe(Ve,this.options)}show(){return new Promise((e,t)=>{this.ui.storage?this.ui.storage.$set({show:!0,onResolve:e,onReject:t}):this.ui.complex&&this.ui.complex.$set({show:!0,onResolve:e,onReject:t})})}async removeFiles(e){let t=e.detail.selected,n={bucket:this.options.bucket,session:this.options.session},s=[];for(let e of t){let t=this.findFileByUUID(e);if(t)try{let e=await this.getInterface().setFilter(n).$delete({fileID:t.fileID});this.isGood(e)&&s.push(t)}catch(e){console.error(e)}}s.forEach(this.removeFromStore.bind(this)),this.resetSelected()}findFileByUUID(e){let t=!1;return this.files.forEach(n=>{n.uuid===e&&(t=n)}),t}isGood(e){return e.status&&"ok"===e.status}removeFromStore(e){this.storage.files.update(t=>{let n=t.indexOf(e);return n>-1&&t.splice(n,1),t})}resetSelected(){this.storage.selected.update(e=>(e.splice(0,e.length),e))}async onUploads(e){let t=e.detail;for(let e of t){let t=await this.preloadFilePreview(e);e.id="fid_"+Math.random();let n={id:e.id,name:e.name,size:e.size,type:e.type,file:e,preview:t};this.addToUploads(n)}}preloadFilePreview(e){return new Promise((t,n)=>{try{let s=new FileReader;s.onload=e=>{let n=document.createElement("canvas");n.width=this.options.preview.width,n.height=this.options.preview.height;let s=n.getContext("2d"),o=new Image;o.onload=()=>{s.drawImage(o,0,0,this.options.preview.width,this.options.preview.height),t(n.toDataURL("image/png"))},o.src=e.target.result},s.onerror=n,s.readAsDataURL(e)}catch(e){n(e)}})}addToUploads(e){this.uploadFile(e).catch(console.error),this.storage.uploads.update(t=>(t.push(e),t))}removeUpload(e){e.detail.selected}uploadFile(e){let t={bucket:this.options.bucket,session:this.options.session};return this.getInterface().setFilter(t).$create(t,!1,!0,e.file).then(t=>{"ok"===t.status&&this.uploadFinished(e)})}uploadFinished(e){this.storage.uploads.update(t=>{let n;return t.forEach(t=>{t.id===e.id&&(e.uploaded=!0,n=e)}),n&&t.splice(t.indexOf(n),1),t}),this.loadFilesData().catch(console.error)}},e}({});
