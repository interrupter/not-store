var notStore=function(e){"use strict";function t(){}function n(e){return e()}function s(){return Object.create(null)}function o(e){e.forEach(n)}function i(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function r(e,t){e.appendChild(t)}function a(e,t,n){e.insertBefore(t,n||null)}function c(e){e.parentNode.removeChild(e)}function u(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function d(e){return document.createElement(e)}function p(e){return document.createTextNode(e)}function h(){return p(" ")}function f(){return p("")}function g(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function m(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function v(e,t){t=""+t,e.data!==t&&(e.data=t)}let b;function $(e){b=e}function y(){if(!b)throw new Error("Function called outside component initialization");return b}function x(e){y().$$.on_mount.push(e)}function w(){const e=y();return(t,n)=>{const s=e.$$.callbacks[t];if(s){const o=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);s.slice().forEach(t=>{t.call(e,o)})}}}const k=[],O=[],P=[],F=[],S=Promise.resolve();let A=!1;function R(e){P.push(e)}function j(e){F.push(e)}let I=!1;const C=new Set;function U(){if(!I){I=!0;do{for(let e=0;e<k.length;e+=1){const t=k[e];$(t),M(t.$$)}for(k.length=0;O.length;)O.pop()();for(let e=0;e<P.length;e+=1){const t=P[e];C.has(t)||(C.add(t),t())}P.length=0}while(k.length);for(;F.length;)F.pop()();A=!1,I=!1,C.clear()}}function M(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(R)}}const D=new Set;let E;function N(){E={r:0,c:[],p:E}}function _(){E.r||o(E.c),E=E.p}function B(e,t){e&&e.i&&(D.delete(e),e.i(t))}function z(e,t,n,s){if(e&&e.o){if(D.has(e))return;D.add(e),E.c.push(()=>{D.delete(e),s&&(n&&e.d(1),s())}),e.o(t)}}function L(e,t,n){const s=e.$$.props[t];void 0!==s&&(e.$$.bound[s]=n,n(e.$$.ctx[s]))}function T(e){e&&e.c()}function q(e,t,s){const{fragment:l,on_mount:r,on_destroy:a,after_update:c}=e.$$;l&&l.m(t,s),R(()=>{const t=r.map(n).filter(i);a?a.push(...t):o(t),e.$$.on_mount=[]}),c.forEach(R)}function V(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function G(e,t){-1===e.$$.dirty[0]&&(k.push(e),A||(A=!0,S.then(U)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function H(e,n,i,l,r,a,u=[-1]){const d=b;$(e);const p=n.props||{},h=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:r,bound:s(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:s(),dirty:u};let f=!1;if(h.ctx=i?i(e,p,(t,n,...s)=>{const o=s.length?s[0]:n;return h.ctx&&r(h.ctx[t],h.ctx[t]=o)&&(h.bound[t]&&h.bound[t](o),f&&G(e,t)),n}):[],h.update(),f=!0,o(h.before_update),h.fragment=!!l&&l(h.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);h.fragment&&h.fragment.l(e),e.forEach(c)}else h.fragment&&h.fragment.c();n.intro&&B(e.$$.fragment),q(e,n.target,n.anchor),U()}$(d)}class J{$destroy(){V(this,1),this.$destroy=t}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function K(e){let n,s,i,l,u,f,b,$,y,x,w,k,O,P,F,S,A,R,j,I,C,U,M,D,E,N,_,B=e[3].approve+"",z=e[3].disapprove+"";return{c(){n=d("div"),s=d("div"),i=h(),l=d("div"),u=d("header"),f=d("p"),b=p(e[0]),$=h(),y=d("button"),x=h(),w=d("section"),k=d("p"),O=p(e[1]),P=h(),F=d("label"),S=d("input"),A=h(),R=p(e[2]),j=h(),I=d("footer"),C=d("button"),U=p(B),M=h(),D=d("button"),E=p(z),m(s,"class","modal-background"),m(f,"class","modal-card-title"),m(y,"class","delete"),m(y,"aria-label","close"),m(u,"class","modal-card-head"),m(S,"type","checkbox"),m(S,"class","confirm-approval"),m(F,"class","checkbox"),m(w,"class","modal-card-body"),m(C,"class","button is-success confirm-approve"),C.disabled=e[5],m(D,"class","button confirm-disapprove"),m(I,"class","modal-card-foot"),m(l,"class","modal-card"),m(n,"class","modal is-active")},m(t,o){a(t,n,o),r(n,s),r(n,i),r(n,l),r(l,u),r(u,f),r(f,b),r(u,$),r(u,y),r(l,x),r(l,w),r(w,k),r(k,O),r(w,P),r(w,F),r(F,S),S.checked=e[4],r(F,A),r(F,R),r(l,j),r(l,I),r(I,C),r(C,U),r(I,M),r(I,D),r(D,E),N||(_=[g(y,"click",e[6]),g(S,"change",e[10]),g(C,"click",e[7]),g(D,"click",e[6])],N=!0)},p(e,[t]){1&t&&v(b,e[0]),2&t&&v(O,e[1]),16&t&&(S.checked=e[4]),4&t&&v(R,e[2]),8&t&&B!==(B=e[3].approve+"")&&v(U,B),32&t&&(C.disabled=e[5]),8&t&&z!==(z=e[3].disapprove+"")&&v(E,z)},i:t,o:t,d(e){e&&c(n),N=!1,o(_)}}}function Q(e,t,n){let s,o=!1,{title:i="title"}=t,{text:l="text"}=t,{approval:r="approval"}=t,{resolve:a=(()=>{})}=t,{reject:c=(()=>{})}=t,{label:u={approve:"Да",disapprove:"Нет"}}=t;return e.$set=e=>{"title"in e&&n(0,i=e.title),"text"in e&&n(1,l=e.text),"approval"in e&&n(2,r=e.approval),"resolve"in e&&n(8,a=e.resolve),"reject"in e&&n(9,c=e.reject),"label"in e&&n(3,u=e.label)},e.$$.update=()=>{16&e.$$.dirty&&n(5,s=!o)},[i,l,r,u,o,s,function(){c()},function(){a()},a,c,function(){o=this.checked,n(4,o)}]}class W extends J{constructor(e){super(),H(this,e,Q,K,l,{title:0,text:1,approval:2,resolve:8,reject:9,label:3})}}class X{static ask({title:e,text:t,approval:n}){return new Promise((s,o)=>{let i=new W({target:document.body,props:{title:e,text:t,approval:n,reject(){i.$destroy(),o()},resolve(){i.$destroy(),s()}}})})}}const Y=[];function Z(e,n=t){let s;const o=[];function i(t){if(l(e,t)&&(e=t,s)){const t=!Y.length;for(let t=0;t<o.length;t+=1){const n=o[t];n[1](),Y.push(n,e)}if(t){for(let e=0;e<Y.length;e+=2)Y[e][0](Y[e+1]);Y.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(l,r=t){const a=[l,r];return o.push(a),1===o.length&&(s=n(i)||t),l(e),()=>{const e=o.indexOf(a);-1!==e&&o.splice(e,1),0===o.length&&(s(),s=null)}}}}const ee={};function te(e){return Object.prototype.hasOwnProperty.call(ee,e)}function ne(e){return!!te(e)&&ee[e]}function se(e){return te(e)||(ee[e]={files:Z([]),selected:Z([]),uploads:Z([])}),ee[e]}var oe=Object.freeze({__proto__:null,create:se,get:ne});function ie(e){let t,n,s;return{c(){t=d("progress"),n=p(e[0]),s=p("%"),m(t,"class","progress is-link"),t.value=e[0],m(t,"max","100")},m(e,o){a(e,t,o),r(t,n),r(t,s)},p(e,s){1&s&&v(n,e[0]),1&s&&(t.value=e[0])},d(e){e&&c(t)}}}function le(e){let t,n,s,o,i,l,u,f,g,b=e[3].name+"",$=!e[2]&&re(e);return{c(){t=d("figure"),$&&$.c(),n=h(),s=d("img"),l=h(),u=d("div"),f=d("div"),g=p(b),s.src!==(o=e[3].path.small.cloud.Location)&&m(s,"src",o),m(s,"alt",i=e[3].name),m(s,"class","svelte-1n0ppue"),m(f,"class","text svelte-1n0ppue"),m(u,"class","middle svelte-1n0ppue"),m(t,"class","image is-4by3 svelte-1n0ppue")},m(e,o){a(e,t,o),$&&$.m(t,null),r(t,n),r(t,s),r(t,l),r(t,u),r(u,f),r(f,g)},p(e,l){e[2]?$&&($.d(1),$=null):$?$.p(e,l):($=re(e),$.c(),$.m(t,n)),8&l&&s.src!==(o=e[3].path.small.cloud.Location)&&m(s,"src",o),8&l&&i!==(i=e[3].name)&&m(s,"alt",i),8&l&&b!==(b=e[3].name+"")&&v(g,b)},d(e){e&&c(t),$&&$.d()}}}function re(e){let n,s,o;return{c(){n=d("button"),m(n,"class","delete svelte-1n0ppue")},m(t,i){a(t,n,i),s||(o=g(n,"click",e[6]),s=!0)},p:t,d(e){e&&c(n),s=!1,o()}}}function ae(e){let n,s,o,i,l,u,p=e[1]&&ie(e),f=e[3].path&&le(e);return{c(){n=d("div"),p&&p.c(),s=h(),f&&f.c(),m(n,"class",o="tile file is-3 is-child "+e[4]+" svelte-1n0ppue"),m(n,"data-uuid",i=e[3].uuid)},m(t,o){a(t,n,o),p&&p.m(n,null),r(n,s),f&&f.m(n,null),l||(u=g(n,"click",e[5]),l=!0)},p(e,[t]){e[1]?p?p.p(e,t):(p=ie(e),p.c(),p.m(n,s)):p&&(p.d(1),p=null),e[3].path?f?f.p(e,t):(f=le(e),f.c(),f.m(n,null)):f&&(f.d(1),f=null),16&t&&o!==(o="tile file is-3 is-child "+e[4]+" svelte-1n0ppue")&&m(n,"class",o),8&t&&i!==(i=e[3].uuid)&&m(n,"data-uuid",i)},i:t,o:t,d(e){e&&c(n),p&&p.d(),f&&f.d(),l=!1,u()}}}function ce(e,t,n){const s=w();let o,{progress:i=0}=t,{selected:l=!1}=t,{notUploaded:r=!1}=t,{selectMany:a=!1}=t,{hideDeleteButton:c=!1}=t,{bucketId:u}=t,{data:d={name:"default.file.name",size:1e3,preview:!1}}=t;return x(()=>{ne(u).selected.subscribe(e=>{e.indexOf(d.uuid)>-1?n(7,l=!0):n(7,l=!1)})}),e.$set=e=>{"progress"in e&&n(0,i=e.progress),"selected"in e&&n(7,l=e.selected),"notUploaded"in e&&n(1,r=e.notUploaded),"selectMany"in e&&n(8,a=e.selectMany),"hideDeleteButton"in e&&n(2,c=e.hideDeleteButton),"bucketId"in e&&n(9,u=e.bucketId),"data"in e&&n(3,d=e.data)},e.$$.update=()=>{128&e.$$.dirty&&n(4,o=l?"selected":"")},[i,r,c,d,o,function(){ne(u).selected.update(e=>(e.indexOf(d.uuid)>-1?e.splice(e.indexOf(d.uuid),1):a?e.push(d.uuid):e.splice(0,e.length,d.uuid),e))},function(e){console.log("remove file",e),X.ask({title:`Удаление файла (${d.name}) `,text:"Файл будет удалён без возможнеости восстановления!",approval:"Удалить файл?"}).then(()=>{console.log("remove approved"),s("remove",d)}).catch(()=>{console.log("remove disapprove")})},l,a,u]}class ue extends J{constructor(e){super(),H(this,e,ce,ae,l,{progress:0,selected:7,notUploaded:1,selectMany:8,hideDeleteButton:2,bucketId:9,data:3})}}function de(e,t,n){const s=e.slice();return s[17]=t[n],s[18]=t,s[19]=n,s}function pe(e,t,n){const s=e.slice();return s[17]=t[n],s[20]=t,s[19]=n,s}function he(e){let t,n,s,o=e[0],i=[];for(let t=0;t<o.length;t+=1)i[t]=fe(pe(e,o,t));const l=e=>z(i[e],1,1,()=>{i[e]=null});return{c(){t=d("div"),n=d("div");for(let e=0;e<i.length;e+=1)i[e].c();m(n,"class","file-list"),m(t,"class","container svelte-18hgx6z")},m(e,o){a(e,t,o),r(t,n);for(let e=0;e<i.length;e+=1)i[e].m(n,null);s=!0},p(e,t){if(525&t){let s;for(o=e[0],s=0;s<o.length;s+=1){const l=pe(e,o,s);i[s]?(i[s].p(l,t),B(i[s],1)):(i[s]=fe(l),i[s].c(),B(i[s],1),i[s].m(n,null))}for(N(),s=o.length;s<i.length;s+=1)l(s);_()}},i(e){if(!s){for(let e=0;e<o.length;e+=1)B(i[e]);s=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)z(i[e]);s=!1},d(e){e&&c(t),u(i,e)}}}function fe(e){let t,n;function s(t){e[14].call(null,t,e[17],e[20],e[19])}let o={bucketId:e[2],selectMany:e[3]};void 0!==e[17]&&(o.data=e[17]);const i=new ue({props:o});return O.push(()=>L(i,"data",s)),i.$on("remove",e[9]),{c(){T(i.$$.fragment)},m(e,t){q(i,e,t),n=!0},p(n,s){e=n;const o={};4&s&&(o.bucketId=e[2]),8&s&&(o.selectMany=e[3]),!t&&1&s&&(t=!0,o.data=e[17],j(()=>t=!1)),i.$set(o)},i(e){n||(B(i.$$.fragment,e),n=!0)},o(e){z(i.$$.fragment,e),n=!1},d(e){V(i,e)}}}function ge(e){let t,n,s,i,l,p,f,v,b,$,y,x,w,k,O,P,F,S,A,R,j,I,C=e[0],U=[];for(let t=0;t<C.length;t+=1)U[t]=me(de(e,C,t));const M=e=>z(U[e],1,1,()=>{U[e]=null});return{c(){t=d("div"),n=d("div"),s=h(),i=d("div"),l=d("header"),p=d("p"),p.textContent="Выберите файл",f=h(),v=d("button"),b=h(),$=d("section"),y=d("div"),x=d("div");for(let e=0;e<U.length;e+=1)U[e].c();w=h(),k=d("footer"),O=d("button"),O.textContent="Выбрать",P=h(),F=d("button"),F.textContent="Удалить",S=h(),A=d("button"),A.textContent="Закрыть",m(n,"class","modal-background"),m(p,"class","modal-card-title"),m(v,"class","delete"),m(v,"aria-label","close"),m(l,"class","modal-card-head"),m(x,"class","file-list"),m(y,"class","container svelte-18hgx6z"),m($,"class","modal-card-body"),m(O,"class","button is-success"),m(F,"class","button is-danger"),m(A,"class","button"),m(k,"class","modal-card-foot"),m(i,"class","modal-card"),m(t,"class","modal is-active")},m(o,c){a(o,t,c),r(t,n),r(t,s),r(t,i),r(i,l),r(l,p),r(l,f),r(l,v),r(i,b),r(i,$),r($,y),r(y,x);for(let e=0;e<U.length;e+=1)U[e].m(x,null);r(i,w),r(i,k),r(k,O),r(k,P),r(k,F),r(k,S),r(k,A),R=!0,j||(I=[g(v,"click",e[5]),g(O,"click",e[7]),g(F,"click",e[8]),g(A,"click",e[6])],j=!0)},p(e,t){if(525&t){let n;for(C=e[0],n=0;n<C.length;n+=1){const s=de(e,C,n);U[n]?(U[n].p(s,t),B(U[n],1)):(U[n]=me(s),U[n].c(),B(U[n],1),U[n].m(x,null))}for(N(),n=C.length;n<U.length;n+=1)M(n);_()}},i(e){if(!R){for(let e=0;e<C.length;e+=1)B(U[e]);R=!0}},o(e){U=U.filter(Boolean);for(let e=0;e<U.length;e+=1)z(U[e]);R=!1},d(e){e&&c(t),u(U,e),j=!1,o(I)}}}function me(e){let t,n;function s(t){e[15].call(null,t,e[17],e[18],e[19])}let o={bucketId:e[2],selectMany:e[3]};void 0!==e[17]&&(o.data=e[17]);const i=new ue({props:o});return O.push(()=>L(i,"data",s)),i.$on("remove",e[9]),{c(){T(i.$$.fragment)},m(e,t){q(i,e,t),n=!0},p(n,s){e=n;const o={};4&s&&(o.bucketId=e[2]),8&s&&(o.selectMany=e[3]),!t&&1&s&&(t=!0,o.data=e[17],j(()=>t=!1)),i.$set(o)},i(e){n||(B(i.$$.fragment,e),n=!0)},o(e){z(i.$$.fragment,e),n=!1},d(e){V(i,e)}}}function ve(e){let t,n,s,o=!e[4]&&e[1]&&he(e),i=e[4]&&e[1]&&ge(e);return{c(){o&&o.c(),t=h(),i&&i.c(),n=f()},m(e,l){o&&o.m(e,l),a(e,t,l),i&&i.m(e,l),a(e,n,l),s=!0},p(e,[s]){!e[4]&&e[1]?o?(o.p(e,s),18&s&&B(o,1)):(o=he(e),o.c(),B(o,1),o.m(t.parentNode,t)):o&&(N(),z(o,1,1,()=>{o=null}),_()),e[4]&&e[1]?i?(i.p(e,s),18&s&&B(i,1)):(i=ge(e),i.c(),B(i,1),i.m(n.parentNode,n)):i&&(N(),z(i,1,1,()=>{i=null}),_())},i(e){s||(B(o),B(i),s=!0)},o(e){z(o),z(i),s=!1},d(e){o&&o.d(e),e&&c(t),i&&i.d(e),e&&c(n)}}}function be(e,t,n){const s=w();let{files:o=[]}=t,{selected:i=[]}=t,{id:l}=t,{selectMany:r}=t,{popup:a=!1}=t,{show:c=!1}=t,{onReject:u}=t,{onResolve:d}=t;function p(){n(1,c=!1)}return x(()=>{ne(l).files.subscribe(e=>{n(0,o=e)}),ne(l).selected.subscribe(e=>{n(10,i=e)})}),e.$set=e=>{"files"in e&&n(0,o=e.files),"selected"in e&&n(10,i=e.selected),"id"in e&&n(2,l=e.id),"selectMany"in e&&n(3,r=e.selectMany),"popup"in e&&n(4,a=e.popup),"show"in e&&n(1,c=e.show),"onReject"in e&&n(11,u=e.onReject),"onResolve"in e&&n(12,d=e.onResolve)},[o,c,l,r,a,p,function(){p(),u?(u(),n(11,u=null)):s("reject")},function(){if(p(),i.length){let e=o.filter(e=>i.indexOf(e.uuid)>-1);d?(d(e),n(12,d=null)):s("resolve",{selected:e})}else d?(d([]),n(12,d=null)):s("resolve",{selected:[]})},function(){X.ask({title:`Удаление файлов (${i.length}) `,text:"Файлы будут удалены без возможнеости восстановления!",approval:"Удалить файлы?"}).then(()=>{console.log("remove approved"),s("remove",{selected:i})}).catch(()=>{console.log("remove disapprove")})},function(e){console.log("removeFile",e),s("remove",{selected:[e.detail.uuid]})},i,u,d,function(e){ne(l).update(t=>(t.splice(0,t.length,...e),t))},function(e,t,s,i){s[i]=e,n(0,o)},function(e,t,s,i){s[i]=e,n(0,o)}]}class $e extends J{constructor(e){super(),H(this,e,be,ve,l,{files:0,selected:10,id:2,selectMany:3,popup:4,show:1,onReject:11,onResolve:12,updateFiles:13})}get updateFiles(){return this.$$.ctx[13]}}function ye(e){let t;return{c(){t=d("progress"),m(t,"class","progress is-link")},m(e,n){a(e,t,n)},d(e){e&&c(t)}}}function xe(e){let t,n,s,o;return{c(){t=d("figure"),n=d("img"),m(n,"alt",s=e[1].name),n.src!==(o=e[1].preview)&&m(n,"src",o),m(n,"class","svelte-1d8gg06"),m(t,"class","image is-4by3 svelte-1d8gg06")},m(e,s){a(e,t,s),r(t,n)},p(e,t){2&t&&s!==(s=e[1].name)&&m(n,"alt",s),2&t&&n.src!==(o=e[1].preview)&&m(n,"src",o)},d(e){e&&c(t)}}}function we(e){let n,s,o,i=!e[0]&&ye(),l=e[1].preview&&xe(e);return{c(){n=d("div"),i&&i.c(),s=h(),l&&l.c(),m(n,"class","tile file is-3 is-child svelte-1d8gg06"),m(n,"data-id",o=e[1].id)},m(e,t){a(e,n,t),i&&i.m(n,null),r(n,s),l&&l.m(n,null)},p(e,[t]){e[0]?i&&(i.d(1),i=null):i||(i=ye(),i.c(),i.m(n,s)),e[1].preview?l?l.p(e,t):(l=xe(e),l.c(),l.m(n,null)):l&&(l.d(1),l=null),2&t&&o!==(o=e[1].id)&&m(n,"data-id",o)},i:t,o:t,d(e){e&&c(n),i&&i.d(),l&&l.d()}}}function ke(e,t,n){let{uploaded:s=!1}=t,{data:o={name:"default.file.name",size:1e3,preview:!1}}=t;return e.$set=e=>{"uploaded"in e&&n(0,s=e.uploaded),"data"in e&&n(1,o=e.data)},[s,o]}class Oe extends J{constructor(e){super(),H(this,e,ke,we,l,{uploaded:0,data:1})}}function Pe(e,t,n){const s=e.slice();return s[8]=t[n],s}function Fe(e,t,n){const s=e.slice();return s[8]=t[n],s}function Se(e){let t,n,s,o,i,l,u,p,f,v,b,$,y=0===e[0].length&&Ae(),x=e[0].length>0&&Re(e);return{c(){t=d("div"),n=d("label"),s=d("form"),o=d("input"),i=h(),l=d("span"),l.innerHTML='<span class="file-label svelte-9du03">Выберите изображения для загрузки</span>',u=h(),p=d("div"),y&&y.c(),f=h(),x&&x.c(),m(o,"class","file-input"),m(o,"type","file"),m(o,"name","file"),m(o,"accept","image/*"),o.multiple="true",m(l,"class","file-cta svelte-9du03"),m(s,"action","./"),m(n,"class","file-label svelte-9du03"),m(t,"class","file is-boxed dropzone svelte-9du03"),m(p,"class","previews svelte-9du03")},m(c,d){a(c,t,d),r(t,n),r(n,s),r(s,o),r(s,i),r(s,l),a(c,u,d),a(c,p,d),y&&y.m(p,null),r(p,f),x&&x.m(p,null),v=!0,b||($=g(o,"change",e[6]),b=!0)},p(e,t){0===e[0].length?y||(y=Ae(),y.c(),y.m(p,f)):y&&(y.d(1),y=null),e[0].length>0?x?(x.p(e,t),1&t&&B(x,1)):(x=Re(e),x.c(),B(x,1),x.m(p,null)):x&&(N(),z(x,1,1,()=>{x=null}),_())},i(e){v||(B(x),v=!0)},o(e){z(x),v=!1},d(e){e&&c(t),e&&c(u),e&&c(p),y&&y.d(),x&&x.d(),b=!1,$()}}}function Ae(e){let t;return{c(){t=d("h2"),t.textContent="Нету загружаемых файлов",m(t,"class","subtitle")},m(e,n){a(e,t,n)},d(e){e&&c(t)}}}function Re(e){let t,n,s=e[0],o=[];for(let t=0;t<s.length;t+=1)o[t]=je(Fe(e,s,t));const i=e=>z(o[e],1,1,()=>{o[e]=null});return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=f()},m(e,s){for(let t=0;t<o.length;t+=1)o[t].m(e,s);a(e,t,s),n=!0},p(e,n){if(5&n){let l;for(s=e[0],l=0;l<s.length;l+=1){const i=Fe(e,s,l);o[l]?(o[l].p(i,n),B(o[l],1)):(o[l]=je(i),o[l].c(),B(o[l],1),o[l].m(t.parentNode,t))}for(N(),l=s.length;l<o.length;l+=1)i(l);_()}},i(e){if(!n){for(let e=0;e<s.length;e+=1)B(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)z(o[e]);n=!1},d(e){u(o,e),e&&c(t)}}}function je(e){let t;const n=new Oe({props:{bucketId:e[2],data:e[8]}});return{c(){T(n.$$.fragment)},m(e,s){q(n,e,s),t=!0},p(e,t){const s={};4&t&&(s.bucketId=e[2]),1&t&&(s.data=e[8]),n.$set(s)},i(e){t||(B(n.$$.fragment,e),t=!0)},o(e){z(n.$$.fragment,e),t=!1},d(e){V(n,e)}}}function Ie(e){let t,n,s,i,l,u,p,f,v,b,$,y,x,w,k,O,P,F,S=0===e[0].length&&Ce(),A=e[0].length>0&&Ue(e);return{c(){t=d("div"),n=d("div"),s=h(),i=d("div"),l=d("header"),u=d("p"),u.textContent="Добавьте файлы для загрузки",p=h(),f=d("button"),v=h(),b=d("section"),$=d("div"),S&&S.c(),y=h(),A&&A.c(),x=h(),w=d("footer"),k=d("button"),k.textContent="Завершить",m(n,"class","modal-background"),m(u,"class","modal-card-title"),m(f,"class","delete"),m(f,"aria-label","close"),m(l,"class","modal-card-head"),m($,"class","container"),m(b,"class","modal-card-body"),m(k,"class","button is-success"),m(w,"class","modal-card-foot"),m(i,"class","modal-card"),m(t,"class","modal is-active")},m(o,c){a(o,t,c),r(t,n),r(t,s),r(t,i),r(i,l),r(l,u),r(l,p),r(l,f),r(i,v),r(i,b),r(b,$),S&&S.m($,null),r($,y),A&&A.m($,null),r(i,x),r(i,w),r(w,k),O=!0,P||(F=[g(f,"click",e[4]),g(k,"click",e[5])],P=!0)},p(e,t){0===e[0].length?S||(S=Ce(),S.c(),S.m($,y)):S&&(S.d(1),S=null),e[0].length>0?A?(A.p(e,t),1&t&&B(A,1)):(A=Ue(e),A.c(),B(A,1),A.m($,null)):A&&(N(),z(A,1,1,()=>{A=null}),_())},i(e){O||(B(A),O=!0)},o(e){z(A),O=!1},d(e){e&&c(t),S&&S.d(),A&&A.d(),P=!1,o(F)}}}function Ce(e){let t;return{c(){t=d("h2"),t.textContent="Нету загружаемых файлов",m(t,"class","subtitle")},m(e,n){a(e,t,n)},d(e){e&&c(t)}}}function Ue(e){let t,n,s=e[0],o=[];for(let t=0;t<s.length;t+=1)o[t]=Me(Pe(e,s,t));const i=e=>z(o[e],1,1,()=>{o[e]=null});return{c(){t=d("div");for(let e=0;e<o.length;e+=1)o[e].c();m(t,"class","file-list")},m(e,s){a(e,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0},p(e,n){if(5&n){let l;for(s=e[0],l=0;l<s.length;l+=1){const i=Pe(e,s,l);o[l]?(o[l].p(i,n),B(o[l],1)):(o[l]=Me(i),o[l].c(),B(o[l],1),o[l].m(t,null))}for(N(),l=s.length;l<o.length;l+=1)i(l);_()}},i(e){if(!n){for(let e=0;e<s.length;e+=1)B(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)z(o[e]);n=!1},d(e){e&&c(t),u(o,e)}}}function Me(e){let t;const n=new Oe({props:{bucketId:e[2],data:e[8]}});return{c(){T(n.$$.fragment)},m(e,s){q(n,e,s),t=!0},p(e,t){const s={};4&t&&(s.bucketId=e[2]),1&t&&(s.data=e[8]),n.$set(s)},i(e){t||(B(n.$$.fragment,e),t=!0)},o(e){z(n.$$.fragment,e),t=!1},d(e){V(n,e)}}}function De(e){let t,n,s,o=!e[3]&&e[1]&&Se(e),i=e[3]&&e[1]&&Ie(e);return{c(){o&&o.c(),t=h(),i&&i.c(),n=f()},m(e,l){o&&o.m(e,l),a(e,t,l),i&&i.m(e,l),a(e,n,l),s=!0},p(e,[s]){!e[3]&&e[1]?o?(o.p(e,s),10&s&&B(o,1)):(o=Se(e),o.c(),B(o,1),o.m(t.parentNode,t)):o&&(N(),z(o,1,1,()=>{o=null}),_()),e[3]&&e[1]?i?(i.p(e,s),10&s&&B(i,1)):(i=Ie(e),i.c(),B(i,1),i.m(n.parentNode,n)):i&&(N(),z(i,1,1,()=>{i=null}),_())},i(e){s||(B(o),B(i),s=!0)},o(e){z(o),z(i),s=!1},d(e){o&&o.d(e),e&&c(t),i&&i.d(e),e&&c(n)}}}function Ee(e,t,n){const s=w();let{id:o}=t,{uploads:i=[]}=t,{popup:l=!1}=t,{show:r=!1}=t;function a(){n(1,r=!1)}return x(()=>{ne(o).uploads.subscribe(e=>{n(0,i=e)})}),e.$set=e=>{"id"in e&&n(2,o=e.id),"uploads"in e&&n(0,i=e.uploads),"popup"in e&&n(3,l=e.popup),"show"in e&&n(1,r=e.show)},[i,r,o,l,a,function(){a(),s("resolve")},function(e){console.log("on input change",e),s("filesAdded",e.target.files)}]}class Ne extends J{constructor(e){super(),H(this,e,Ee,De,l,{id:2,uploads:0,popup:3,show:1})}}function _e(e){let t,n,s,i,l,u,p,f,v,b,$,y,x,w,k,P,F,S,A,R,I,C,U,M,D;function E(t){e[14].call(null,t)}let N={popup:!1,show:!0};void 0!==e[0]&&(N.id=e[0]);const _=new Ne({props:N});function G(t){e[15].call(null,t)}function H(t){e[16].call(null,t)}O.push(()=>L(_,"id",E)),_.$on("filesAdded",e[7]);let J={popup:!1,show:!0};void 0!==e[0]&&(J.id=e[0]),void 0!==e[1]&&(J.selectMany=e[1]);const K=new $e({props:J});return O.push(()=>L(K,"id",G)),O.push(()=>L(K,"selectMany",H)),K.$on("remove",e[9]),{c(){t=d("div"),n=d("div"),s=h(),i=d("div"),l=d("header"),u=d("p"),u.textContent="Добавьте файлы для загрузки",p=h(),f=d("button"),v=h(),b=d("section"),$=d("div"),T(_.$$.fragment),x=h(),T(K.$$.fragment),P=h(),F=d("footer"),S=d("button"),S.textContent="Выбрать",A=h(),R=d("button"),R.textContent="Удалить",I=h(),C=d("button"),C.textContent="Закрыть",m(n,"class","modal-background"),m(u,"class","modal-card-title"),m(f,"class","delete"),m(f,"aria-label","close"),m(l,"class","modal-card-head"),m($,"class","container"),m(b,"class","modal-card-body"),m(S,"class","button is-success"),m(R,"class","button is-danger"),m(C,"class","button"),m(F,"class","modal-card-foot"),m(i,"class","modal-card"),m(t,"class","modal is-active")},m(o,c){a(o,t,c),r(t,n),r(t,s),r(t,i),r(i,l),r(l,u),r(l,p),r(l,f),r(i,v),r(i,b),r(b,$),q(_,$,null),r($,x),q(K,$,null),r(i,P),r(i,F),r(F,S),r(F,A),r(F,R),r(F,I),r(F,C),U=!0,M||(D=[g(f,"click",e[4]),g(S,"click",e[5]),g(R,"click",e[8]),g(C,"click",e[6])],M=!0)},p(e,t){const n={};!y&&1&t&&(y=!0,n.id=e[0],j(()=>y=!1)),_.$set(n);const s={};!w&&1&t&&(w=!0,s.id=e[0],j(()=>w=!1)),!k&&2&t&&(k=!0,s.selectMany=e[1],j(()=>k=!1)),K.$set(s)},i(e){U||(B(_.$$.fragment,e),B(K.$$.fragment,e),U=!0)},o(e){z(_.$$.fragment,e),z(K.$$.fragment,e),U=!1},d(e){e&&c(t),V(_),V(K),M=!1,o(D)}}}function Be(e){let t,n;const s=new Ne({props:{popup:!1,id:e[0]}});s.$on("filesAdded",e[7]);const o=new $e({props:{popup:!1,id:e[0],selectMany:!1}});return o.$on("remove",e[9]),{c(){T(s.$$.fragment),t=h(),T(o.$$.fragment)},m(e,i){q(s,e,i),a(e,t,i),q(o,e,i),n=!0},p(e,t){const n={};1&t&&(n.id=e[0]),s.$set(n);const i={};1&t&&(i.id=e[0]),o.$set(i)},i(e){n||(B(s.$$.fragment,e),B(o.$$.fragment,e),n=!0)},o(e){z(s.$$.fragment,e),z(o.$$.fragment,e),n=!1},d(e){V(s,e),e&&c(t),V(o,e)}}}function ze(e){let t,n,s,o=e[3]&&e[2]&&_e(e),i=!e[3]&&e[2]&&Be(e);return{c(){o&&o.c(),t=h(),i&&i.c(),n=f()},m(e,l){o&&o.m(e,l),a(e,t,l),i&&i.m(e,l),a(e,n,l),s=!0},p(e,[s]){e[3]&&e[2]?o?(o.p(e,s),12&s&&B(o,1)):(o=_e(e),o.c(),B(o,1),o.m(t.parentNode,t)):o&&(N(),z(o,1,1,()=>{o=null}),_()),!e[3]&&e[2]?i?(i.p(e,s),12&s&&B(i,1)):(i=Be(e),i.c(),B(i,1),i.m(n.parentNode,n)):i&&(N(),z(i,1,1,()=>{i=null}),_())},i(e){s||(B(o),B(i),s=!0)},o(e){z(o),z(i),s=!1},d(e){o&&o.d(e),e&&c(t),i&&i.d(e),e&&c(n)}}}function Le(e,t,n){const s=w();x(()=>{ne(o).files.subscribe(e=>{console.log(c,a),n(10,i=e)}),ne(o).selected.subscribe(e=>{n(11,l=e)})});let{id:o}=t,{files:i=[]}=t,{selected:l=[]}=t,{selectMany:r}=t,{show:a=!0}=t,{popup:c=!0}=t,{onReject:u}=t,{onResolve:d}=t;function p(){n(2,a=!1)}return e.$set=e=>{"id"in e&&n(0,o=e.id),"files"in e&&n(10,i=e.files),"selected"in e&&n(11,l=e.selected),"selectMany"in e&&n(1,r=e.selectMany),"show"in e&&n(2,a=e.show),"popup"in e&&n(3,c=e.popup),"onReject"in e&&n(12,u=e.onReject),"onResolve"in e&&n(13,d=e.onResolve)},[o,r,a,c,p,function(){if(p(),l.length){let e=i.filter(e=>l.indexOf(e.uuid)>-1);d?(d(e),n(13,d=null)):s("resolve",{selected:e})}else d?(d([]),n(13,d=null)):s("resolve",{selected:[]})},function(){p(),u?(u(),n(12,u=null)):s("reject")},function(e){console.log("on input change",e),s("filesAdded",e.detail)},function(){X.ask({title:`Удаление файлов (${l.length}) `,text:"Файлы будут удалены без возможнеости восстановления!",approval:"Удалить файлы?"}).then(()=>{console.log("remove approved"),s("remove",{selected:l})}).catch(()=>{console.log("remove disapprove")})},function(e){console.log("removeFile",e),s("remove",{selected:e.detail.selected})},i,l,u,d,function(e){o=e,n(0,o)},function(e){o=e,n(0,o)},function(e){r=e,n(1,r)}]}class Te extends J{constructor(e){super(),H(this,e,Le,ze,l,{id:0,files:10,selected:11,selectMany:1,show:2,popup:3,onReject:12,onResolve:13})}}var qe={model:"file",url:"/api/:modelName",fields:{},actions:{create:{method:"PUT",isArray:!1,data:["record"],postFix:"/:bucket?",rules:[{auth:!0,admin:!0},{auth:!0,admin:!1},{auth:!1,admin:!1}]},list:{method:"GET",isArray:!0,data:["pager","sorter","filter"],rules:[{auth:!0,admin:!0},{auth:!0,admin:!1},{auth:!1,admin:!1}]},listAndCount:{method:"get",rules:[{auth:!0,admin:!0},{auth:!0,role:"admin"}],postFix:"/:actionName"},delete:{method:"DELETE",postFix:"/:record[fileID]",isArray:!1,rules:[{auth:!0,admin:!0},{auth:!0,admin:!1},{auth:!1,admin:!1}]}}};var Ve=new class{constructor(){return this}findNextSubPath(e){let t="",n=!1;for(let s=0;s<e.length;s++)if("{"===e[s])n=!0,t="";else{if("}"===e[s]&&n)return t;t+=e[s]}return n?t:null}replaceSubPath(e,t,n){let s="{"+t+"}",o=0;for(;e.indexOf(s)>-1&&o<10;)e=e.replace(s,n),o++;return e}parseSubs(e,t,n){let s,o=this.findNextSubPath(e),i=0;for(;o&&(s=this.getValueByPath(o.indexOf("::")>-1?n:t,o,t,n),e=this.replaceSubPath(e,o,s),i++,!(i>10));)o=this.findNextSubPath(e);return e}get(e,t,n){switch(e){case":":return t;case"::":return n}return e=this.parseSubs(e,t,n),this.getValueByPath(e.indexOf("::")>-1?n:t,e,t,n)}set(e,t,n,s){3===arguments.length&&(s=n,n=void 0);let o,i=this.findNextSubPath(e),l=0;for(;i&&(o=this.getValueByPath(i.indexOf("::")>-1?n:t,i,t,n),e=this.replaceSubPath(e,i,o),!(l>10));)i=this.findNextSubPath(e),l++;this.setValueByPath(t,e,s),t.isRecord&&this.normilizePath(e).length>1&&t.__isActive&&t.trigger("change",t,e,s)}unset(e,t,n){this.set(e,t,n,null)}parsePathStep(e,t,n){let s=null;if(0===e.indexOf("::")&&n){if(s=e.replace("::",""),s.indexOf("()")!==s.length-2)return n[s];if(s=s.replace("()",""),n.hasOwnProperty(s))return n[s](t,void 0)}else if(0===e.indexOf(":")&&t){if(s=e.replace(":",""),s.indexOf("()")!==s.length-2)return t[s];if(s=s.replace("()",""),t.hasOwnProperty(s))return t[s](t,void 0)}return e}parsePath(e,t,n){Array.isArray(e)||(e=e.split("."));for(var s=0;s<e.length;s++)e[s]=this.parsePathStep(e[s],t,n);return e}normilizePath(e){if(Array.isArray(e))return e;for(;e.indexOf(":")>-1;)e=e.replace(":","");return e.split(".")}ifFullSubPath(e,t){if(e.length<t.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}getValueByPath(e,t,n,s){let o=(t=this.normilizePath(t)).shift(),i=o.indexOf("()")>-1;if(i&&(o=o.replace("()","")),"object"==typeof e&&null!=e&&void 0!==e[o]&&null!==e[o]){let l=i?e[o]({item:n,helpers:s}):e[o];return t.length>0?this.getValueByPath(l,t,n,s):l}}setValueByPath(e,t,n){let s=(t=this.normilizePath(t)).shift();t.length>0?(e.hasOwnProperty(s)||(e[s]={}),this.setValueByPath(e[s],t,n)):e[s]=n}join(){return Array.prototype.slice.call(arguments).join(".")}};const Ge=["_id","id","ID"],He={},Je={};class Ke{constructor(e,t){return this.options=t,this.manifest=e,this.working={},this.initActions(),this}initActions(){if(this.getActionsCount()>0){let e=this.getActions();for(let t in e)this.initAction(t,e[t])}}initAction(e){Object.prototype.hasOwnProperty.call(this,["$"+e])||(this["$"+e]=(t,n,s=!1,o)=>this.request(this,e,t,n,s,o))}request(e,t,n,s={},o=!1,i){let l=Object.assign({},e,n),r=this.getActionData(t),a=this.collectRequestData(r),c=this.encodeRequest(a),u=this.getServerURL(),d=this.getURL(l,r,t),p={};if(o){d=this.getURL(n,r,t),console.log("request url for file upload",d);const e=new FormData;e.append("file",i),p.body=e}else-1===["OPTIONS","GET"].indexOf(r.method.toUpperCase())&&(p={body:e});return p.method=r.method.toUpperCase(),s&&(p.headers=s),fetch(u+d+c,p).then(e=>e.json())}getModelName(){return this&&this.manifest?this.manifest.model:null}getActionData(e){return this.getActions()&&this.getActions()[e]?this.getActions()[e]:null}getActionsCount(){return this.getActions()?Object.keys(this.getActions()).length:0}getActions(){return this.manifest&&this.manifest.actions?this.manifest.actions:{}}parseParams(e,t,n,s){let o="",i=e.length;for(;n.indexOf(e)>-1;){let l=n.indexOf(e)+i,r=n.indexOf(t);if(o=n.slice(l,r),""==o)break;console.log(e+o+t,Ve.get(o,s)),n=n.replace(e+o+t,Ve.get(o,s))}return n}parseLine(e,t,n){return e=(e=e.replace(":modelName",this.manifest.model)).replace(":actionName",n),e=this.parseParams(":record[","]",e,t),e=this.parseParams(":","?",e,t)}getURL(e,t,n){return this.parseLine(this.manifest.url,e,n)+(Object.prototype.hasOwnProperty.call(t,"postFix")?this.parseLine(t.postFix,e,n):"")}getServerURL(){return this.options.server}encodeRequest(e){let t="?";for(let n in e)void 0!==e[n]&&null!==e[n]&&(t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n].constructor===Object?JSON.stringify(e[n]):e[n])+"&");return this.options.test&&(t+="&test=1",this.options.test.session&&(t+="&session="+this.options.test.session),this.options.test.session&&(t+="&role="+this.options.test.role)),t}collectRequestData(e){let t={};if(Object.prototype.hasOwnProperty.call(e,"data")&&Array.isArray(e.data))for(let s=0;s<e.data.length;s++){let o="get"+((n=e.data[s]).charAt(0).toUpperCase()+n.slice(1));if(this[o]&&"function"==typeof this[o]){let n=this[o](),i={};["pager","sorter","filter","search","return"].indexOf(e.data[s])>-1?i[e.data[s]]=n:i=n,t=Object.assign(t,i)}}var n;return t}getID(e,t){let n,s=Ge,o=["",this.manifest.model];Object.prototype.hasOwnProperty.call(t,"index")&&t.index&&(s=[t.index].concat(Ge));for(let t of o)for(let o of s)if(Object.prototype.hasOwnProperty.call(e,t+o)){n=e[t+o];break}return n}setFindBy(e,t){var n={};return n[e]=t,this.setFilter(n)}setFilter(e=He){return Ve.set("filter",this.working,e),this}resetFilter(){return this.setFilter()}getFilter(){return Ve.get("filter",this.working)}setSearch(e=""){return Ve.set("search",this.working,e),this}resetSearch(){return this.setSearch()}getSearch(){return Ve.get("search",this.working)}setSorter(e){return Ve.set("sorter",this.working,e),this}resetSorter(){return this.setSorter({})}getSorter(){return Ve.get("sorter",this.working)}setReturn(e=Je){return Ve.set("return",this.working,e),this}resetReturn(){return this.setReturn({})}getReturn(){return Ve.get("return",this.working)}setPageNumber(e){return Ve.set("pager.page",this.working,e),this}setPageSize(e){return Ve.set("pager.size",this.working,e),this}setPager(e=10,t=1){return e.constructor===Number?Ve.set("pager",this.working,{size:e,page:t}):e.constructor===Object&&Ve.set("pager",this.working,{size:e.size||10,page:e.page||1}),this}resetPager(){return this.setPager()}getPager(){return Ve.get("pager",this.working)}}const Qe={bucket:"client",server:"",selectMany:!1,preview:{width:100,height:100}};return e.ComplexComponent=Te,e.FileStores=oe,e.StorageComponent=$e,e.UploadComponent=Ne,e.notStore=class{constructor(e){this.options=Object.assign({},Qe,e),this.ui={},this.init()}init(){this.generateID(),this.createStore(),this.options.complex&&this.options.complex.popup?(this.renderComplex(),this.loadFilesData().catch(console.error)):(this.options.storageEl&&(this.renderStorage(),this.loadFilesData().catch(console.error)),this.options.uploadEl&&this.renderUpload())}generateID(){this.options.id||(this.options.id=Math.random())}createStore(){this.storage=se(this.options.id),this.storage.files.subscribe(e=>{this.files=e}),this.storage.selected.subscribe(e=>{this.selected=e}),this.storage.uploads.subscribe(e=>{this.uploads=e})}renderComplex(){this.ui.complex=new Te({target:this.options.complexEl,props:{files:this.files,id:this.options.id,selectMany:this.options.selectMany,show:this.options.complex&&this.options.complex.show,popup:this.options.complex&&this.options.complex.popup}}),this.ui.complex.$on("remove",this.removeFiles.bind(this)),this.ui.complex.$on("filesAdded",this.onUploads.bind(this))}renderStorage(){this.ui.storage=new $e({target:this.options.storageEl,props:{files:this.files,id:this.options.id,selectMany:this.options.selectMany,popup:this.options.storage&&this.options.storage.popup,show:this.options.storage&&this.options.storage.show}}),this.ui.storage.$on("remove",this.removeFiles.bind(this))}renderUpload(){this.ui.upload=new Ne({target:this.options.uploadEl,props:{id:this.options.id,popup:this.options.upload&&this.options.upload.popup,show:this.options.upload&&this.options.upload.show}}),this.ui.upload.$on("filesAdded",this.onUploads.bind(this)),this.ui.upload.$on("remove",this.removeUpload.bind(this))}loadFilesData(){let e={bucket:this.options.bucket,session:this.options.session};return this.getInterface().setFilter(e).setSorter({fileID:-1}).$list({}).then(e=>(this.storage.files.update(t=>(t.splice(0,t.length,...e),t)),e)).catch(e=>{console.error(e,"Список загруженных файлов не доступен!")})}useGlobalInterface(){return this.options.useGlobalInterface&&this.nrFile}getInterface(){return new Ke(qe,this.options)}show(){return new Promise((e,t)=>{this.ui.storage?this.ui.storage.$set({show:!0,onResolve:e,onReject:t}):this.ui.complex&&this.ui.complex.$set({show:!0,onResolve:e,onReject:t})})}async removeFiles(e){let t=e.detail.selected,n={bucket:this.options.bucket,session:this.options.session},s=[];for(let e of t){let t=this.findFileByUUID(e);if(t)try{let e=await this.getInterface().setFilter(n).$delete({fileID:t.fileID});this.isGood(e)&&s.push(t)}catch(e){console.error(e)}}s.forEach(this.removeFromStore.bind(this)),this.resetSelected()}findFileByUUID(e){let t=!1;return this.files.forEach(n=>{n.uuid===e&&(t=n)}),t}isGood(e){return e.status&&"ok"===e.status}removeFromStore(e){this.storage.files.update(t=>{let n=t.indexOf(e);return n>-1&&t.splice(n,1),t})}resetSelected(){this.storage.selected.update(e=>(e.splice(0,e.length),e))}async onUploads(e){console.log("new files to upload",e);let t=e.detail;for(let e of t){let t=await this.preloadFilePreview(e);e.id="fid_"+Math.random();let n={id:e.id,name:e.name,size:e.size,type:e.type,file:e,preview:t};this.addToUploads(n)}}preloadFilePreview(e){return new Promise((t,n)=>{try{let s=new FileReader;s.onload=e=>{let n=document.createElement("canvas");n.width=this.options.preview.width,n.height=this.options.preview.height;let s=n.getContext("2d"),o=new Image;o.onload=()=>{s.drawImage(o,0,0,this.options.preview.width,this.options.preview.height),t(n.toDataURL("image/png"))},o.src=e.target.result},s.onerror=n,s.readAsDataURL(e)}catch(e){n(e)}})}addToUploads(e){this.uploadFile(e).catch(console.error),this.storage.uploads.update(t=>(t.push(e),t))}removeUpload(e){let t=e.detail.selected;console.log("remove uploads",t)}uploadFile(e){let t={bucket:this.options.bucket,session:this.options.session};return this.getInterface().setFilter(t).$create(t,!1,!0,e.file).then(t=>{"ok"===t.status&&this.uploadFinished(e)})}uploadFinished(e){this.storage.uploads.update(t=>{let n;return t.forEach(t=>{t.id===e.id&&(e.uploaded=!0,n=e)}),n&&t.splice(t.indexOf(n),1),t}),this.loadFilesData().catch(console.error)}},e}({});
