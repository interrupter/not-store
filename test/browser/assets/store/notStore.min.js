var notStore=function(e){"use strict";function t(){}function n(e){return e()}function s(){return Object.create(null)}function o(e){e.forEach(n)}function i(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let l,a;function c(e,t){return e===t||(l||(l=document.createElement("a")),l.href=t,e===l.href)}function u(e,t){e.appendChild(t)}function d(e,t,n){e.insertBefore(t,n||null)}function p(e){e.parentNode&&e.parentNode.removeChild(e)}function h(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function f(e){return document.createElement(e)}function g(e){return document.createTextNode(e)}function m(){return g(" ")}function v(){return g("")}function $(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function b(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function w(e,t){t=""+t,e.data!==t&&(e.data=t)}function y(e){a=e}function x(){if(!a)throw new Error("Function called outside component initialization");return a}function k(e){x().$$.on_mount.push(e)}function O(){const e=x();return(t,n,{cancelable:s=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=function(e,t,{bubbles:n=!1,cancelable:s=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:s})}(t,n,{cancelable:s});return o.slice().forEach((t=>{t.call(e,i)})),!i.defaultPrevented}return!0}}function S(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const P=[],_=[];let R=[];const A=[],z=Promise.resolve();let F=!1;function j(e){R.push(e)}function E(e){A.push(e)}const M=new Set;let C=0;function U(){if(0!==C)return;const e=a;do{try{for(;C<P.length;){const e=P[C];C++,y(e),D(e.$$)}}catch(e){throw P.length=0,C=0,e}for(y(null),P.length=0,C=0;_.length;)_.pop()();for(let e=0;e<R.length;e+=1){const t=R[e];M.has(t)||(M.add(t),t())}R.length=0}while(P.length);for(;A.length;)A.pop()();F=!1,M.clear(),y(e)}function D(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(j)}}const I=new Set;let N;function L(){N={r:0,c:[],p:N}}function T(){N.r||o(N.c),N=N.p}function B(e,t){e&&e.i&&(I.delete(e),e.i(t))}function q(e,t,n,s){if(e&&e.o){if(I.has(e))return;I.add(e),N.c.push((()=>{I.delete(e),s&&(n&&e.d(1),s())})),e.o(t)}else s&&s()}function G(e){return void 0!==e?.length?e:Array.from(e)}function V(e,t){q(e,1,1,(()=>{t.delete(e.key)}))}function H(e,t,n){const s=e.$$.props[t];void 0!==s&&(e.$$.bound[s]=n,n(e.$$.ctx[s]))}function J(e){e&&e.c()}function K(e,t,s){const{fragment:r,after_update:l}=e.$$;r&&r.m(t,s),j((()=>{const t=e.$$.on_mount.map(n).filter(i);e.$$.on_destroy?e.$$.on_destroy.push(...t):o(t),e.$$.on_mount=[]})),l.forEach(j)}function X(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];R.forEach((s=>-1===e.indexOf(s)?t.push(s):n.push(s))),n.forEach((e=>e())),R=t}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Q(e,t){-1===e.$$.dirty[0]&&(P.push(e),F||(F=!0,z.then(U)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function W(e,n,i,r,l,c,u=null,d=[-1]){const h=a;y(e);const f=e.$$={fragment:null,ctx:[],props:c,update:t,not_equal:l,bound:s(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(h?h.$$.context:[])),callbacks:s(),dirty:d,skip_bound:!1,root:n.target||h.$$.root};u&&u(f.root);let g=!1;if(f.ctx=i?i(e,n.props||{},((t,n,...s)=>{const o=s.length?s[0]:n;return f.ctx&&l(f.ctx[t],f.ctx[t]=o)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](o),g&&Q(e,t)),n})):[],f.update(),g=!0,o(f.before_update),f.fragment=!!r&&r(f.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);f.fragment&&f.fragment.l(e),e.forEach(p)}else f.fragment&&f.fragment.c();n.intro&&B(e.$$.fragment),K(e,n.target,n.anchor),U()}y(h)}class Y{$$=void 0;$$set=void 0;$destroy(){X(this,1),this.$destroy=t}$on(e,n){if(!i(n))return t;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const e=s.indexOf(n);-1!==e&&s.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function Z(e){let n,s,i,r,l,a,c,h,v,y,x,k,O,S,P,_,R,A,z,F,j,E,M,C,U,D,I,N=e[3].approve+"",L=e[3].disapprove+"";return{c(){n=f("div"),s=f("div"),i=m(),r=f("div"),l=f("header"),a=f("p"),c=g(e[0]),h=m(),v=f("button"),y=m(),x=f("section"),k=f("p"),O=g(e[1]),S=m(),P=f("label"),_=f("input"),R=m(),A=g(e[2]),z=m(),F=f("footer"),j=f("button"),E=g(N),M=m(),C=f("button"),U=g(L),b(s,"class","modal-background"),b(a,"class","modal-card-title"),b(v,"class","delete"),b(v,"aria-label","close"),b(l,"class","modal-card-head"),b(_,"type","checkbox"),b(_,"class","confirm-approval"),b(P,"class","checkbox"),b(x,"class","modal-card-body"),b(j,"class","button is-success confirm-approve"),j.disabled=e[5],b(C,"class","button confirm-disapprove"),b(F,"class","modal-card-foot"),b(r,"class","modal-card"),b(n,"class","modal is-active")},m(t,o){d(t,n,o),u(n,s),u(n,i),u(n,r),u(r,l),u(l,a),u(a,c),u(l,h),u(l,v),u(r,y),u(r,x),u(x,k),u(k,O),u(x,S),u(x,P),u(P,_),_.checked=e[4],u(P,R),u(P,A),u(r,z),u(r,F),u(F,j),u(j,E),u(F,M),u(F,C),u(C,U),D||(I=[$(v,"click",e[6]),$(_,"change",e[10]),$(j,"click",e[7]),$(C,"click",e[6])],D=!0)},p(e,[t]){1&t&&w(c,e[0]),2&t&&w(O,e[1]),16&t&&(_.checked=e[4]),4&t&&w(A,e[2]),8&t&&N!==(N=e[3].approve+"")&&w(E,N),32&t&&(j.disabled=e[5]),8&t&&L!==(L=e[3].disapprove+"")&&w(U,L)},i:t,o:t,d(e){e&&p(n),D=!1,o(I)}}}function ee(e,t,n){let s,o=!1,{title:i="title"}=t,{text:r="text"}=t,{approval:l="approval"}=t,{resolve:a=(()=>{})}=t,{reject:c=(()=>{})}=t,{label:u={approve:"Да",disapprove:"Нет"}}=t;return e.$$set=e=>{"title"in e&&n(0,i=e.title),"text"in e&&n(1,r=e.text),"approval"in e&&n(2,l=e.approval),"resolve"in e&&n(8,a=e.resolve),"reject"in e&&n(9,c=e.reject),"label"in e&&n(3,u=e.label)},e.$$.update=()=>{16&e.$$.dirty&&n(5,s=!o)},[i,r,l,u,o,s,function(){c()},function(){a()},a,c,function(){o=this.checked,n(4,o)}]}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");class te extends Y{constructor(e){super(),W(this,e,ee,Z,r,{title:0,text:1,approval:2,resolve:8,reject:9,label:3})}}class ne{static ask({approval:e,text:t,title:n}){return new Promise((function(s,o){let i=new te({props:{approval:e,reject(){i.$destroy(),o()},resolve(){i.$destroy(),s()},text:t,title:n},target:document.body})}))}}const se=[];function oe(e,n=t){let s;const o=new Set;function i(t){if(r(e,t)&&(e=t,s)){const t=!se.length;for(const t of o)t[1](),se.push(t,e);if(t){for(let e=0;e<se.length;e+=2)se[e][0](se[e+1]);se.length=0}}}function l(t){i(t(e))}return{set:i,update:l,subscribe:function(r,a=t){const c=[r,a];return o.add(c),1===o.size&&(s=n(i,l)||t),r(e),()=>{o.delete(c),0===o.size&&s&&(s(),s=null)}}}}const ie={};function re(e){return Object.hasOwn(ie,e)}function le(e,t=!1){return re(e)?ie[e]:!!t&&ae(e)}function ae(e){return re(e)||(ie[e]={files:oe([]),selected:oe([]),uploads:oe([])}),ie[e]}var ce=Object.freeze({__proto__:null,create:ae,get:le});function ue(e){let t,n,s;return{c(){t=f("progress"),n=g(e[0]),s=g("%"),b(t,"class","progress is-link"),t.value=e[0],b(t,"max","100")},m(e,o){d(e,t,o),u(t,n),u(t,s)},p(e,s){1&s&&w(n,e[0]),1&s&&(t.value=e[0])},d(e){e&&p(t)}}}function de(e){let t,n,s,o,i,r,l,a,h,v=e[3].name+"",$=!e[2]&&pe(e);return{c(){t=f("figure"),$&&$.c(),n=m(),s=f("img"),r=m(),l=f("div"),a=f("div"),h=g(v),b(s,"draggable","true"),c(s.src,o=e[3].info?.variantURL?.micro||e[3].cloud.Location)||b(s,"src",o),b(s,"alt",i=e[3].name),b(s,"crossorigin","anonymous"),b(s,"class","svelte-zezlqo"),b(a,"class","text svelte-zezlqo"),b(l,"draggable","true"),b(l,"class","middle svelte-zezlqo"),b(t,"class","image is-4by3 svelte-zezlqo")},m(e,o){d(e,t,o),$&&$.m(t,null),u(t,n),u(t,s),u(t,r),u(t,l),u(l,a),u(a,h)},p(e,r){e[2]?$&&($.d(1),$=null):$?$.p(e,r):($=pe(e),$.c(),$.m(t,n)),8&r&&!c(s.src,o=e[3].info?.variantURL?.micro||e[3].cloud.Location)&&b(s,"src",o),8&r&&i!==(i=e[3].name)&&b(s,"alt",i),8&r&&v!==(v=e[3].name+"")&&w(h,v)},d(e){e&&p(t),$&&$.d()}}}function pe(e){let n,s,o;return{c(){n=f("button"),b(n,"class","delete svelte-zezlqo")},m(t,i){d(t,n,i),s||(o=$(n,"click",e[6]),s=!0)},p:t,d(e){e&&p(n),s=!1,o()}}}function he(e){let n,s,o,i,r,l,a=e[1]&&ue(e),c=e[3].path&&de(e);return{c(){n=f("div"),a&&a.c(),s=m(),c&&c.c(),b(n,"class",o="column file-tile is-one-quarter-desktop is-half-mobile "+e[4]+" svelte-zezlqo"),b(n,"data-uuid",i=e[3].uuid)},m(t,o){d(t,n,o),a&&a.m(n,null),u(n,s),c&&c.m(n,null),r||(l=$(n,"click",e[5]),r=!0)},p(e,[t]){e[1]?a?a.p(e,t):(a=ue(e),a.c(),a.m(n,s)):a&&(a.d(1),a=null),e[3].path?c?c.p(e,t):(c=de(e),c.c(),c.m(n,null)):c&&(c.d(1),c=null),16&t&&o!==(o="column file-tile is-one-quarter-desktop is-half-mobile "+e[4]+" svelte-zezlqo")&&b(n,"class",o),8&t&&i!==(i=e[3].uuid)&&b(n,"data-uuid",i)},i:t,o:t,d(e){e&&p(n),a&&a.d(),c&&c.d(),r=!1,l()}}}function fe(e,t,n){let s;const o=O();let{progress:i=0}=t,{selected:r=!1}=t,{notUploaded:l=!1}=t,{selectMany:a=!1}=t,{hideDeleteButton:c=!1}=t,{storeId:u}=t,{data:d={name:"default.file.name",size:1e3,preview:!1}}=t;return k((()=>{le(u).selected.subscribe((e=>{e.indexOf(d.uuid)>-1?n(7,r=!0):n(7,r=!1)}))})),e.$$set=e=>{"progress"in e&&n(0,i=e.progress),"selected"in e&&n(7,r=e.selected),"notUploaded"in e&&n(1,l=e.notUploaded),"selectMany"in e&&n(8,a=e.selectMany),"hideDeleteButton"in e&&n(2,c=e.hideDeleteButton),"storeId"in e&&n(9,u=e.storeId),"data"in e&&n(3,d=e.data)},e.$$.update=()=>{128&e.$$.dirty&&n(4,s=r?"selected":"")},[i,l,c,d,s,function(){le(u).selected.update((e=>(e.indexOf(d.uuid)>-1?e.splice(e.indexOf(d.uuid),1):(a?e.push(d.uuid):e.splice(0,e.length,d.uuid),o("selected")),e)))},function(){ne.ask({title:`Удаление файла (${d.name}) `,text:"Файл будет удалён без возможнеости восстановления!",approval:"Удалить файл?"}).then((()=>{o("remove",d)})).catch((()=>{}))},r,a,u]}class ge extends Y{constructor(e){super(),W(this,e,fe,he,r,{progress:0,selected:7,notUploaded:1,selectMany:8,hideDeleteButton:2,storeId:9,data:3})}}function me(e,t,n){const s=e.slice();return s[24]=t[n],s[25]=t,s[26]=n,s}function ve(e,t,n){const s=e.slice();return s[24]=t[n],s[27]=t,s[28]=n,s}function $e(e){let t,n,s,o=G(e[0]),i=[];for(let t=0;t<o.length;t+=1)i[t]=be(ve(e,o,t));const r=e=>q(i[e],1,1,(()=>{i[e]=null}));return{c(){t=f("div"),n=f("div");for(let e=0;e<i.length;e+=1)i[e].c();b(n,"class","file-list columns is-mobile is-multiline svelte-fdc82o"),b(t,"class","file-list-wrapper svelte-fdc82o")},m(o,r){d(o,t,r),u(t,n);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(n,null);e[19](t),s=!0},p(e,t){if(4141&t){let s;for(o=G(e[0]),s=0;s<o.length;s+=1){const r=ve(e,o,s);i[s]?(i[s].p(r,t),B(i[s],1)):(i[s]=be(r),i[s].c(),B(i[s],1),i[s].m(n,null))}for(L(),s=o.length;s<i.length;s+=1)r(s);T()}},i(e){if(!s){for(let e=0;e<o.length;e+=1)B(i[e]);s=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)q(i[e]);s=!1},d(n){n&&p(t),h(i,n),e[19](null)}}}function be(e){let t,n,s;function o(t){e[17](t,e[24],e[27],e[28])}let i={elementSize:e[5],storeId:e[2],selectMany:e[3]};return void 0!==e[24]&&(i.data=e[24]),t=new ge({props:i}),_.push((()=>H(t,"data",o))),t.$on("remove",e[12]),t.$on("selected",e[18]),{c(){J(t.$$.fragment)},m(e,n){K(t,e,n),s=!0},p(s,o){e=s;const i={};32&o&&(i.elementSize=e[5]),4&o&&(i.storeId=e[2]),8&o&&(i.selectMany=e[3]),!n&&1&o&&(n=!0,i.data=e[24],E((()=>n=!1))),t.$set(i)},i(e){s||(B(t.$$.fragment,e),s=!0)},o(e){q(t.$$.fragment,e),s=!1},d(e){X(t,e)}}}function we(e){let t,n,s,i,r,l,a,c,h,g,v,w,y,x,k,O,S,P,_,R,A,z=[],F=new Map,j=G(e[0]);const E=e=>e[24].id;for(let t=0;t<j.length;t+=1){let n=me(e,j,t),s=E(n);F.set(s,z[t]=ye(s,n))}return{c(){t=f("div"),n=f("div"),s=m(),i=f("div"),r=f("header"),l=f("p"),l.textContent="Выберите файл",a=m(),c=f("button"),h=m(),g=f("section"),v=f("div");for(let e=0;e<z.length;e+=1)z[e].c();w=m(),y=f("footer"),x=f("button"),x.textContent="Выбрать",k=m(),O=f("button"),O.textContent="Удалить",S=m(),P=f("button"),P.textContent="Закрыть",b(n,"class","modal-background"),b(l,"class","modal-card-title"),b(c,"class","delete"),b(c,"aria-label","close"),b(r,"class","modal-card-head"),b(v,"class","file-list columns is-multiline svelte-fdc82o"),b(g,"class","modal-card-body"),b(x,"class","button is-success"),b(O,"class","button is-danger"),b(P,"class","button"),b(y,"class","modal-card-foot"),b(i,"class","modal-card"),b(t,"class","modal is-active")},m(o,p){d(o,t,p),u(t,n),u(t,s),u(t,i),u(i,r),u(r,l),u(r,a),u(r,c),u(i,h),u(i,g),u(g,v);for(let e=0;e<z.length;e+=1)z[e]&&z[e].m(v,null);u(i,w),u(i,y),u(y,x),u(y,k),u(y,O),u(y,S),u(y,P),e[22](t),_=!0,R||(A=[$(c,"click",e[8]),$(x,"click",e[10]),$(O,"click",e[11]),$(P,"click",e[9])],R=!0)},p(e,t){4109&t&&(j=G(e[0]),L(),z=function(e,t,n,s,i,r,l,a,c,u,d,p){let h=e.length,f=r.length,g=h;const m={};for(;g--;)m[e[g].key]=g;const v=[],$=new Map,b=new Map,w=[];for(g=f;g--;){const e=p(i,r,g),o=n(e);let a=l.get(o);a?s&&w.push((()=>a.p(e,t))):(a=u(o,e),a.c()),$.set(o,v[g]=a),o in m&&b.set(o,Math.abs(g-m[o]))}const y=new Set,x=new Set;function k(e){B(e,1),e.m(a,d),l.set(e.key,e),d=e.first,f--}for(;h&&f;){const t=v[f-1],n=e[h-1],s=t.key,o=n.key;t===n?(d=t.first,h--,f--):$.has(o)?!l.has(s)||y.has(s)?k(t):x.has(o)?h--:b.get(s)>b.get(o)?(x.add(s),k(t)):(y.add(o),h--):(c(n,l),h--)}for(;h--;){const t=e[h];$.has(t.key)||c(t,l)}for(;f;)k(v[f-1]);return o(w),v}(z,t,E,1,e,j,F,v,V,ye,null,me),T())},i(e){if(!_){for(let e=0;e<j.length;e+=1)B(z[e]);_=!0}},o(e){for(let e=0;e<z.length;e+=1)q(z[e]);_=!1},d(n){n&&p(t);for(let e=0;e<z.length;e+=1)z[e].d();e[22](null),R=!1,o(A)}}}function ye(e,t){let n,s,o,i;function r(e){t[20](e,t[24],t[25],t[26])}let l={storeId:t[2],selectMany:t[3]};return void 0!==t[24]&&(l.data=t[24]),s=new ge({props:l}),_.push((()=>H(s,"data",r))),s.$on("remove",t[12]),s.$on("selected",t[21]),{key:e,first:null,c(){n=v(),J(s.$$.fragment),this.first=n},m(e,t){d(e,n,t),K(s,e,t),i=!0},p(e,n){t=e;const i={};4&n&&(i.storeId=t[2]),8&n&&(i.selectMany=t[3]),!o&&1&n&&(o=!0,i.data=t[24],E((()=>o=!1))),s.$set(i)},i(e){i||(B(s.$$.fragment,e),i=!0)},o(e){q(s.$$.fragment,e),i=!1},d(e){e&&p(n),X(s,e)}}}function xe(e){let t,n,s,o=!e[4]&&e[1]&&$e(e),i=e[4]&&e[1]&&we(e);return{c(){o&&o.c(),t=m(),i&&i.c(),n=v()},m(e,r){o&&o.m(e,r),d(e,t,r),i&&i.m(e,r),d(e,n,r),s=!0},p(e,[s]){!e[4]&&e[1]?o?(o.p(e,s),18&s&&B(o,1)):(o=$e(e),o.c(),B(o,1),o.m(t.parentNode,t)):o&&(L(),q(o,1,1,(()=>{o=null})),T()),e[4]&&e[1]?i?(i.p(e,s),18&s&&B(i,1)):(i=we(e),i.c(),B(i,1),i.m(n.parentNode,n)):i&&(L(),q(i,1,1,(()=>{i=null})),T())},i(e){s||(B(o),B(i),s=!0)},o(e){q(o),q(i),s=!1},d(e){e&&(p(t),p(n)),o&&o.d(e),i&&i.d(e)}}}function ke(e,t,n){let s=null,o=null;const i=O();let{files:r=[]}=t,{selected:l=[]}=t,{id:a}=t,{selectMany:c}=t,{popup:u=!1}=t,{show:d=!1}=t,{elementSize:p=3}=t,{onReject:h=null}=t,{onResolve:f=null}=t;function g(){n(1,d=!1)}return k((()=>{le(a).files.subscribe((e=>{r.forEach(((e,t)=>{e.id=t})),n(0,r=e)})),le(a).selected.subscribe((e=>{n(13,l=e)}))})),e.$$set=e=>{"files"in e&&n(0,r=e.files),"selected"in e&&n(13,l=e.selected),"id"in e&&n(2,a=e.id),"selectMany"in e&&n(3,c=e.selectMany),"popup"in e&&n(4,u=e.popup),"show"in e&&n(1,d=e.show),"elementSize"in e&&n(5,p=e.elementSize),"onReject"in e&&n(14,h=e.onReject),"onResolve"in e&&n(15,f=e.onResolve)},[r,d,a,c,u,p,s,o,g,function(){g(),h?(h(),n(14,h=null)):i("reject")},function(){if(g(),l.length){let e=r.filter((e=>l.indexOf(e.uuid)>-1));f?(f(e),n(15,f=null)):i("resolve",{selected:e})}else f?(f([]),n(15,f=null)):i("resolve",{selected:[]})},function(){ne.ask({title:`Удаление файлов (${l.length}) `,text:"Файлы будут удалены без возможнеости восстановления!",approval:"Удалить файлы?"}).then((()=>{console.log("remove approved"),i("remove",{selected:l})})).catch((()=>{console.log("remove disapprove")}))},function(e){console.log("removeFile",e),i("remove",{selected:[e.detail.uuid]})},l,h,f,function(e){le(a).update((t=>(t.splice(0,t.length,...e),t)))},function(e,t,s,o){s[o]=e,n(0,r)},function(t){S.call(this,e,t)},function(e){_[e?"unshift":"push"]((()=>{s=e,n(6,s)}))},function(e,t,s,o){s[o]=e,n(0,r)},function(t){S.call(this,e,t)},function(e){_[e?"unshift":"push"]((()=>{o=e,n(7,o)}))}]}class Oe extends Y{constructor(e){super(),W(this,e,ke,xe,r,{files:0,selected:13,id:2,selectMany:3,popup:4,show:1,elementSize:5,onReject:14,onResolve:15,updateFiles:16})}get updateFiles(){return this.$$.ctx[16]}}function Se(e){let t;return{c(){t=f("progress"),b(t,"class","progress is-link")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Pe(e){let t,n,s,o;return{c(){t=f("figure"),n=f("img"),b(n,"alt",s=e[1].name),c(n.src,o=e[1].preview)||b(n,"src",o),b(n,"class","svelte-dd1rpy"),b(t,"class","image is-4by3 svelte-dd1rpy")},m(e,s){d(e,t,s),u(t,n)},p(e,t){2&t&&s!==(s=e[1].name)&&b(n,"alt",s),2&t&&!c(n.src,o=e[1].preview)&&b(n,"src",o)},d(e){e&&p(t)}}}function _e(e){let n,s,o,i=!e[0]&&Se(),r="string"==typeof e[1].preview&&Pe(e);return{c(){n=f("div"),i&&i.c(),s=m(),r&&r.c(),b(n,"class","tile file is-3 is-child svelte-dd1rpy"),b(n,"data-id",o=e[1].id)},m(e,t){d(e,n,t),i&&i.m(n,null),u(n,s),r&&r.m(n,null)},p(e,[t]){e[0]?i&&(i.d(1),i=null):i||(i=Se(),i.c(),i.m(n,s)),"string"==typeof e[1].preview?r?r.p(e,t):(r=Pe(e),r.c(),r.m(n,null)):r&&(r.d(1),r=null),2&t&&o!==(o=e[1].id)&&b(n,"data-id",o)},i:t,o:t,d(e){e&&p(n),i&&i.d(),r&&r.d()}}}function Re(e,t,n){let{uploaded:s=!1}=t,{data:o={name:"default.file.name",size:1e3,preview:!1}}=t;return e.$$set=e=>{"uploaded"in e&&n(0,s=e.uploaded),"data"in e&&n(1,o=e.data)},[s,o]}class Ae extends Y{constructor(e){super(),W(this,e,Re,_e,r,{uploaded:0,data:1})}}function ze(e,t,n){const s=e.slice();return s[14]=t[n],s}function Fe(e){let t,n,s,o,i,r,l,a,c,h,w,y;const x=[Ee,je],k=[];function O(e,t){return 0===e[0].length?0:1}return l=O(e),a=k[l]=x[l](e),{c(){t=f("div"),n=f("label"),s=f("form"),o=f("input"),i=g("\n                Выберите изображения для загрузки"),r=m(),a.c(),c=v(),b(o,"class","file-input"),b(o,"type","file"),b(o,"name",e[3]),b(o,"accept",e[4]),o.multiple=e[5],b(s,"action","./"),b(s,"class","svelte-112twgk"),b(n,"for","file"),b(n,"class","svelte-112twgk"),b(t,"class","box has-background-light is-size-4-desktop is-size-5-mobile dropzone svelte-112twgk")},m(a,p){d(a,t,p),u(t,n),u(n,s),u(s,o),u(s,i),e[10](t),d(a,r,p),k[l].m(a,p),d(a,c,p),h=!0,w||(y=$(o,"change",e[7]),w=!0)},p(e,t){(!h||8&t)&&b(o,"name",e[3]),(!h||16&t)&&b(o,"accept",e[4]),(!h||32&t)&&(o.multiple=e[5]);let n=l;l=O(e),l===n?k[l].p(e,t):(L(),q(k[n],1,1,(()=>{k[n]=null})),T(),a=k[l],a?a.p(e,t):(a=k[l]=x[l](e),a.c()),B(a,1),a.m(c.parentNode,c))},i(e){h||(B(a),h=!0)},o(e){q(a),h=!1},d(n){n&&(p(t),p(r),p(c)),e[10](null),k[l].d(n),w=!1,y()}}}function je(e){let t,n,s,o=e[0].length>0&&Me(e);return{c(){t=f("div"),o&&o.c(),b(t,"class",n="previews "+(e[2]?"short":"long")+" svelte-112twgk")},m(e,n){d(e,t,n),o&&o.m(t,null),s=!0},p(e,i){e[0].length>0?o?(o.p(e,i),1&i&&B(o,1)):(o=Me(e),o.c(),B(o,1),o.m(t,null)):o&&(L(),q(o,1,1,(()=>{o=null})),T()),(!s||4&i&&n!==(n="previews "+(e[2]?"short":"long")+" svelte-112twgk"))&&b(t,"class",n)},i(e){s||(B(o),s=!0)},o(e){q(o),s=!1},d(e){e&&p(t),o&&o.d()}}}function Ee(e){let n;return{c(){n=f("div"),n.innerHTML='<h2 class="subtitle">Нет загружаемых файлов</h2>',b(n,"class","previews has-text-centered svelte-112twgk")},m(e,t){d(e,n,t)},p:t,i:t,o:t,d(e){e&&p(n)}}}function Me(e){let t,n,s=G(e[0]),o=[];for(let t=0;t<s.length;t+=1)o[t]=Ce(ze(e,s,t));const i=e=>q(o[e],1,1,(()=>{o[e]=null}));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=v()},m(e,s){for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,s);d(e,t,s),n=!0},p(e,n){if(1&n){let r;for(s=G(e[0]),r=0;r<s.length;r+=1){const i=ze(e,s,r);o[r]?(o[r].p(i,n),B(o[r],1)):(o[r]=Ce(i),o[r].c(),B(o[r],1),o[r].m(t.parentNode,t))}for(L(),r=s.length;r<o.length;r+=1)i(r);T()}},i(e){if(!n){for(let e=0;e<s.length;e+=1)B(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)q(o[e]);n=!1},d(e){e&&p(t),h(o,e)}}}function Ce(e){let t,n;return t=new Ae({props:{data:e[14]}}),{c(){J(t.$$.fragment)},m(e,s){K(t,e,s),n=!0},p(e,n){const s={};1&n&&(s.data=e[14]),t.$set(s)},i(e){n||(B(t.$$.fragment,e),n=!0)},o(e){q(t.$$.fragment,e),n=!1},d(e){X(t,e)}}}function Ue(e){let t,n,s=e[1]&&Fe(e);return{c(){s&&s.c(),t=v()},m(e,o){s&&s.m(e,o),d(e,t,o),n=!0},p(e,[n]){e[1]?s?(s.p(e,n),2&n&&B(s,1)):(s=Fe(e),s.c(),B(s,1),s.m(t.parentNode,t)):s&&(L(),q(s,1,1,(()=>{s=null})),T())},i(e){n||(B(s),n=!0)},o(e){q(s),n=!1},d(e){e&&p(t),s&&s.d(e)}}}function De(e,t,n){const s=O();let o,{id:i}=t,{uploads:r=[]}=t,{show:l=!1}=t,{short:a=!1}=t,{fieldname:c="file"}=t,{accept:u="image/*"}=t,{multiple:d=!0}=t;return k((()=>{le(i,!0).uploads.subscribe((e=>{n(0,r=e)})),o&&(o.addEventListener("dragenter",(function(e){e.preventDefault(),e.stopPropagation(),o.classList.add("has-background-white")})),o.addEventListener("dragleave",(function(e){e.preventDefault(),e.stopPropagation(),o.classList.remove("has-background-white")})),o.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation()})),o.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation(),o.classList.remove("has-background-white"),s("filesAdded",e.dataTransfer.files)})))})),e.$$set=e=>{"id"in e&&n(8,i=e.id),"uploads"in e&&n(0,r=e.uploads),"show"in e&&n(1,l=e.show),"short"in e&&n(2,a=e.short),"fieldname"in e&&n(3,c=e.fieldname),"accept"in e&&n(4,u=e.accept),"multiple"in e&&n(5,d=e.multiple)},[r,l,a,c,u,d,o,function(e){s("filesAdded",e.target.files)},i,function(){n(1,l=!1),s("resolve")},function(e){_[e?"unshift":"push"]((()=>{o=e,n(6,o)}))}]}class Ie extends Y{constructor(e){super(),W(this,e,De,Ue,r,{id:8,uploads:0,show:1,short:2,fieldname:3,accept:4,multiple:5,resolvePopup:9})}get resolvePopup(){return this.$$.ctx[9]}}function Ne(e){let t,n,s,o,i,r,l,a,c,h,g,v,w,y,x,k,O,S=!e[3]&&Le(e);function P(t){e[18](t)}let R={popup:!1,show:!0,short:!0};function A(t){e[19](t)}function z(t){e[20](t)}void 0!==e[0]&&(R.id=e[0]),a=new Ie({props:R}),_.push((()=>H(a,"id",P))),a.$on("filesAdded",e[10]);let F={popup:!1,show:!0};void 0!==e[0]&&(F.id=e[0]),void 0!==e[1]&&(F.selectMany=e[1]),g=new Oe({props:F}),_.push((()=>H(g,"id",A))),_.push((()=>H(g,"selectMany",z))),g.$on("remove",e[12]),g.$on("selected",e[9]);let j=!e[3]&&Te(e);return{c(){t=f("div"),n=f("div"),s=m(),o=f("div"),S&&S.c(),i=m(),r=f("section"),l=f("div"),J(a.$$.fragment),h=m(),J(g.$$.fragment),y=m(),j&&j.c(),b(n,"class","modal-background"),b(l,"class","container"),b(r,"class","modal-card-body"),b(o,"class","modal-card box is-rounded"),b(t,"class","modal is-active")},m(c,p){d(c,t,p),u(t,n),u(t,s),u(t,o),S&&S.m(o,null),u(o,i),u(o,r),u(r,l),K(a,l,null),u(l,h),K(g,l,null),u(o,y),j&&j.m(o,null),x=!0,k||(O=$(n,"click",e[8]),k=!0)},p(e,t){e[3]?S&&(S.d(1),S=null):S?S.p(e,t):(S=Le(e),S.c(),S.m(o,i));const n={};!c&&1&t&&(c=!0,n.id=e[0],E((()=>c=!1))),a.$set(n);const s={};!v&&1&t&&(v=!0,s.id=e[0],E((()=>v=!1))),!w&&2&t&&(w=!0,s.selectMany=e[1],E((()=>w=!1))),g.$set(s),e[3]?j&&(j.d(1),j=null):j?j.p(e,t):(j=Te(e),j.c(),j.m(o,null))},i(e){x||(B(a.$$.fragment,e),B(g.$$.fragment,e),x=!0)},o(e){q(a.$$.fragment,e),q(g.$$.fragment,e),x=!1},d(e){e&&p(t),S&&S.d(),X(a),X(g),j&&j.d(),k=!1,O()}}}function Le(e){let n,s,o,i,r,l;return{c(){n=f("header"),s=f("p"),s.textContent="Добавьте файлы для загрузки",o=m(),i=f("button"),b(s,"class","modal-card-title"),b(i,"class","delete"),b(i,"aria-label","close"),b(n,"class","modal-card-head")},m(t,a){d(t,n,a),u(n,s),u(n,o),u(n,i),r||(l=$(i,"click",e[6]),r=!0)},p:t,d(e){e&&p(n),r=!1,l()}}}function Te(e){let n,s,i,r,l,a,c,h;return{c(){n=f("footer"),s=f("button"),s.textContent="Выбрать",i=m(),r=f("button"),r.textContent="Удалить",l=m(),a=f("button"),a.textContent="Закрыть",b(s,"class","button is-success"),b(r,"class","button is-danger"),b(a,"class","button"),b(n,"class","modal-card-foot")},m(t,o){d(t,n,o),u(n,s),u(n,i),u(n,r),u(n,l),u(n,a),c||(h=[$(s,"click",e[7]),$(r,"click",e[11]),$(a,"click",e[8])],c=!0)},p:t,d(e){e&&p(n),c=!1,o(h)}}}function Be(e){let t,n,s,o;return t=new Ie({props:{show:!0,id:e[0]}}),t.$on("filesAdded",e[10]),s=new Oe({props:{popup:!1,elementSize:e[5],show:!0,id:e[0],selectMany:!1}}),s.$on("remove",e[12]),{c(){J(t.$$.fragment),n=m(),J(s.$$.fragment)},m(e,i){K(t,e,i),d(e,n,i),K(s,e,i),o=!0},p(e,n){const o={};1&n&&(o.id=e[0]),t.$set(o);const i={};32&n&&(i.elementSize=e[5]),1&n&&(i.id=e[0]),s.$set(i)},i(e){o||(B(t.$$.fragment,e),B(s.$$.fragment,e),o=!0)},o(e){q(t.$$.fragment,e),q(s.$$.fragment,e),o=!1},d(e){e&&p(n),X(t,e),X(s,e)}}}function qe(e){let t,n,s,o=e[4]&&e[2]&&Ne(e),i=!e[4]&&e[2]&&Be(e);return{c(){o&&o.c(),t=m(),i&&i.c(),n=v()},m(e,r){o&&o.m(e,r),d(e,t,r),i&&i.m(e,r),d(e,n,r),s=!0},p(e,[s]){e[4]&&e[2]?o?(o.p(e,s),20&s&&B(o,1)):(o=Ne(e),o.c(),B(o,1),o.m(t.parentNode,t)):o&&(L(),q(o,1,1,(()=>{o=null})),T()),!e[4]&&e[2]?i?(i.p(e,s),20&s&&B(i,1)):(i=Be(e),i.c(),B(i,1),i.m(n.parentNode,n)):i&&(L(),q(i,1,1,(()=>{i=null})),T())},i(e){s||(B(o),B(i),s=!0)},o(e){q(o),q(i),s=!1},d(e){e&&(p(t),p(n)),o&&o.d(e),i&&i.d(e)}}}function Ge(e,t,n){const s=O();k((()=>{le(o).files.subscribe((e=>{n(13,i=e)})),le(o).selected.subscribe((e=>{n(14,r=e)}))}));let{id:o}=t,{files:i=[]}=t,{selected:r=[]}=t,{selectMany:l}=t,{selectOnClick:a}=t,{short:c=!1}=t,{show:u=!0}=t,{popup:d=!0}=t,{elementSize:p=3}=t,{onReject:h}=t,{onResolve:f}=t;function g(){n(2,u=!1)}function m(){if(g(),r.length){let e=i.filter((e=>r.indexOf(e.uuid)>-1));f?(f(e),n(16,f=null)):s("resolve",{selected:e})}else f?(f([]),n(16,f=null)):s("resolve",{selected:[]})}return e.$$set=e=>{"id"in e&&n(0,o=e.id),"files"in e&&n(13,i=e.files),"selected"in e&&n(14,r=e.selected),"selectMany"in e&&n(1,l=e.selectMany),"selectOnClick"in e&&n(17,a=e.selectOnClick),"short"in e&&n(3,c=e.short),"show"in e&&n(2,u=e.show),"popup"in e&&n(4,d=e.popup),"elementSize"in e&&n(5,p=e.elementSize),"onReject"in e&&n(15,h=e.onReject),"onResolve"in e&&n(16,f=e.onResolve)},[o,l,u,c,d,p,g,m,function(){g(),h?(h(),n(15,h=null)):s("reject")},function(){a&&m()},function(e){s("filesAdded",e.detail)},function(){ne.ask({title:`Удаление файлов (${r.length}) `,text:"Файлы будут удалены без возможнеости восстановления!",approval:"Удалить файлы?"}).then((()=>{s("remove",{selected:r})})).catch((()=>{}))},function(e){s("remove",{selected:e.detail.selected})},i,r,h,f,a,function(e){o=e,n(0,o)},function(e){o=e,n(0,o)},function(e){l=e,n(1,l)}]}class Ve extends Y{constructor(e){super(),W(this,e,Ge,qe,r,{id:0,files:13,selected:14,selectMany:1,selectOnClick:17,short:3,show:2,popup:4,elementSize:5,onReject:15,onResolve:16})}}function He(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const Je=["_id","fileID","uuid","parent","variant","name","extension","store","info","path","cloud","size","createdAt","updatedAt"];var Ke=He({actions:{create:{data:["data"],method:"PUT",postFix:"/:store?",rules:[{root:!0},{auth:!0},{auth:!1}]},delete:{method:"DELETE",postFix:"/:record[_id]",rules:[{root:!0},{auth:!0},{auth:!1}]},listAndCountOriginal:{data:["pager","sorter","filter","search"],fields:Je,method:"get",postFix:"/:actionName",return:Je,rules:[{root:!0,returnRoot:"list",return:Je},{auth:!0,returnRoot:"list",return:Je},{auth:!1,returnRoot:"list",return:Je}]},listAndCount:{data:["pager","sorter","filter","search"],fields:Je,method:"get",postFix:"/:actionName",return:Je,rules:[{root:!0,returnRoot:"list",return:Je},{auth:!0,returnRoot:"list",return:Je},{auth:!1,returnRoot:"list",return:Je}]},get:{data:["filter","data"],method:"GET",postFix:"/:record[_id]",rules:[{root:!0,fields:Je,return:Je},{auth:!0,fields:Je,return:Je},{auth:!1,fields:Je,return:Je}]},getRaw:{data:["filter","data"],method:"GET",postFix:"/:record[_id]/:actionName",rules:[{root:!0,fields:Je,return:Je},{auth:!0,fields:Je,return:Je},{auth:!1,fields:Je,return:Je}]},list:{data:["pager","sorter","filter","search"],method:"GET",rules:[{root:!0,return:Je},{auth:!0,return:Je},{auth:!1,return:Je}]}},fields:{},model:"file",url:"/api/:modelName"});const Xe=".",Qe=":",We="::",Ye="()";var Ze=class{static get SUB_PATH_START(){return"{"}static get SUB_PATH_END(){return"}"}static get PATH_SPLIT(){return Xe}static get PATH_START_OBJECT(){return Qe}static get PATH_START_HELPERS(){return We}static get FUNCTION_MARKER(){return Ye}static get MAX_DEEP(){return 10}static findNextSubPath(e){let t="",n=!1;for(let s=0;s<e.length;s++)if("{"===e[s])n=!0,t="";else{if("}"===e[s]&&n)return t;t+=e[s]}return n?t:null}static replaceSubPath(e,t,n){let s="{"+t+"}",o=0;for(;e.indexOf(s)>-1&&o<10;)e=e.replace(s,n),o++;return e}static parseSubs(e,t,n){let s,o=this.findNextSubPath(e),i=0;for(;o&&(s=this.getValueByPath(o.indexOf(We)>-1?n:t,o,t,n),e=this.replaceSubPath(e,o,s),i++,!(i>10));)o=this.findNextSubPath(e);return e}static get(e,t,n=void 0){switch(e){case Qe:return t;case We:return n}return e=this.parseSubs(e,t,n),this.getValueByPath(e.indexOf(We)>-1?n:t,e,t,n)}static set(e,t,n,s=void 0){3===arguments.length&&(s=n,n=void 0);let o,i=this.findNextSubPath(e),r=0;for(;i&&(o=this.getValueByPath(i.indexOf(We)>-1?n:t,i,t,n),e=this.replaceSubPath(e,i,o),!(r>10));)i=this.findNextSubPath(e),r++;this.setValueByPath(t,e,s),t.isRecord&&this.normilizePath(e).length>1&&t.__isActive&&t.trigger("change",t,e,s)}static unset(e,t,n){this.set(e,t,n,null)}static parsePathStep(e,t,n){let s=null;if(0===e.indexOf(We)&&n){if(s=e.replace(We,""),s.indexOf(Ye)!==s.length-2)return n[s];if(s=s.replace(Ye,""),Object.prototype.hasOwnProperty.call(n,s))return n[s](t,void 0)}else if(0===e.indexOf(Qe)&&t){if(s=e.replace(Qe,""),s.indexOf(Ye)!==s.length-2)return t[s];if(s=s.replace(Ye,""),Object.prototype.hasOwnProperty.call(t,s))return t[s](t,void 0)}return e}static parsePath(e,t,n){Array.isArray(e)||(e=e.split(Xe));for(var s=0;s<e.length;s++)e[s]=this.parsePathStep(e[s],t,n);return e}static normilizePath(e){if(Array.isArray(e))return e;for(;e.indexOf(Qe)>-1;)e=e.replace(Qe,"");return e.split(Xe)}static ifFullSubPath(e,t){if(e.length<t.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}static getValueByPath(e,t,n,s){let o=(t=this.normilizePath(t)).shift(),i=o.indexOf(Ye)>-1;if(i&&(o=o.replace(Ye,"")),("object"==typeof e||"function"==typeof e)&&null!=e&&void 0!==e[o]&&null!==e[o]){let r=i?e[o]({item:n,helpers:s}):e[o];return t.length>0?this.getValueByPath(r,t,n,s):r}}static setValueByPath(e,t,n){let s=(t=this.normilizePath(t)).shift();t.length>0?(Object.prototype.hasOwnProperty.call(e,s)||(e[s]={}),this.setValueByPath(e[s],t,n)):e[s]=n}static join(){return Array.prototype.slice.call(arguments).join(Xe)}},et=He(Ze);const tt=["_id","id","ID"],nt={},st={};class ot{constructor(e,t){return this.options=t,this.manifest=e,this.working={},this.initActions(),this}initActions(){if(this.getActionsCount()>0){let e=this.getActions();for(let t in e)this.initAction(t,e[t])}}initAction(e){var t=this;Object.hasOwn(this,["$"+e])||(this["$"+e]=function(n,s,o=!1,i){return t.request(t,e,n,s,o,i)})}request(e,t,n,s={},o=!1,i){let r=Object.assign({},e,n),l=this.getActionData(t),a=this.collectRequestData(l),c=this.encodeRequest(a),u=this.getServerURL(),d=this.getURL(r,l,t),p={};if(o){d=this.getURL(n,l,t),console.log("request url for file upload",d);const e=new FormData;e.append("file",i),p.body=e}else-1===["OPTIONS","GET"].indexOf(l.method.toUpperCase())&&(p={body:e});return p.method=l.method.toUpperCase(),s&&(p.headers=s),fetch(u+d+c,p).then((function(e){return e.json()}))}getModelName(){return this&&this.manifest?this.manifest.model:null}getActionData(e){return this.getActions()&&this.getActions()[e]?this.getActions()[e]:null}getActionsCount(){return this.getActions()?Object.keys(this.getActions()).length:0}getActions(){return this.manifest&&this.manifest.actions?this.manifest.actions:{}}parseParams(e,t,n,s){let o="",i=e.length;for(;n.indexOf(e)>-1;){let r=n.indexOf(e)+i,l=n.indexOf(t);if(o=n.slice(r,l),""==o)break;console.log(e+o+t,et.get(o,s)),n=n.replace(e+o+t,et.get(o,s))}return n}parseLine(e,t,n){return e=(e=e.replace(":modelName",this.manifest.model)).replace(":actionName",n),e=this.parseParams(":record[","]",e,t),e=this.parseParams(":","?",e,t)}getURL(e,t,n){return this.parseLine(this.manifest.url,e,n)+(Object.hasOwn(t,"postFix")?this.parseLine(t.postFix,e,n):"")}getServerURL(){return this.options.server}encodeRequest(e){let t="?";for(let n in e)void 0!==e[n]&&null!==e[n]&&(t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n].constructor===Object?JSON.stringify(e[n]):e[n])+"&");return this.options.test&&(t+="&test=1",this.options.test.session&&(t+="&session="+this.options.test.session),this.options.test.session&&(t+="&role="+this.options.test.role)),t}collectRequestData(e){let t={};if(Object.hasOwn(e,"data")&&Array.isArray(e.data))for(let s=0;s<e.data.length;s++){let o="get"+((n=e.data[s]).charAt(0).toUpperCase()+n.slice(1));if(this[o]&&"function"==typeof this[o]){let n=this[o](),i={};["pager","sorter","filter","search","return"].indexOf(e.data[s])>-1?i[e.data[s]]=n:i=n,t=Object.assign(t,i)}}var n;return t}getID(e,t){let n,s=tt,o=["",this.manifest.model];Object.hasOwn(t,"index")&&t.index&&(s=[t.index].concat(tt));for(let t of o)for(let o of s)if(Object.hasOwn(e,t+o)){n=e[t+o];break}return n}setFindBy(e,t){var n={};return n[e]=t,this.setFilter(n)}setFilter(e=nt){return et.set("filter",this.working,e),this}resetFilter(){return this.setFilter()}getFilter(){return et.get("filter",this.working)}setSearch(e=""){return et.set("search",this.working,e),this}resetSearch(){return this.setSearch()}getSearch(){return et.get("search",this.working)}setSorter(e){return et.set("sorter",this.working,e),this}resetSorter(){return this.setSorter({})}getSorter(){return et.get("sorter",this.working)}setReturn(e=st){return et.set("return",this.working,e),this}resetReturn(){return this.setReturn({})}getReturn(){return et.get("return",this.working)}setPageNumber(e){return et.set("pager.page",this.working,e),this}setPageSize(e){return et.set("pager.size",this.working,e),this}setPager(e=10,t=1){return e.constructor===Number?et.set("pager",this.working,{page:t,size:e}):e.constructor===Object&&et.set("pager",this.working,{page:e.page||1,size:e.size||10}),this}resetPager(){return this.setPager()}getPager(){return et.get("pager",this.working)}}const it={preview:{height:100,width:100},selectMany:!1,server:"",store:"client"};return e.ComplexComponent=Ve,e.FileStores=ce,e.StorageComponent=Oe,e.UploadComponent=Ie,e.notStore=class{constructor(e){this.options=Object.assign({},it,e),this.ui={},this.init()}init(){return this.generateID(),this.createStore(),this.options.complex&&this.options.complex.popup?(this.renderComplex(),void this.loadFilesData().catch(console.error)):this.options.storageEl?(this.renderStorage(),void this.loadFilesData().catch(console.error)):void(this.options.uploadEl?this.renderUpload():this.options.preload&&this.loadFilesData().catch(console.error))}generateID(){this.options.id||(this.options.id=Math.random())}createStore(){var e=this;this.storage=ae(this.options.id),this.storage.files.subscribe((function(t){e.files=t})),this.storage.selected.subscribe((function(t){e.selected=t})),this.storage.uploads.subscribe((function(t){e.uploads=t}))}renderComplex(){this.ui.complex=new Ve({props:{files:this.files,id:this.options.id,popup:this.options.complex&&this.options.complex.popup,selectMany:this.options.selectMany,selectOnClick:this.options.selectOnClick,short:this.options.complex&&this.options.complex.short,show:this.options.complex&&this.options.complex.show},target:this.options.complexEl}),this.ui.complex.$on("remove",this.removeFiles.bind(this)),this.ui.complex.$on("filesAdded",this.onUploads.bind(this))}renderStorage(){this.ui.storage=new Oe({props:{files:this.files,id:this.options.id,popup:this.options.storage&&this.options.storage.popup,selectMany:this.options.selectMany,selectOnClick:this.options.selectOnClick,show:this.options.storage&&this.options.storage.show},target:this.options.storageEl}),this.ui.storage.$on("remove",this.removeFiles.bind(this))}renderUpload(){this.ui.upload=new Ie({props:{id:this.options.id,popup:this.options.upload&&this.options.upload.popup,short:this.options.upload&&this.options.upload.short,show:this.options.upload&&this.options.upload.show},target:this.options.uploadEl}),this.ui.upload.$on("filesAdded",this.onUploads.bind(this)),this.ui.upload.$on("remove",this.removeUpload.bind(this))}loadFilesData(){var e=this;let t={session:this.options.session,store:this.options.store};return this.getInterface().setFilter(t).setSorter({fileID:-1}).$list({}).then((function({result:t,status:n}){return"ok"===n?(e.storage.files.update((function(e){return e.splice(0,e.length,...t),e})),t):[]})).catch((function(e){console.error(e,"Список загруженных файлов не доступен!")}))}getInfo(e,t="get"){let n={session:this.options.session,store:this.options.store};return this.getInterface().setFilter(n)["$"+t]({_id:e}).catch((function(e){console.error(e,"Информация о файле не доступна!")}))}useGlobalInterface(){return this.options.useGlobalInterface&&this.nrFile}getInterface(){return new ot(Ke,this.options)}show(){var e=this;return new Promise((function(t,n){e.ui.storage?e.ui.storage.$set({onReject:n,onResolve:t,show:!0}):e.ui.complex&&e.ui.complex.$set({onReject:n,onResolve:t,show:!0})}))}async removeFiles(e){let t=e.detail.selected,n={session:this.options.session,store:this.options.store},s=[];for(let e of t){let t=this.findFileByUUID(e);if(t)try{let e=await this.getInterface().setFilter(n).$delete({_id:t._id});this.isGood(e)&&s.push(t)}catch(e){console.error(e)}}s.forEach(this.removeFromStore.bind(this)),this.resetSelected()}findFileByUUID(e){let t=!1;return this.files.forEach((function(n){n.uuid===e&&(t=n)})),t}isGood(e){return e.status&&"ok"===e.status}removeFromStore(e){this.storage.files.update((function(t){let n=t.indexOf(e);return n>-1&&t.splice(n,1),t}))}resetSelected(){this.storage.selected.update((function(e){return e.splice(0,e.length),e}))}async onUploads(e){let t=e.detail;for(let e of t){let t=await this.preloadFilePreview(e);e.id="fid_"+Math.random();let n={file:e,id:e.id,name:e.name,preview:t,size:e.size,type:e.type};this.addToUploads(n)}}preloadFilePreview(e){var t=this;return new Promise((function(n,s){try{let o=new FileReader;o.onload=function(e){let s=document.createElement("canvas");s.width=t.options.preview.width,s.height=t.options.preview.height;let o=s.getContext("2d"),i=new Image;i.onload=function(){o.drawImage(i,0,0,t.options.preview.width,t.options.preview.height),n(s.toDataURL("image/png"))},i.src=e.target.result},o.onerror=s,o.readAsDataURL(e)}catch(e){s(e)}}))}addToUploads(e){this.uploadFile(e).catch(console.error),this.storage.uploads.update((function(t){return t.push(e),t}))}removeUpload(){}uploadFile(e){var t=this;let n={session:this.options.session,store:this.options.store};return this.getInterface().setFilter(n).$create(n,!1,!0,e.file).then((function(n){"ok"===n.status&&t.uploadFinished(e)}))}uploadFinished(e){this.storage.uploads.update((function(t){let n;return t.forEach((function(t){t.id===e.id&&(e.uploaded=!0,n=e)})),n&&t.splice(t.indexOf(n),1),t})),this.loadFilesData().catch(console.error)}},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
